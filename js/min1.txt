function CustomAlert(){this.render=function(t){var e=window.innerWidth,r=window.innerHeight,i=document.getElementById("dialogoverlay"),n=document.getElementById("dialogbox");i.style.display="block",i.style.height=r+"px",n.style.top="100px",n.style.width="auto",n.style.height="auto",n.style.display="table";for(var o=document.getElementById("dialogboxbody");o.firstChild;)o.removeChild(o.firstChild);for(;o.firstChild;)o.removeChild(o.firstChild);for(var o=document.getElementById("dialogboxfoot");o.firstChild;)o.removeChild(o.firstChild);var s="<td style='padding:20px;text-align:center;cursor:default'>"+t+"</td>";document.getElementById("dialogboxbody").innerHTML=s,document.getElementById("dialogboxfoot").innerHTML='<td onclick="Alert.ok()">OK</td>',document.getElementById("dialogboxhead").innerHTML="<td>Alert</td>";var a=n.getBoundingClientRect(),l=a.right-a.left;n.style.left=e/2-.5*l+"px"},this.ok=function(){document.getElementById("dialogbox").style.display="none",document.getElementById("dialogoverlay").style.display="none"}}function AboutAlert(){this.render=function(){var t=window.innerWidth,e=window.innerHeight,r=document.getElementById("dialogoverlay"),i=document.getElementById("dialogbox");r.style.display="block",r.style.height=e+"px",i.style.top="100px",i.style.width="400px",i.style.height="auto",i.style.display="table";for(var n=document.createElement("TD"),o=document.getElementById("dialogboxbody");o.firstChild;)o.removeChild(o.firstChild);for(;o.firstChild;)o.removeChild(o.firstChild);for(var o=document.getElementById("dialogboxfoot");o.firstChild;)o.removeChild(o.firstChild);var s=document.createElement("div");s.innerHTML=document.getElementById("about").innerHTML,s.setAttribute("style","padding-left:20px;padding-bottom:10px;padding-top:10px;padding-right:20px;font-family:arial;"),n.appendChild(s),document.getElementById("dialogboxbody").appendChild(n),document.getElementById("dialogboxfoot").innerHTML='<td onclick="aboutAlert.ok()">OK</td>',document.getElementById("dialogboxhead").innerHTML="<td>About</td>";var a=i.getBoundingClientRect(),l=a.right-a.left;i.style.left=t/2-.5*l+"px"},this.ok=function(){document.getElementById("dialogbox").style.display="none",document.getElementById("dialogoverlay").style.display="none"}}function SaveAlert(){this.render=function(t){var e=window.innerWidth,r=window.innerHeight,i=document.getElementById("dialogoverlay"),n=document.getElementById("dialogbox");i.style.display="block",i.style.height=r+"px",n.style.top="100px",n.style.width="200px",n.style.height="100px",n.style.display="table";for(var o=document.getElementById("dialogboxbody");o.firstChild;)o.removeChild(o.firstChild);for(;o.firstChild;)o.removeChild(o.firstChild);for(var o=document.getElementById("dialogboxfoot");o.firstChild;)o.removeChild(o.firstChild);var s="<td style='padding:20px;text-align:center;cursor:default'>"+t+"</td>";document.getElementById("dialogboxbody").innerHTML=s,document.getElementById("dialogboxhead").innerHTML="<td>Alert</td>";var a=n.getBoundingClientRect(),l=a.right-a.left;n.style.left=e/2-.5*l+"px"},this.ok=function(){document.getElementById("dialogbox").style.display="none",document.getElementById("dialogoverlay").style.display="none"}}function change_color(t,e,r,i){if(t.style.backgroundColor=e,t.style.color=r,1==i){var n=t.childNodes[1].value,o=n.lastIndexOf(".xml");-1!=o&&(n=n.substring(0,o)),n+=".png";var s=document.getElementById("template_preview");s.src="library/"+n}}function CustomPrompt(){this.render=function(t){var e=window.innerWidth,r=window.innerHeight,i=document.getElementById("dialogoverlay"),n=document.getElementById("dialogbox");i.style.display="block",i.style.height=r+"px",n.style.top="100px",n.style.width="200px",n.style.height="auto",n.style.display="table";for(var o=document.getElementById("dialogboxbody");o.firstChild;)o.removeChild(o.firstChild);for(;o.firstChild;)o.removeChild(o.firstChild);for(var o=document.getElementById("dialogboxfoot");o.firstChild;)o.removeChild(o.firstChild);for(var s=document.createElement("TD"),a=0;a<t.length;a++){var l=document.createElement("DIV");l.innerHTML=t[a],s.appendChild(l),l.setAttribute("onmouseover","change_color(this,'#879AB7','black',false)"),l.setAttribute("onmouseleave","change_color(this,'#F4F6F6','black',false)"),l.setAttribute("onclick","Prompt.ok(this)")}document.getElementById("dialogboxbody").appendChild(s),document.getElementById("dialogboxfoot").innerHTML='<td onclick="Prompt.cancel()">Cancel</td>',document.getElementById("dialogboxhead").innerHTML="add_charge"!=cursor_flag?"<td>Isotope Labelling</td>":"<td>Add Charge</td>";var u=n.getBoundingClientRect(),c=u.right-u.left;n.style.left=e/2-.5*c+"px"},this.cancel=function(){document.getElementById("dialogbox").style.display="none",document.getElementById("dialogoverlay").style.display="none"},this.ok=function(t){"add_charge"==cursor_flag?set_add_charge(t):"isotope_label"==cursor_flag&&set_isotope_label(t),document.getElementById("dialogbox").style.display="none",document.getElementById("dialogoverlay").style.display="none","add_charge"==cursor_flag&&1==error_flag&&Alert.render("Invalid add charge action"),error_flag=!1}}function CustomPromptLogin(){this.render=function(){var t=window.innerWidth,e=window.innerHeight,r=document.getElementById("dialogoverlay"),i=document.getElementById("dialogbox");r.style.display="block",r.style.height=e+"px",i.style.top="100px",i.style.display="table",i.style.width="auto",i.style.height="auto";for(var n=document.getElementById("dialogboxbody");n.firstChild;)n.removeChild(n.firstChild);for(;n.firstChild;)n.removeChild(n.firstChild);for(var n=document.getElementById("dialogboxfoot");n.firstChild;)n.removeChild(n.firstChild);var o=document.createElement("div");o.setAttribute("class","login");var s=document.createElement("p"),a=document.createElement("INPUT");a.setAttribute("type","text"),a.setAttribute("name","myusername"),a.setAttribute("id","login"),a.setAttribute("placeholder","Username"),a.setAttribute("onkeydown","if (event.keyCode == 13) { login_Prompt.ok(); }"),s.appendChild(a);var l=document.createElement("p"),u=document.createElement("INPUT");u.setAttribute("type","password"),u.setAttribute("name","mypassword"),u.setAttribute("id","password"),u.setAttribute("placeholder","Password"),u.setAttribute("onkeydown","if (event.keyCode == 13) { login_Prompt.ok(); }"),l.appendChild(u);var c=document.createElement("p");c.setAttribute("class","login-submit");var d=document.createElement("Button");d.setAttribute("class","login-button"),d.setAttribute("onclick","login_Prompt.ok()"),c.appendChild(d);var h=document.createElement("div");h.setAttribute("id","txthnt"),o.appendChild(s),o.appendChild(l),o.appendChild(c),o.appendChild(h),document.getElementById("dialogboxbody").appendChild(o),document.getElementById("dialogboxfoot").innerHTML='<button onclick="login_Prompt.cancel()">Cancel</button>',document.getElementById("dialogboxhead").innerHTML="Login";var m=i.getBoundingClientRect(),g=m.right-m.left;i.style.left=t/2-.5*g+"px"},this.cancel=function(){document.getElementById("dialogbox").style.display="none",document.getElementById("dialogoverlay").style.display="none"},this.ok=function(){var t=document.getElementById("login").value,e=document.getElementById("password").value;$.post("login2.php",{myusername:t,mypassword:e},function(t){t=t.split("-"),"Success"==t[0]?(document.getElementById("txthnt").innerHTML=t,document.getElementById("dialogbox").style.display="none",document.getElementById("dialogoverlay").style.display="none",document.getElementById("log1").innerHTML="Welcome "+t[1]+",<br>Logout",login_set=!0):(document.getElementById("txthnt").innerHTML=t,login_set=!1)})}}function CustomTemplatePrompt(){this.render=function(){var t=window.innerWidth,e=window.innerHeight,r=document.getElementById("dialogoverlay"),i=document.getElementById("dialogbox");r.style.display="block",r.style.height=e+"px",i.style.left=t/2-275+"px",i.style.top="100px",i.style.display="table",i.style.width="400px",i.style.height="auto";var n=document.getElementById("dialogboxbody"),o=document.createElement("TD");o.setAttribute("style","border-right:thin solid #879AB7;");var s=document.createElement("TD");s.width="50%",s.setAttribute("style","text-align:center;");var a=document.createElement("img");for(a.id="template_preview",s.appendChild(a);n.firstChild;)n.removeChild(n.firstChild);for(;n.firstChild;)n.removeChild(n.firstChild);for(var n=document.getElementById("dialogboxfoot");n.firstChild;)n.removeChild(n.firstChild);$.post("list.php",{},function(t){t=JSON.parse(t);for(var e=0;e<t.length-2;e++)if("-1"==t[e].indexOf(".png")&&"-1"==t[e].indexOf(".PNG")){var r=document.createElement("DIV"),i=document.createElement("INPUT");i.type="hidden",i.value=t[e],r.innerHTML=t[e].replace(".xml",""),r.appendChild(i),o.appendChild(r),r.setAttribute("onmouseover","change_color(this,'#879AB7','black',true)"),r.setAttribute("onmouseleave","change_color(this,'#F4F6F6','black',false)"),r.setAttribute("onclick","template_prompt.ok(this)")}}),document.getElementById("dialogboxbody").appendChild(o),document.getElementById("dialogboxbody").appendChild(s),document.getElementById("dialogboxfoot").innerHTML='<td colspan=2 onclick="template_prompt.cancel()">Cancel</td>',document.getElementById("dialogboxhead").innerHTML="<td colspan=2>Show Template</td>";var l=i.getBoundingClientRect(),u=l.right-l.left;i.style.left=t/2-.5*u+"px",a.style.width="200px",a.style.height="178px",a.src="library/blank.png"},this.cancel=function(){document.getElementById("dialogbox").style.display="none",document.getElementById("dialogoverlay").style.display="none"},this.ok=function(t){var e="library/"+t.childNodes[1].value;if(templateXML=loadXMLDoc(e),null==templateXML||""==templateXML){var e="library/"+t.innerHTML+".xml";templateXML=loadXMLDoc(e)}deleteBridge(),skeletonFlag=!1,eventClear(),document.getElementById("s_content").style.cursor="default",$("button").css("background-image",""),cursor_flag="default",document.getElementById("s_content").style.cursor="url('images/template.png'), auto",document.getElementById("s_content").addEventListener("click",click_open_template),cursor_flag="open_template",symbol="",document.getElementById("dialogbox").style.display="none",document.getElementById("dialogoverlay").style.display="none"}}function CustomInputPrompt(){this.render=function(){var t=window.innerWidth,e=window.innerHeight,r=document.getElementById("dialogoverlay"),i=document.getElementById("dialogbox");r.style.display="block",r.style.height=e+"px",i.style.top="100px",i.style.display="table",i.style.width="200px",i.style.height="auto";for(var n=document.getElementById("dialogboxbody");n.firstChild;)n.removeChild(n.firstChild);for(;n.firstChild;)n.removeChild(n.firstChild);for(var n=document.getElementById("dialogboxfoot");n.firstChild;)n.removeChild(n.firstChild);var o=document.createElement("div"),s=document.createElement("TD");o.setAttribute("class","login");var a=document.createElement("p"),l=document.createElement("INPUT");l.setAttribute("type","text"),l.setAttribute("name","myusername"),l.setAttribute("id","fname"),"add_caption"!=cursor_flag?l.setAttribute("placeholder","Template name"):l.setAttribute("placeholder","Caption"),s.setAttribute("colspan","2"),s.setAttribute("style","padding:20px;text-align:center;cursor:default"),a.appendChild(l),o.appendChild(a),s.appendChild(o),document.getElementById("dialogboxbody").appendChild(s),document.getElementById("dialogboxhead").innerHTML="add_caption"!=cursor_flag?'<td colspan="2">Update Template</td>':'<td colspan="2">Add Caption</td>',document.getElementById("dialogboxfoot").innerHTML='<td onclick="input_prompt.ok()" style="border-right:thin solid #879AB7;width:100px;">Ok</td><td onclick="input_prompt.cancel()" style="width:100px;">Cancel</td>';var u=i.getBoundingClientRect(),c=u.right-u.left;i.style.left=t/2-.5*c+"px"},this.cancel=function(){document.getElementById("dialogbox").style.display="none",document.getElementById("dialogoverlay").style.display="none"},this.ok=function(){if("add_caption"!=cursor_flag){var t=document.getElementById("fname").value;if(t=t.replace(".xml",""),t=t.replace(".",""),""==t||null==t)return void Alert.render("Template name is empty");var e=writeXML("save_template");e=e.replace(/%2B/g,"+"),e=e.replace(/%2D/g,"-"),$.post("updatexml.php",{fname:t,data:e},function(e){"Success"==e?(document.getElementById("dialogbox").style.display="none",document.getElementById("dialogoverlay").style.display="none",save_template(t),Alert.render("File successfully uploaded to library")):(document.getElementById("dialogbox").style.display="none",document.getElementById("dialogoverlay").style.display="none",Alert.render("Unsuccessful upload to library"))})}else set_caption(document.getElementById("fname").value),document.getElementById("dialogbox").style.display="none",document.getElementById("dialogoverlay").style.display="none"}}function CustomPromptPTable(){this.render=function(){var t=window.innerWidth/2,e=window.innerHeight,r=document.getElementById("dialogoverlay"),i=document.getElementById("dialogbox");r.style.display="block",r.style.height=e+"px",i.style.top="100px",i.style.width="auto",i.style.height="auto",i.style.display="table";for(var n=document.createElement("TD"),o=document.getElementById("dialogboxbody");o.firstChild;)o.removeChild(o.firstChild);for(var o=document.getElementById("dialogboxhead");o.firstChild;)o.removeChild(o.firstChild);for(var o=document.getElementById("dialogboxfoot");o.firstChild;)o.removeChild(o.firstChild);var s=document.createElement("div");s.innerHTML=document.getElementById("ptable").innerHTML,s.setAttribute("class","alrt"),n.appendChild(s),document.getElementById("dialogboxbody").appendChild(n),document.getElementById("dialogboxfoot").innerHTML='<td onclick="ptable_prompt.cancel()">Cancel</td>',document.getElementById("dialogboxhead").innerHTML="<td>Periodic Table</td>";var a=i.getBoundingClientRect(),l=a.right-a.left;i.style.left=t/2-.5*l+"px"},this.cancel=function(){document.getElementById("dialogbox").style.display="none",document.getElementById("dialogoverlay").style.display="none"},this.ok=function(t,e,r){atomButton(t,e,r),document.getElementById("dialogbox").style.display="none",document.getElementById("dialogoverlay").style.display="none"}}function Atom(){this.id="",this.atNo="",this.title="",this.type="",this.hybridization="",this.geometry="",this.symbol="",this.position="",this.isotopeLabel="",this.charge="",this.chargeCount="",this.electroNegativity="",this.atomicMass="",this.oxdnState="",this.group="",this.block="",this.gcCode="",this.partCharge="",this.partChargeVal="",this.groupStatus="",this.x=0,this.y=0,this.atomPoint=svg.createSVGPoint(),this.linkAtomVector=new Array,this.electronLinkVector=new Array}function Interact(){this.id="",this.title="",this.type="",this.sourceObject="",this.targetObject="",this.sourceId="",this.targetId="",this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.intPoint1=0,this.intPoint2=0}function ElectronLink(){this.id="",this.tmpId="",this.title="",this.type="",this.electronStatus="",this.spin="",this.charge="",this.chargeCount="",this.affinity="",this.bond="",this.bondType="",this.order="",this.linkStatus="",this.target="",this.orientation="",this.projection="",this.priority="",this.gcCode="",this.partCharge="",this.partChargeVal="",this.checkStatus="",this.x1=x2=0,this.y1=y2=0,this.linkPoint1=svg.createSVGPoint(),this.linkPoint2=svg.createSVGPoint(),this.quatPoint=svg.createSVGPoint(),this.midPoint=svg.createSVGPoint(),this.arrowPoint=svg.createSVGPoint(),this.linkAtom=new Array}function Structure(){this.id="",this.title="",this.type="",this.formula="",this.molarmass="",this.state="",this.role="",this.mp="",this.bp="",this.smiles="",this.fragmentVector=new Array,this.captionVector=new Array}function StructureGroup(){this.id="",this.title="",this.type="",this.structureVector=new Array,this.interactVector=new Array,this.captionVector=new Array}function lineAnimation(t){pt.x=t.clientX+clientXchange,pt.y=t.clientY+clientYchange;var e=2.7,r=svg.getScreenCTM(),i=r.inverse(),n=pt.matrixTransform(i);animline.style.visibility="visible",animline.setAttribute("x1",Number(pt1.x)+e),animline.setAttribute("y1",pt1.y-e),animline.setAttribute("x2",n.x+e),animline.setAttribute("y2",n.y-e),animline.setAttribute("stroke","red"),animline.setAttribute("stroke-width",.75),"visible"==unpaired_electron_flag&&upair_electrons(!1),"visible"==lonepaired_electron_flag&&lpair_electrons(!1),"visible"==vacant_electron_flag&&vacant_electrons(!1)}function toMove(t,e,r){for(var i=e.x-t.x,n=e.y-t.y,o=[],s=[],a=0;a<count;a++){var l,u,c,d="g["+a+"]",h=document.getElementById(d);if(null!=h){1==h.hasAttribute("transform")&&h.removeAttribute("transform");var m=h.getAttribute("str_id");if(!(d!=t.g_id&&"move_atom"==move_structure_flag||m!=t.str_id&&"move_structure"==move_structure_flag)){var g=Number(h.childNodes[1].getAttribute("x")),y=Number(h.childNodes[1].getAttribute("y"));0==r&&(u=Number(atom[a].getX("x")),c=Number(atom[a].getY("y")),l=u==g.toFixed(2)&&c==y.toFixed(2)?a:collisionDetectAtomIndex(g,y));var g=g+i,y=y+n,p=2.7,f=h.childNodes[1].childNodes[0].nodeValue.length-1;if(h.childNodes[1].setAttribute("x",g),h.childNodes[1].setAttribute("y",y),h.childNodes[2].setAttribute("x",g-p),h.childNodes[2].setAttribute("y",y-p),h.childNodes[0].setAttribute("cx",g+p+f),h.childNodes[0].setAttribute("cy",y-p),h.childNodes[3].setAttribute("x",g+2*p),h.childNodes[3].setAttribute("y",y-2*p),h.childNodes[4].setAttribute("x",g-p+1),h.childNodes[4].setAttribute("y",y-3*p+1),0==r){atom[l].setX(g.toFixed(2)),atom[l].setY(y.toFixed(2));var b=collisionDetectFragmentIndex(u,c);if(-1!=b){var v=Number(fragment[b].getX2("x")).toFixed(2),x=Number(fragment[b].getY2("y")).toFixed(2);fragment[b].setX2(g.toFixed(2)),fragment[b].setY2(y.toFixed(2));var A=v+"-"+x;s[A]=g.toFixed(2)+"-"+y.toFixed(2)}var A=u.toFixed(2)+"-"+c.toFixed(2);o[A]=g.toFixed(2)+"-"+y.toFixed(2);for(var _=atom[l].getElectronLinkVector(),E=_.length,B=0;E>B;B++)_[B].setX1(g.toFixed(2)),_[B].setY1(y.toFixed(2)),("uPair"==_[B].getElectronStatus()||"lPair"==_[B].getElectronStatus()||"vacant"==_[B].getElectronStatus())&&(_[B].setX2(g.toFixed(2)),_[B].setY2(y.toFixed(2)))}}}}if(0==r){for(var a=0;a<count;a++)for(var _=atom[a].getElectronLinkVector(),E=_.length,B=0;E>B;B++)if("bPair"==_[B].getElectronStatus()){var w=Number(_[B].getX2()),k=Number(_[B].getY2()),A=w.toFixed(2)+"-"+k.toFixed(2);A=o[A],"undefined"!=typeof A&&(A=A.split("-"),_[B].setX2(A[0]),_[B].setY2(A[1]))}for(var B=0;B<frg_count;B++){var w=Number(fragment[B].getX1()),k=Number(fragment[B].getY1()),A=w.toFixed(2)+"-"+k.toFixed(2);A=s[A],"undefined"!=typeof A&&(A=A.split("-"),fragment[B].setX1(A[0]),fragment[B].setY1(A[1]))}}for(var C=[],a=0;a<l_count;a++){var d="l["+a+"]",h=document.getElementById(d);if(null!=h){1==h.hasAttribute("transform")&&h.removeAttribute("transform"),1==h.hasAttribute("old_x1")&&h.removeAttribute("old_x1"),1==h.hasAttribute("old_x2")&&h.removeAttribute("old_x2"),1==h.hasAttribute("old_y1")&&h.removeAttribute("old_y1"),1==h.hasAttribute("old_y2")&&h.removeAttribute("old_y2");var N=h.getAttribute("id1"),P=h.getAttribute("id2");if(N==t.g_id||"move_atom"!=move_structure_flag||P==t.g_id||"move_atom"!=move_structure_flag){if("move_atom"!=move_structure_flag){var m=h.getAttribute("str_id");if(m!=t.str_id&&"move_structure"==move_structure_flag)continue;var I=Number(h.getAttribute("x1"))+i,S=Number(h.getAttribute("y1"))+n;h.setAttribute("x1",I),h.setAttribute("y1",S);var I=Number(h.getAttribute("x2"))+i,S=Number(h.getAttribute("y2"))+n;h.setAttribute("x2",I),h.setAttribute("y2",S)}else if(N==t.g_id){var I=Number(e.x)+p,S=Number(e.y)-p,M=document.getElementById(P),T=M.childNodes[0].getAttribute("cx"),V=M.childNodes[0].getAttribute("cy"),L=h.getAttribute("x2"),F=h.getAttribute("y2");if(Number(T).toFixed(2)!=Number(L).toFixed(2)||Number(V).toFixed(2)!=Number(F).toFixed(2)){var X={x:I,y:S},D={x:Number(T),y:Number(V)},R=N+P;if("undefined"!=typeof C[R])var $=Math.atan2(X.y-D.y,X.x-D.x)+Math.PI/2;else var $=Math.atan2(X.y-D.y,X.x-D.x)-Math.PI/2;var O=1.5;C[R]=!0,X.x=X.x-O*Math.cos($),X.y=X.y-O*Math.sin($),D.x=D.x-O*Math.cos($),D.y=D.y-O*Math.sin($),I=X.x,S=X.y,h.setAttribute("x2",D.x),h.setAttribute("y2",D.y)}h.setAttribute("x1",I),h.setAttribute("y1",S)}else{var I=Number(e.x)+p,S=Number(e.y)-p,j=document.getElementById(N),u=j.childNodes[0].getAttribute("cx"),c=j.childNodes[0].getAttribute("cy"),Y=h.getAttribute("x1"),z=h.getAttribute("y1");if(Number(u).toFixed(2)!=Number(Y).toFixed(2)||Number(c).toFixed(2)!=Number(z).toFixed(2)){var X={x:I,y:S},D={x:Number(u),y:Number(c)},R=N+P;if("undefined"!=typeof C[R])var $=Math.atan2(X.y-D.y,X.x-D.x)-Math.PI/2;else var $=Math.atan2(X.y-D.y,X.x-D.x)+Math.PI/2;var O=1.5;C[R]=!0,X.x=X.x-O*Math.cos($),X.y=X.y-O*Math.sin($),D.x=D.x-O*Math.cos($),D.y=D.y-O*Math.sin($),I=D.x,S=D.y,h.setAttribute("x1",X.x),h.setAttribute("y1",X.y)}h.setAttribute("x2",I),h.setAttribute("y2",S)}for(var B=0;B<t_count;B++){var d="tri["+B+"]",G=document.getElementById(d);if(null!=G){var H=G.getAttribute("id1"),W=G.getAttribute("id2");if(N==H&&P==W){1==G.hasAttribute("transform")&&G.removeAttribute("transform"),1==G.hasAttribute("old_points")&&G.removeAttribute("old_points");var U,q,Q,p=2.7;U={x:h.getAttribute("x1"),y:h.getAttribute("y1")},q={x:h.getAttribute("x2"),y:h.getAttribute("y2")},Q={x:"",y:""};var i=q.x-U.x,n=q.y-U.y,K=Math.sqrt(i*i+n*n);K=round(K)/4,i=(q.x-U.x)/K,n=(q.y-U.y)/K,U.x=Number(U.x)+i*K/(1.3*K),U.y=Number(U.y)+n*K/(1.3*K),q.x=Number(q.x)-i,q.y=Number(q.y)-n;var $=Math.atan2(U.y-q.y,U.x-q.x)+Math.PI/2,O=5;Q.x=q.x-O*Math.cos($),Q.y=q.y-O*Math.sin($);var Z=U.x+","+U.y+" "+q.x+","+q.y+" "+Q.x+","+Q.y;G.setAttribute("points",Z)}}}}}}for(var J=[],a=0;a<itl_count;a++){var te,ee,re,ie,d="itl["+a+"]",h=document.getElementById(d);if(null!=h){1==h.hasAttribute("transform")&&h.removeAttribute("transform"),1==h.hasAttribute("old_x1")&&h.removeAttribute("old_x1"),1==h.hasAttribute("old_x2")&&h.removeAttribute("old_x2"),1==h.hasAttribute("old_y1")&&h.removeAttribute("old_y1"),1==h.hasAttribute("old_y2")&&h.removeAttribute("old_y2");var N=h.getAttribute("id1"),P=h.getAttribute("id2"),ne=h.getAttribute("str_id1"),oe=h.getAttribute("str_id2");if(N==t.g_id||"move_atom"!=move_structure_flag||P==t.g_id||"move_atom"!=move_structure_flag)if("move_structure_group"==move_structure_flag){var I=Number(h.getAttribute("x1"))+i,S=Number(h.getAttribute("y1"))+n,te=Number(h.getAttribute("x1"))-p,re=Number(h.getAttribute("y1"))+p;te=te.toFixed(2),re=re.toFixed(2);var w=Number(I-p).toFixed(2),k=Number(S+p).toFixed(2),se=te+"-"+re;J[se]=w+"-"+k,h.setAttribute("x1",I),h.setAttribute("y1",S);var I=Number(h.getAttribute("x2"))+i,S=Number(h.getAttribute("y2"))+n,ee=Number(h.getAttribute("x2"))-p,ie=Number(h.getAttribute("y2"))+p;ee=ee.toFixed(2),ie=ie.toFixed(2);var ae=Number(I-p).toFixed(2),le=Number(S+p).toFixed(2),se=ee+"-"+ie;J[se]=ae+"-"+le,h.setAttribute("x2",I),h.setAttribute("y2",S)}else if("move_structure"==move_structure_flag){if(ne==t.str_id){var Y=Number(document.getElementById(N).childNodes[0].getAttribute("cx")),z=Number(document.getElementById(N).childNodes[0].getAttribute("cy")),te=Number(Y)-p-i,re=Number(z)+p-n;te=te.toFixed(2),re=re.toFixed(2);var se=te+"-"+re;J[se]=Number(Y-p).toFixed(2)+"-"+Number(z+p).toFixed(2),h.setAttribute("x1",Y),h.setAttribute("y1",z),1==h.hasAttribute("old_x1")&&h.removeAttribute("old_x1"),1==h.hasAttribute("old_y1")&&h.removeAttribute("old_y1")}else if(oe==t.str_id){var L=Number(document.getElementById(P).childNodes[0].getAttribute("cx")),F=Number(document.getElementById(P).childNodes[0].getAttribute("cy")),ee=Number(L)-p-i,ie=Number(F)+p-n;ee=ee.toFixed(2),ie=ie.toFixed(2);var se=ee+"-"+ie;J[se]=Number(L-p).toFixed(2)+"-"+Number(F+p).toFixed(2),h.setAttribute("x2",L),h.setAttribute("y2",F),0==h.hasAttribute("old_x2")&&h.removeAttribute("old_x2"),0==h.hasAttribute("old_y2")&&h.removeAttribute("old_y2")}}else if(N==t.g_id){var I=Number(e.x)+p,S=Number(e.y)-p,te=Number(t.x),re=Number(t.y);te=te.toFixed(2),re=re.toFixed(2);var w=Number(e.x).toFixed(2),k=Number(e.y).toFixed(2),se=te+"-"+re;J[se]=w+"-"+k,h.setAttribute("x1",I),h.setAttribute("y1",S)}else if(P==t.g_id){var I=Number(e.x)+p,S=Number(e.y)-p,ee=Number(t.x),ie=Number(t.y);ee=ee.toFixed(2),ie=ie.toFixed(2);var ae=Number(e.x).toFixed(2),le=Number(e.y).toFixed(2),se=ee+"-"+ie;J[se]=ae+"-"+le,h.setAttribute("x2",I),h.setAttribute("y2",S)}}}interact_xy_change(J)}function moveAnimation(t){pt.x=t.clientX+clientXchange,pt.y=t.clientY+clientYchange;for(var e=2.7,r=svg.getScreenCTM(),i=r.inverse(),n=pt.matrixTransform(i),o=n.x-pt1.x,s=n.y-pt1.y,a="translate("+o+","+s+")",l=0;l<count;l++){var u="g["+l+"]",c=document.getElementById(u);if(null!=c&&(u==pt1.g_id||"move_atom"!=move_structure_flag)){var d=c.getAttribute("str_id");(d==pt1.str_id||"move_structure"!=move_structure_flag)&&c.setAttribute("transform",a)}}for(var h=[],l=0;l<l_count;l++){var u="l["+l+"]",c=document.getElementById(u);if(null!=c){var m=c.getAttribute("id1"),g=c.getAttribute("id2");if(m==pt1.g_id||"move_atom"!=move_structure_flag||g==pt1.g_id||"move_atom"!=move_structure_flag)if("move_atom"!=move_structure_flag){var d=c.getAttribute("str_id");if(d!=pt1.str_id&&"move_structure"==move_structure_flag)continue;c.setAttribute("transform",a);for(var y=0;y<t_count;y++){var u="tri["+y+"]",p=document.getElementById(u);if(null!=p){var f=p.getAttribute("id1"),b=p.getAttribute("id2");m==f&&g==b&&p.setAttribute("transform",a)}}}else{if(m==pt1.g_id){var v=Number(n.x)+e,x=Number(n.y)-e,A=document.getElementById(g),_=A.childNodes[0].getAttribute("cx"),E=A.childNodes[0].getAttribute("cy"),B=c.getAttribute("x1"),w=c.getAttribute("y1"),k=c.getAttribute("x2"),C=c.getAttribute("y2");if(Number(_).toFixed(2)!=Number(k).toFixed(2)||Number(E).toFixed(2)!=Number(C).toFixed(2)){var N={x:v,y:x},P={x:Number(_),y:Number(E)},I=m+g;if("undefined"!=typeof h[I])var S=Math.atan2(N.y-P.y,N.x-P.x)+Math.PI/2;else var S=Math.atan2(N.y-P.y,N.x-P.x)-Math.PI/2;var M=1.5;h[I]=!0,N.x=N.x-M*Math.cos(S),N.y=N.y-M*Math.sin(S),P.x=P.x-M*Math.cos(S),P.y=P.y-M*Math.sin(S),v=N.x,x=N.y,c.setAttribute("x2",P.x),c.setAttribute("y2",P.y),0==c.hasAttribute("old_x2")&&c.setAttribute("old_x2",k),0==c.hasAttribute("old_y2")&&c.setAttribute("old_y2",C)}c.setAttribute("x1",v),c.setAttribute("y1",x),0==c.hasAttribute("old_x1")&&c.setAttribute("old_x1",B),0==c.hasAttribute("old_y1")&&c.setAttribute("old_y1",w)}else{var v=Number(n.x)+e,x=Number(n.y)-e,T=document.getElementById(m),V=T.childNodes[0].getAttribute("cx"),L=T.childNodes[0].getAttribute("cy"),B=c.getAttribute("x1"),w=c.getAttribute("y1"),k=c.getAttribute("x2"),C=c.getAttribute("y2");if(Number(V).toFixed(2)!=Number(B).toFixed(2)||Number(L).toFixed(2)!=Number(w).toFixed(2)){var N={x:v,y:x},P={x:Number(V),y:Number(L)},I=m+g;if("undefined"!=typeof h[I])var S=Math.atan2(N.y-P.y,N.x-P.x)-Math.PI/2;else var S=Math.atan2(N.y-P.y,N.x-P.x)+Math.PI/2;var M=1.5;h[I]=!0,N.x=N.x-M*Math.cos(S),N.y=N.y-M*Math.sin(S),P.x=P.x-M*Math.cos(S),P.y=P.y-M*Math.sin(S),v=P.x,x=P.y,0==c.hasAttribute("old_x1")&&c.setAttribute("old_x1",B),0==c.hasAttribute("old_y1")&&c.setAttribute("old_y1",w),c.setAttribute("x1",N.x),c.setAttribute("y1",N.y)}0==c.hasAttribute("old_x2")&&c.setAttribute("old_x2",k),0==c.hasAttribute("old_y2")&&c.setAttribute("old_y2",C),c.setAttribute("x2",v),c.setAttribute("y2",x)}for(var y=0;y<t_count;y++){var u="tri["+y+"]",p=document.getElementById(u);if(null!=p){var f=p.getAttribute("id1"),b=p.getAttribute("id2");if(m==f&&g==b){if(1==p.hasAttribute("transform")&&p.removeAttribute("transform"),0==p.hasAttribute("old_points")){var F=p.getAttribute("points");p.setAttribute("old_points",F)}var X,D,R,e=2.7;X={x:c.getAttribute("x1"),y:c.getAttribute("y1")},D={x:c.getAttribute("x2"),y:c.getAttribute("y2")},R={x:"",y:""};var o=D.x-X.x,s=D.y-X.y,$=Math.sqrt(o*o+s*s);$=round($)/4,o=(D.x-X.x)/$,s=(D.y-X.y)/$,X.x=Number(X.x)+o*$/(1.3*$),X.y=Number(X.y)+s*$/(1.3*$),D.x=Number(D.x)-o,D.y=Number(D.y)-s;var S=Math.atan2(X.y-D.y,X.x-D.x)+Math.PI/2,M=5;R.x=D.x-M*Math.cos(S),R.y=D.y-M*Math.sin(S);var O=X.x+","+X.y+" "+D.x+","+D.y+" "+R.x+","+R.y;p.setAttribute("points",O)}}}}}}for(var l=0;l<itl_count;l++){var u="itl["+l+"]",c=document.getElementById(u);if(null!=c){var m=c.getAttribute("id1"),g=c.getAttribute("id2"),j=c.getAttribute("str_id1"),Y=c.getAttribute("str_id2");if(m==pt1.g_id||"move_atom"!=move_structure_flag||g==pt1.g_id||"move_atom"!=move_structure_flag)if("move_structure_group"==move_structure_flag)c.setAttribute("transform",a);else if("move_structure"==move_structure_flag){if(j==pt1.str_id){var B=document.getElementById(m).childNodes[0].getAttribute("cx"),w=document.getElementById(m).childNodes[0].getAttribute("cy"),v=Number(B)+o,x=Number(w)+s;c.setAttribute("x1",v),c.setAttribute("y1",x),0==c.hasAttribute("old_x1")&&c.setAttribute("old_x1",B),0==c.hasAttribute("old_y1")&&c.setAttribute("old_y1",w)}else if(Y==pt1.str_id){var k=document.getElementById(g).childNodes[0].getAttribute("cx"),C=document.getElementById(g).childNodes[0].getAttribute("cy"),v=Number(k)+o,x=Number(C)+s;c.setAttribute("x2",v),c.setAttribute("y2",x),0==c.hasAttribute("old_x2")&&c.setAttribute("old_x2",k),0==c.hasAttribute("old_y2")&&c.setAttribute("old_y2",C)}}else if(m==pt1.g_id){var v=Number(n.x)+e,x=Number(n.y)-e,B=c.getAttribute("x1"),w=c.getAttribute("y1");c.setAttribute("x1",v),c.setAttribute("y1",x),0==c.hasAttribute("old_x1")&&c.setAttribute("old_x1",B),0==c.hasAttribute("old_y1")&&c.setAttribute("old_y1",w)}else if(g==pt1.g_id){var v=Number(n.x)+e,x=Number(n.y)-e,k=c.getAttribute("x2"),C=c.getAttribute("y2");0==c.hasAttribute("old_x2")&&c.setAttribute("old_x2",k),0==c.hasAttribute("old_y2")&&c.setAttribute("old_y2",C),c.setAttribute("x2",v),c.setAttribute("y2",x)}}}"visible"==unpaired_electron_flag&&upair_electrons(!1),"visible"==lonepaired_electron_flag&&lpair_electrons(!1),"visible"==vacant_electron_flag&&vacant_electrons(!1)}function toOrient(t,e){var r,i=2.7,n=[];if(!(lineConnectedNumber(t.g_id)>1)){if(1==undo_redo_flag){var o=document.getElementById(t.g_id);e.x=Number(e.x),e.y=Number(e.y);var s=o.childNodes[1].childNodes[0].nodeValue.length-1;o.childNodes[1].setAttribute("x",e.x),o.childNodes[1].setAttribute("y",e.y),o.childNodes[0].setAttribute("cx",e.x+i+s),o.childNodes[0].setAttribute("cy",e.y-i),o.childNodes[2].setAttribute("x",e.x-i),o.childNodes[2].setAttribute("y",e.y-i),o.childNodes[3].setAttribute("x",e.x+2*i),o.childNodes[3].setAttribute("y",e.y-2*i),o.childNodes[4].setAttribute("x",e.x-i+1),o.childNodes[4].setAttribute("y",e.y-3*i+1)}for(var a=0;a<l_count;a++){var l="l["+a+"]",u=document.getElementById(l);if(null!=u){var c=Number(u.getAttribute("x1")),d=Number(u.getAttribute("y1")),h=Number(u.getAttribute("x2")),m=Number(u.getAttribute("y2")),g=Math.sqrt((h-c)*(h-c)+(m-d)*(m-d));g=Math.round(g),1==u.hasAttribute("transform")&&u.removeAttribute("transform");var y={x:c,y:d},p=u.getAttribute("id1"),f=u.getAttribute("id2");if(f==t.g_id){var o=document.getElementById(t.g_id),b=document.getElementById(p),v=degree(y,e),v=returnDegreeRange(v),x=v*Math.PI/180;if(180>v?v+=180:v-=180,1==o.hasAttribute("transform")&&o.removeAttribute("transform"),r={x:Number(y.x-g*Math.cos(x)),y:Number(y.y-g*Math.sin(x))},1==undo_redo_flag){u.setAttribute("x2",e.x+i),u.setAttribute("y2",e.y-i);break}1==o.hasAttribute("transform")&&o.removeAttribute("transform"),r={x:Number(y.x-g*Math.cos(x)),y:Number(y.y-g*Math.sin(x))},u.setAttribute("x2",r.x),u.setAttribute("y2",r.y);var A=o.childNodes[1].getAttribute("x"),_=o.childNodes[1].getAttribute("y"),s=o.childNodes[1].childNodes[0].nodeValue.length-1;o.childNodes[1].setAttribute("x",r.x-i),o.childNodes[1].setAttribute("y",r.y+i),o.childNodes[0].setAttribute("cx",r.x),o.childNodes[0].setAttribute("cy",r.y),o.childNodes[3].setAttribute("x",r.x+i),o.childNodes[3].setAttribute("y",r.y-i),o.childNodes[4].setAttribute("x",r.x-2*i+1),o.childNodes[4].setAttribute("y",r.y-2*i-1),o.childNodes[2].setAttribute("x",r.x-i-i),o.childNodes[2].setAttribute("y",r.y);
for(var E=0;E<t_count;E++){var l="tri["+E+"]",B=document.getElementById(l);if(null!=B){var w=B.getAttribute("id1"),k=B.getAttribute("id2");if(p==w&&f==k){1==B.hasAttribute("transform")&&B.removeAttribute("transform");var C,N,P,i=2.7;C={x:u.getAttribute("x1"),y:u.getAttribute("y1")},N={x:u.getAttribute("x2"),y:u.getAttribute("y2")},P={x:"",y:""};var I=N.x-C.x,S=N.y-C.y,M=Math.sqrt(I*I+S*S);M=round(M)/4,I=(N.x-C.x)/M,S=(N.y-C.y)/M,C.x=Number(C.x)+I*M/(1.3*M),C.y=Number(C.y)+S*M/(1.3*M),N.x=Number(N.x)-I,N.y=Number(N.y)-S;var T=Math.atan2(C.y-N.y,C.x-N.x)+Math.PI/2,g=5;P.x=N.x-g*Math.cos(T),P.y=N.y-g*Math.sin(T);var V=C.x+","+C.y+" "+N.x+","+N.y+" "+P.x+","+P.y;B.setAttribute("points",V)}}}var L=collisionDetectAtomIndex(A,_),F=collisionDetectAtomIndex(b.childNodes[1].getAttribute("x"),b.childNodes[1].getAttribute("y")),X=Number(r.x-i).toFixed(2),D=Number(r.y+i).toFixed(2);atom[L].setX(X),atom[L].setY(D);for(var R=atom[L].getElectronLinkVector(),E=0;E<R.length;E++)R[E].setX1(X),R[E].setY1(D),("uPair"==R[E].getElectronStatus()||"lPair"==R[E].getElectronStatus()||"vacant"==R[E].getElectronStatus())&&(R[E].setX2(X),R[E].setY2(D));for(var R=atom[F].getElectronLinkVector(),E=0;E<R.length;E++)if(Number(A).toFixed(2)==R[E].getX2()&&Number(_).toFixed(2)==R[E].getY2()){R[E].setX2(X),R[E].setY2(D);break}var $=collisionDetectFragmentIndex(A,_);fragment[$].setX2(X),fragment[$].setY2(D)}}}if("undefined"!=typeof r)for(var a=0;a<itl_count;a++){var l="itl["+a+"]",u=document.getElementById(l);if(null!=u){var O,j,p=u.getAttribute("id1"),f=u.getAttribute("id2");if(p==t.g_id){if(1==u.hasAttribute("old_x1")){O=Number(u.getAttribute("old_x1")),u.removeAttribute("old_x1"),1==u.hasAttribute("old_y1")&&(j=Number(u.getAttribute("old_y1")),u.removeAttribute("old_y1"));var Y=O.toFixed(2)+"-"+j.toFixed(2),z=Number(r.x)-i,G=Number(r.y)+i;n[Y]=Number(z).toFixed(2)+"-"+Number(G).toFixed(2)}if(1==undo_redo_flag){O=Number(u.getAttribute("x1"))-i,j=Number(u.getAttribute("y1"))+i;var Y=O.toFixed(2)+"-"+j.toFixed(2),z=Number(e.x),G=Number(e.y);n[Y]=Number(z).toFixed(2)+"-"+Number(G).toFixed(2),u.setAttribute("x1",e.x+i),u.setAttribute("y1",e.y-i)}u.setAttribute("x1",r.x),u.setAttribute("y1",r.y)}else if(f==t.g_id){if(1==u.hasAttribute("old_x2")){old_x2=Number(u.getAttribute("old_x2")),u.removeAttribute("old_x2"),1==u.hasAttribute("old_y2")&&(old_y2=Number(u.getAttribute("old_y2")),u.removeAttribute("old_y2"));var Y=old_x2.toFixed(2)+"-"+old_y2.toFixed(2),z=Number(r.x)-i,G=Number(r.y)+i;n[Y]=Number(z).toFixed(2)+"-"+Number(G).toFixed(2)}if(1==undo_redo_flag){old_x2=Number(u.getAttribute("x2"))-i,old_y2=Number(u.getAttribute("y2"))+i;var Y=old_x2.toFixed(2)+"-"+old_y2.toFixed(2),z=Number(e.x),G=Number(e.y);n[Y]=Number(z).toFixed(2)+"-"+Number(G).toFixed(2),u.setAttribute("x2",e.x+i),u.setAttribute("y2",e.y-i)}u.setAttribute("x2",r.x),u.setAttribute("y2",r.y)}}}return interact_xy_change(n),r}}function orientationAnimation(t){pt.x=t.clientX+clientXchange,pt.y=t.clientY+clientYchange;var e=2.7,r=svg.getScreenCTM(),i=r.inverse(),n=pt.matrixTransform(i);n.x=n.x+e,n.y=n.y-e;var o,s;if(!(lineConnectedNumber(pt1.g_id)>1)){for(var a=0;a<l_count;a++){var l="l["+a+"]",u=document.getElementById(l);if(null!=u){var c=Number(u.getAttribute("x1")),d=Number(u.getAttribute("y1")),h=Number(u.getAttribute("x2")),m=Number(u.getAttribute("y2")),g=Math.sqrt((h-c)*(h-c)+(m-d)*(m-d));g=Math.round(g);var y={x:c,y:d},p=u.getAttribute("id2"),f=u.getAttribute("id1");if(p==pt1.g_id){var b=degree(y,n),v=b*Math.PI/180;180>b?b+=180:b-=180;var x={x:Number(pt1.x)+e,y:pt1.y-e},A=degree(y,x);180>A?A+=180:A-=180,b-=A,0>b&&(b=360+b),s={x:Number(y.x-g*Math.cos(v)),y:Number(y.y-g*Math.sin(v))},o="rotate("+b+","+c+","+d+")",u.setAttribute("transform",o);for(var _=0;_<t_count;_++){var l="tri["+_+"]",E=document.getElementById(l);if(null!=E){var B=E.getAttribute("id1"),w=E.getAttribute("id2");f==B&&p==w&&E.setAttribute("transform",o)}}var k=document.getElementById(pt1.g_id),C=s.x-pt1.x-e,N=s.y-pt1.y+e,o="translate("+C+","+N+")";k.setAttribute("transform",o)}}}if("undefined"!=typeof s)for(var a=0;a<itl_count;a++){var l="itl["+a+"]",u=document.getElementById(l);if(null!=u){var P,I,f=u.getAttribute("id1"),p=u.getAttribute("id2");f==pt1.g_id?(0==u.hasAttribute("old_x1")&&(P=Number(u.getAttribute("x1"))-e,u.setAttribute("old_x1",P)),0==u.hasAttribute("old_y1")&&(I=Number(u.getAttribute("y1"))+e,u.setAttribute("old_y1",I)),u.setAttribute("x1",s.x),u.setAttribute("y1",s.y)):p==pt1.g_id&&(0==u.hasAttribute("old_x2")&&(old_x2=Number(u.getAttribute("x2"))-e,u.setAttribute("old_x2",old_x2)),0==u.hasAttribute("old_y2")&&(old_y2=Number(u.getAttribute("y2"))+e,u.setAttribute("old_y2",old_y2)),u.setAttribute("x2",s.x),u.setAttribute("y2",s.y))}}"visible"==unpaired_electron_flag&&upair_electrons(!1),"visible"==lonepaired_electron_flag&&lpair_electrons(!1),"visible"==vacant_electron_flag&&vacant_electrons(!1)}}function captionAnimation(t){pt.x=t.clientX+clientXchange,pt.y=t.clientY+clientYchange;var e=svg.getScreenCTM(),r=e.inverse(),i=pt.matrixTransform(r);if(0!=capt_id){var n=document.getElementById(capt_id);n.setAttribute("x",i.x),n.setAttribute("y",i.y)}}function remove_attribute(){for(var t=0;t<count;t++){var e="g["+t+"]",r=document.getElementById(e);null!=r&&1==r.hasAttribute("transform")&&r.removeAttribute("transform")}for(var t=0;t<l_count;t++){var e="l["+t+"]",r=document.getElementById(e);if(null!=r){if(1==r.hasAttribute("transform")&&r.removeAttribute("transform"),1==r.hasAttribute("old_x1")){var i=r.getAttribute("old_x1");r.setAttribute("x1",i),r.removeAttribute("old_x1")}if(1==r.hasAttribute("old_x2")){var n=r.getAttribute("old_x2");r.setAttribute("x2",n),r.removeAttribute("old_x2")}if(1==r.hasAttribute("old_y1")){var o=r.getAttribute("old_y1");r.setAttribute("y1",o),r.removeAttribute("old_y1")}if(1==r.hasAttribute("old_y2")){var s=r.getAttribute("old_y2");r.setAttribute("y2",s),r.removeAttribute("old_y2")}}}for(var t=0;t<itl_count;t++){var e="itl["+t+"]",r=document.getElementById(e);if(null!=r){if(1==r.hasAttribute("transform")&&r.removeAttribute("transform"),1==r.hasAttribute("old_x1")){var i=r.getAttribute("old_x1");r.setAttribute("x1",i),r.removeAttribute("old_x1")}if(1==r.hasAttribute("old_x2")){var n=r.getAttribute("old_x2");r.setAttribute("x2",n),r.removeAttribute("old_x2")}if(1==r.hasAttribute("old_y1")){var o=r.getAttribute("old_y1");r.setAttribute("y1",o),r.removeAttribute("old_y1")}if(1==r.hasAttribute("old_y2")){var s=r.getAttribute("old_y2");r.setAttribute("y2",s),r.removeAttribute("old_y2")}}}for(var a=0;a<t_count;a++){var e="tri["+a+"]",l=document.getElementById(e);if(null!=l&&(1==l.hasAttribute("transform")&&l.removeAttribute("transform"),1==l.hasAttribute("old_points"))){var u=l.getAttribute("old_points");l.setAttribute("points",u),l.removeAttribute("old_points")}}}function interact_xy_change(t){for(var e=0;e<structure.length;e++)if("function"!=typeof structure[e].getFragmentVector){var r=structure[e].getX1(),i=structure[e].getX2(),n=structure[e].getY1(),o=structure[e].getY2(),s=r+"-"+n,a=i+"-"+o,l=t[s],u=t[a];"undefined"!=typeof l&&(l=String(l).split("-"),structure[e].setX1(l[0]),structure[e].setY1(l[1])),"undefined"!=typeof u&&(u=String(u).split("-"),structure[e].setX2(u[0]),structure[e].setY2(u[1]))}}function Fragment(){this.id="",this.title="",this.type="",this.formula="",this.revFormula="",this.smiles="",this.linkType="",this.skeletonTarget1="",this.skeletonTarget2="",this.sklCode="",this.sklPattern="",this.template="",this.orientation="",this.projection="",this.status="",this.frgNo="",this.x1=this.x2=0,this.y1=this.y2=0,this.atomVector=new Array}function drawMousePoint(t,e,r){pt.x=t.clientX+clientXchange,pt.y=t.clientY+clientYchange;var i=svg.getScreenCTM(),n=i.inverse(),o=pt.matrixTransform(n);if(1==!r)for(var s=0;s<count;s++){var a="t["+s+"]",l="g["+s+"]",u=document.getElementById(a);if(null!=u){var c=u.getAttribute("x"),d=u.getAttribute("y"),h=c,m=d;h-=o.x,m-=o.y;var g=Math.sqrt(h*h+m*m);if(8>=g){var y=collisionDetectAtomIndex(c,d);if(-1==y){console.log(atom),console.log(u);continue}var p=getStructureId(y),f="s"+p.i,b=atom[y].getElectronLinkVector(),v=0;for(j=0;j<b.length;j++)("uPair"==b[j].getElectronStatus()||"lPair"==b[j].getElectronStatus()||"vacant"==b[j].getElectronStatus())&&v++;return 1==e&&(curStrId=f),{x:Number(c),y:Number(d),id:a,g_id:l,frg_id:p.frgIndex,atm_id:y,str_id:f,xml_id:p,collision:!0,uPair:v}}}}var x=document.createElementNS(svgNS,"g"),A=2.7;x.id="g["+count+"]",x.setAttribute("shape-rendering","inherit"),x.setAttribute("pointer-events","all");var _=document.createElementNS(svgNS,"circle");_.id="c["+count+"]";var E=symbol.length-1;_.setAttribute("cx",o.x+A+E),_.setAttribute("cy",o.y-A);var B=3.5+1*(symbol.length-1);_.setAttribute("r",B),_.setAttribute("fill","white"),x.appendChild(_);var w=document.createElementNS(svgNS,"text");w.id="t["+count+"]",w.setAttribute("x",o.x),w.setAttribute("y",o.y),w.setAttribute("fill","red"),w.setAttribute("font-size","7px");var k=document.createTextNode(symbol),C=document.createElementNS(svgNS,"text");C.id="at["+count+"]",C.setAttribute("x",o.x-A),C.setAttribute("y",o.y-A),C.setAttribute("fill","rgb(0, 102, 255)"),C.setAttribute("font-size","4px");var N=document.createTextNode(""),P=document.createElementNS(svgNS,"text");P.id="at1["+count+"]",P.setAttribute("x",o.x+2*A),P.setAttribute("y",o.y-2*A),P.setAttribute("fill","red"),P.setAttribute("font-size","4px");var I=document.createTextNode(""),S=document.createElementNS(svgNS,"text");S.id="at2["+count+"]",S.setAttribute("x",o.x-A+1),S.setAttribute("y",o.y-3*A+1),S.setAttribute("fill","black"),S.setAttribute("font-size","4px");var M=document.createTextNode("");for(1==e&&(curStrId="s"+structure.length,structure[structure.length]=new Structure,structure[structure.length-1].setId(curStrId)),frg=createAtomFragment(symbol,curStrId,o),s=0;s<structure.length;s++)structure[s].getId()==curStrId&&structure[s].setFragment(frg);w.appendChild(k),x.setAttribute("str_id",curStrId),x.appendChild(w),C.appendChild(N),x.appendChild(C),P.appendChild(I),x.appendChild(P),S.appendChild(M),x.appendChild(S),svg.appendChild(x);var u=w.getBoundingClientRect();b=atom[count].getElectronLinkVector();var v=0;for(j=0;j<b.length;j++)("uPair"==b[j].getElectronStatus()||"lPair"==b[j].getElectronStatus()||"vacant"==b[j].getElectronStatus())&&v++;count++;var p=getStructureId(count-1);return{x:Number(o.x),y:Number(o.y),id:w.id,g_id:x.id,str_id:curStrId,frg_id:p.frgIndex,atm_id:count-1,xml_id:p,collision:!1,uPair:v}}function lineOverlap(t,e){for(i=0;i<l_count;i++){var r="l["+i+"]",n=document.getElementById(r);if(null!=n){t.x=Number(t.x),e.x=Number(e.x),t.y=Number(t.y),e.y=Number(e.y);var o=Number(n.getAttribute("x1")).toFixed(2),s=Number(n.getAttribute("y1")).toFixed(2),a=Number(n.getAttribute("x2")).toFixed(2),l=Number(n.getAttribute("y2")).toFixed(2);if(t.x.toFixed(2)==o&&t.y.toFixed(2)==s&&e.x.toFixed(2)==a&&e.y.toFixed(2)==l||t.x.toFixed(2)==a&&t.y.toFixed(2)==l&&e.x.toFixed(2)==o&&e.y.toFixed(2)==s)return!0}}return!1}function jsObjCollisionDetect(t){pt.x=t.clientX+clientXchange,pt.y=t.clientY+clientYchange;for(var e=svg.getScreenCTM(),r=e.inverse(),i=pt.matrixTransform(r),n=0;n<count;n++){var o="t["+n+"]",s="g["+n+"]",a=document.getElementById(o);if(null!=a){var l=a.getAttribute("x"),u=a.getAttribute("y"),c=l,d=u;c-=i.x,d-=i.y;var h=Math.sqrt(c*c+d*d);if(8>=h){var m=collisionDetectAtomIndex(l,u);if(-1==m){console.log(atom),console.log(a);continue}var g=getStructureId(m),y="s"+g.i,p=atom[m].getElectronLinkVector(),f=0;for(j=0;j<p.length;j++)("uPair"==p[j].getElectronStatus()||"lPair"==p[j].getElectronStatus()||"vacant"==p[j].getElectronStatus())&&f++;return{x:Number(l),y:Number(u),id:o,g_id:s,frg_id:g.frgIndex,atm_id:m,str_id:y,xml_id:g,collision:!0,uPair:f}}}}return{x:Number(i.x),y:Number(i.y),id:"",g_id:"",str_id:"",frg_id:"",atm_id:"",xml_id:"",collision:!1,uPair:2}}function drawAtom(t,e){var r=document.createElementNS(svgNS,"g"),i=2.7;r.id="g["+count+"]",r.setAttribute("shape-rendering","inherit"),r.setAttribute("pointer-events","all"),r.setAttribute("str_id",curStrId);var n=document.createElementNS(svgNS,"circle");n.id="c["+count+"]";var o=symbol.length-1;n.setAttribute("cx",t.x+i+o),n.setAttribute("cy",t.y-i);var s=3.5+1*(symbol.length-1);n.setAttribute("r",s),n.setAttribute("fill","white"),r.appendChild(n);var a=document.createElementNS(svgNS,"text");a.id="t["+count+"]",a.setAttribute("x",t.x),a.setAttribute("y",t.y),a.setAttribute("fill","red"),a.setAttribute("font-size","7px");var l=document.createTextNode(symbol);a.appendChild(l),r.appendChild(a);var u=document.createElementNS(svgNS,"text");u.id="at["+count+"]",u.setAttribute("x",t.x-i),u.setAttribute("y",t.y-i),u.setAttribute("fill","rgb(0, 102, 255)"),u.setAttribute("font-size","4px"),u.style.visibility=atom_position_visiblity;var c=document.createTextNode(e);u.appendChild(c),r.appendChild(u);var d=document.createElementNS(svgNS,"text");d.id="at1["+count+"]",d.setAttribute("x",t.x+2*i),d.setAttribute("y",t.y-2*i),d.setAttribute("fill","red"),d.setAttribute("font-size","4px");var h=document.createTextNode("");d.appendChild(h),r.appendChild(d);var m=document.createElementNS(svgNS,"text");m.id="at2["+count+"]",m.setAttribute("x",t.x-i+1),m.setAttribute("y",t.y-3*i+1),m.setAttribute("fill","black"),m.setAttribute("font-size","4px");var g=document.createTextNode("");return m.appendChild(g),r.appendChild(m),r}function drawLine(t,e,r){var i=document.createElementNS(svgNS,"line");return i.id="l["+l_count+"]",i.setAttribute("str_id",curStrId),i.setAttribute("x1",Number(t.x)+r),i.setAttribute("y1",t.y-r),i.setAttribute("x2",Number(e.x)+r),i.setAttribute("y2",e.y-r),i.setAttribute("stroke-linecap","round"),i.setAttribute("stroke","rgb(0,0,0)"),i.setAttribute("stroke-width",.75),svg.appendChild(i),l_count++,i.id}function drawChargeCount(){for(i=0;i<count;i++){var t="g["+i+"]",e=document.getElementById(t);if(null!=e){var r="";e.childNodes[3].childNodes[0].nodeValue=r}}for(i=0;i<count;i++)if(0!=Number(atom[i].getChargeCount())){var t="g["+collisionDetect(atom[i].getX(),atom[i].getY())+"]",e=document.getElementById(t);if(null!=e){var r=atom[i].getCharge()+atom[i].getChargeCount();e.childNodes[3].childNodes[0].nodeValue=r}}}function change_obj_color(){for(i=0;i<count;i++){var t="g["+i+"]",e=document.getElementById(t);null!=e&&("C"==e.childNodes[1].childNodes[0].nodeValue?(e.style.visibility="hidden",e.childNodes[1].setAttribute("fill","black")):e.childNodes[1].setAttribute("fill","black"))}}function draw_xml(t){var e,r=!1;if(0==t.x?(new_structure(!0),e=openXML.getElementsByTagName("structure"),r=!0):e=templateXML.getElementsByTagName("structure"),e.length>1&&0!=t.x)return Alert.render("Cannot load group of structures as template"),document.getElementById("s_content").style.cursor="default",void document.getElementById("s_content").removeEventListener("click",click_open_template);for(var i=count,n=0,o=0,s=[],a=0;a<e.length;a++){structure.push(new Structure),len=structure.length-1,_="s"+len,structure[len].setId(_);for(var l=e[a].getElementsByTagName("fragment"),u=0;u<l.length;u++){var c=Number(l[u].getAttribute("x1")),d=Number(l[u].getAttribute("x2")),h=Number(l[u].getAttribute("y1")),m=Number(l[u].getAttribute("y2"));if(0!=c||0!=h||0!=d||0!=m){fragment[frg_count]=new Fragment,_="s"+len+"-"+u,fragment[frg_count].setId(_),0==r&&(n=Number(c-t.x),o=Number(h-t.y),r=!0),c-=n,d-=n,h-=o,m-=o,fragment[frg_count].setX1(c.toFixed(2)),fragment[frg_count].setX2(d.toFixed(2)),fragment[frg_count].setY1(h.toFixed(2)),fragment[frg_count].setY2(m.toFixed(2)),fragment[frg_count].setTitle(l[u].getAttribute("title")),fragment[frg_count].setType(l[u].getAttribute("type")),fragment[frg_count].setFormula(l[u].getAttribute("formula")),fragment[frg_count].setOrientation(l[u].getAttribute("orientation")),fragment[frg_count].setSmiles(l[u].getAttribute("smiles"));for(var g=l[u].getElementsByTagName("atom"),y=0;y<g.length;y++){atom[count]=new Atom,_="s"+len+"-"+u+"-a"+y,atom[count].setId(_);var p=Number(g[y].getAttribute("x")),f=Number(g[y].getAttribute("y"));p-=n,f-=o,atom[count].setX(p.toFixed(2)),atom[count].setY(f.toFixed(2)),atom[count].setAtNo(g[y].getAttribute("atNo")),atom[count].setTitle(g[y].getAttribute("title")),atom[count].setSymbol(g[y].getAttribute("symbol")),atom[count].setCharge(g[y].getAttribute("charge")),atom[count].setChargeCount(g[y].getAttribute("chargeCount")),atom[count].setElectroNegativity(g[y].getAttribute("electroNegativity")),atom[count].setIsotopeLabel(g[y].getAttribute("isotopeLabel")),atom[count].setBlock(g[y].getAttribute("block")),atom[count].setHybridization(g[y].getAttribute("hybridization")),atom[count].setPartCharge(g[y].getAttribute("partcharge")),atom[count].setPartChargeVal(g[y].getAttribute("partChargeVal"));for(var b=g[y].getElementsByTagName("electronLink"),v=0,x=0;x<b.length;x++){var A=new ElectronLink;_="s"+len+"-"+u+"-a"+y+"e"+x,s[b[x].getAttribute("id")]=_,A.setId(_);var c=Number(b[x].getAttribute("x1")),d=Number(b[x].getAttribute("x2")),h=Number(b[x].getAttribute("y1")),m=Number(b[x].getAttribute("y2"));if(c-=n,d-=n,h-=o,m-=o,A.setX1(c.toFixed(2)),A.setX2(d.toFixed(2)),A.setY1(h.toFixed(2)),A.setY2(m.toFixed(2)),A.setTitle(b[x].getAttribute("title")),A.setType(b[x].getAttribute("type")),c==d&&h==m&&"bPair"==b[x].getAttribute("electronStatus"))A.setElectronStatus("uPair"),A.setPartCharge(0),A.setPartChargeVal(0),A.setCharge(0),A.setChargeCount(0);else{A.setElectronStatus(b[x].getAttribute("electronStatus")),A.setCharge(b[x].getAttribute("charge")),A.setAffinity(b[x].getAttribute("affinity")),A.setChargeCount(b[x].getAttribute("chargeCount")),A.setBond(b[x].getAttribute("bond")),A.setBondType(b[x].getAttribute("bondType")),A.setOrder(b[x].getAttribute("order")),A.setLinkStatus(b[x].getAttribute("linkStatus"));var _=b[x].getAttribute("target").split("-");if(_.length>2){_[0]=_[0].slice(1),_[0]=Number(_[0])-1,_[0]=0!=t.x?"s"+len:"s"+_[0],_[1]=Number(_[1])-1,_[1]=_[1];var E=_[2],B=_[2].indexOf("e");_[2]=_[2].slice(1,B),_[2]=Number(_[2])-1,_[2]="a"+_[2];var E=E.slice(B+1);E=Number(E)-1,E="e"+E,_=_[0]+"-"+_[1]+"-"+_[2]+E}else _=b[x].getAttribute("target");A.setTarget(_),A.setOrientation(b[x].getAttribute("orientation")),A.setProjection(b[x].getAttribute("projection")),A.setPriority(b[x].getAttribute("priority")),A.setGcCode(b[x].getAttribute("gcCode")),A.setPartCharge(b[x].getAttribute("partcharge")),A.setPartChargeVal(b[x].getAttribute("partChargeVal"))}var w=A.getPartCharge(),k=A.getPartChargeVal(),C=w+k;v+=Number(C),atom[count].setElectronLink(A)}0>v?(atom[count].setPartCharge("-"),atom[count].setPartChargeVal(Math.abs(v).toFixed(2))):set_charge>0?(atom[count].setPartCharge("+"),atom[count].setPartChargeVal(Math.abs(set_charge).toFixed(2))):(atom[count].setPartCharge(0),atom[count].setPartChargeVal(0)),fragment[frg_count].setAtom(atom[count++])}structure[len].setFragment(fragment[frg_count++])}}}if(0==t.x)var N=openXML.getElementsByTagName("interaction");else var N=templateXML.getElementsByTagName("interaction");for(var a=0;a<N.length;a++)structure.push(new Interact),len=structure.length-1,structure[len].setId(N[a].getAttribute("id")),structure[len].setX1(N[a].getAttribute("x1")),structure[len].setX2(N[a].getAttribute("x2")),structure[len].setY1(N[a].getAttribute("y1")),structure[len].setY2(N[a].getAttribute("y2")),structure[len].setTitle(N[a].getAttribute("title")),structure[len].setType(N[a].getAttribute("type")),structure[len].setSourceObject(N[a].getAttribute("sourceObject")),structure[len].setTargetObject(N[a].getAttribute("targetObject")),structure[len].setSourceId(s[N[a].getAttribute("sourceId")]),structure[len].setTargetId(s[N[a].getAttribute("targetId")]);count=i,0==t.x?draw_structure():draw_template(t)}function draw_structure(){count=0,l_count=0;for(var t=[],e=2.7,r=0;r<structure.length;r++)if("function"!=typeof structure[r].getFragmentVector){var i=structure[r].getX1(),n=structure[r].getX2(),o=structure[r].getY1(),s=structure[r].getY2(),a={x:Number(i),y:Number(o)},l={x:Number(n),y:Number(s)},u=document.createElementNS(svgNS,"line");u.id="itl["+itl_count+"]";var c=structure[r].getTargetId().split("-"),d=Number(c[0].substring(1,c[0].length)),h=Number(c[1]),m=Number(c[2].substring(1,c[2].indexOf("e"))),g=structure[d].getFragmentVector()[h].getAtomVector()[m].getSymbol(),y=g.length-1,p=structure[r].getTargetId().split("-"),f=Number(p[0].substring(1,p[0].length)),b=Number(p[1]),v=Number(p[2].substring(1,p[2].indexOf("e"))),x=structure[f].getFragmentVector()[b].getAtomVector()[v].getSymbol(),A=x.length-1;u.setAttribute("x1",Number(a.x)+e+y),u.setAttribute("y1",Number(a.y)-e),u.setAttribute("x2",Number(l.x)+e+A),u.setAttribute("y2",Number(l.y)-e),u.setAttribute("stroke-dasharray","1,1"),u.setAttribute("d","M5 20 l215 0"),u.setAttribute("stroke-width",.75),u.setAttribute("c_adjust1",y),u.setAttribute("c_adjust2",A),itl_count++;var _=structure[r].getType();"ion-ion"==_?u.setAttribute("stroke","Aqua"):"ion-dipole"==_?u.setAttribute("stroke","lime"):"dipole-dipole"==_?u.setAttribute("stroke","rgb(255, 102, 0)"):"HBond"==_&&u.setAttribute("stroke","Fuchsia"),svg.appendChild(u)}for(var r=0;r<structure.length;r++)if("function"==typeof structure[r].getFragmentVector)for(var E=structure[r].getFragmentVector(),B=0;B<E.length;B++)for(var w=E[B].getAtomVector(),k=0;k<w.length;k++){var C={x:Number(w[k].getX()),y:Number(w[k].getY())};if(0!=C.x||0!=C.y){for(var N=w[k].getElectronLinkVector(),P=-1.5,I=!1,S="hidden",M=0;M<N.length;M++){var T=N[M].getId();if("undefined"==typeof t[T]){("uPair"==N[M].getElectronStatus()||"lPair"==N[M].getElectronStatus()||"vacant"==N[M].getElectronStatus())&&(S="visible");var V=N[M].getOrder(),i=N[M].getX1(),n=N[M].getX2(),o=N[M].getY1(),s=N[M].getY2();if(i!=n||o!=s){var y=w[k].getSymbol().length-1,a={x:Number(i),y:Number(o)};a.x+=y;var p=N[M].getTarget().split("-"),f=Number(p[0].substring(1,p[0].length)),b=Number(p[1]),v=Number(p[2].substring(1,p[2].indexOf("e"))),x=structure[f].getFragmentVector()[b].getAtomVector()[v].getSymbol(),A=x.length-1,l={x:Number(n),y:Number(s)};l.x+=A;var L=N[M].getBond();if((-1!=L.indexOf("pi")||-1!=L.indexOf("dative"))&&"single"!=V){var F=Math.atan2(a.y-l.y,a.x-l.x)-Math.PI/2;a.x=a.x-P*Math.cos(F),a.y=a.y-P*Math.sin(F),l.x=l.x-P*Math.cos(F),l.y=l.y-P*Math.sin(F),P=-1*P}var X=drawLine(a,l,e),D="s"+r;document.getElementById(X).setAttribute("str_id",D);var R=N[M].getTarget();t[R]=!0,("double"==V||"triple"==V)&&(I=!0)}}}if(symbol=w[k].getSymbol(),w.length>1){var $=drawAtom(C,B+1);$.setAttribute("str_id",D),"C"==$.childNodes[1].childNodes[0].nodeValue&&"hidden"==S?($.style.visibility="hidden",$.childNodes[1].setAttribute("fill","black")):"hidden"==S&&$.childNodes[1].setAttribute("fill","black"),svg.appendChild($)}else{var $=drawAtom(C,"");$.setAttribute("str_id",D),"C"==$.childNodes[1].childNodes[0].nodeValue&&"hidden"==S?($.style.visibility="hidden",$.childNodes[1].setAttribute("fill","black")):"hidden"==S&&$.childNodes[1].setAttribute("fill","black"),svg.appendChild($)}count++}}initial_state=copyStructure(),set_line_ids(),set_itline_ids(),drawChargeCount()}function draw_template(t){for(var e,r,i=[],n=2.7,o=structure[structure.length-1].getFragmentVector(),s=!1,a=0;a<o.length;a++)for(var l=o[a].getAtomVector(),u=0;u<l.length;u++){var c=Number(l[u].getX()),d=Number(l[u].getY());0==s&&(e=Number(c-t.x),r=Number(d-t.y),s=!0);var h={x:Number(c-e),y:Number(d-r)};if(0!=h.x||0!=h.y){for(var m=l[u].getElectronLinkVector(),g=-1.5,y=!1,p="hidden",f=0;f<m.length;f++){var b=m[f].getId();if("undefined"==typeof i[b]){var v=m[f].getOrder();("uPair"==m[f].getElectronStatus()||"lPair"==m[f].getElectronStatus()||"vacant"==m[f].getElectronStatus())&&(p="visible");var x=m[f].getX1(),A=m[f].getX2(),_=m[f].getY1(),E=m[f].getY2();if(x!=A||_!=E){var B=l[u].getSymbol().length-1,w={x:Number(x-e),y:Number(_-r)};w.x+=B;var k=m[f].getTarget().split("-"),C=Number(k[1]),N=Number(k[2].substring(1,k[2].indexOf("e"))),P=o[C].getAtomVector()[N].getSymbol(),I=P.length-1,S={x:Number(A-e),y:Number(E-r)};S.x+=I;var M=m[f].getBond();if((-1!=M.indexOf("pi")||-1!=M.indexOf("dative"))&&"single"!=v){var T=Math.atan2(w.y-S.y,w.x-S.x)-Math.PI/2;w.x=w.x-g*Math.cos(T),w.y=w.y-g*Math.sin(T),S.x=S.x-g*Math.cos(T),S.y=S.y-g*Math.sin(T),g=-1*g}var V=drawLine(w,S,n),L="s"+(structure.length-1);document.getElementById(V).setAttribute("str_id",L);var F=m[f].getTarget();i[F]=!0,("double"==v||"triple"==v)&&(y=!0)}}}if(symbol=l[u].getSymbol(),l.length>1){var X=drawAtom(h,a+1);X.setAttribute("str_id",L),"C"==X.childNodes[1].childNodes[0].nodeValue&&"hidden"==p?(X.style.visibility="hidden",X.childNodes[1].setAttribute("fill","black")):"hidden"==p&&X.childNodes[1].setAttribute("fill","black"),svg.appendChild(X)}else{var X=drawAtom(h,"");X.setAttribute("str_id",L),"C"==X.childNodes[1].childNodes[0].nodeValue&&"hidden"==p?(X.style.visibility="hidden",X.childNodes[1].setAttribute("fill","black")):"hidden"==p&&X.childNodes[1].setAttribute("fill","black"),svg.appendChild(X)}count++}}set_line_ids(),drawChargeCount()}function set_line_ids(){for(var t=2.7,e=0;e<l_count;e++){var r="l["+e+"]",i=document.getElementById(r);if(null!=i&&1!=i.hasAttribute("id1")){var n=Number(i.getAttribute("x1"))-t,o=Number(i.getAttribute("y1"))+t,s=Number(i.getAttribute("x2"))-t,a=Number(i.getAttribute("y2"))+t,l=collisionDetect(n,o),u=1.5;if(-1==l){var c=Math.atan2(o-a,n-s)-Math.PI/2;if(n-=u*Math.cos(c),o-=u*Math.sin(c),s-=u*Math.cos(c),a-=u*Math.sin(c),l=collisionDetect(n,o),-1==l){u=-3;var c=Math.atan2(o-a,n-s)-Math.PI/2;n-=u*Math.cos(c),o-=u*Math.sin(c),s-=u*Math.cos(c),a-=u*Math.sin(c),l=collisionDetect(n,o)}}var d="g["+l+"]";i.setAttribute("id1",d);var h="g["+collisionDetect(s,a)+"]";i.setAttribute("id2",h)}}}function set_itline_ids(){for(var t=0;t<itl_count;t++){var e="itl["+t+"]",r=2.7,i=0,n=0,o=document.getElementById(e);if(null!=o&&1!=o.hasAttribute("id1")){1==o.hasAttribute("c_adjust1")&&(i=Number(o.getAttribute("c_adjust1"))),1==o.hasAttribute("c_adjust2")&&(n=Number(o.getAttribute("c_adjust2")));var s=Number(o.getAttribute("x1"))-r-i,a=Number(o.getAttribute("y1"))+r,l=Number(o.getAttribute("x2"))-r-n,u=Number(o.getAttribute("y2"))+r,c=getStructureId(collisionDetect(s,a)),d="g["+c.k+"]",h="s"+c.i;o.setAttribute("id1",d),o.setAttribute("str_id1",h);var m=getStructureId(collisionDetect(l,u)),g="g["+m.k+"]",y="s"+m.i;o.setAttribute("id2",g),o.setAttribute("str_id2",y)}}}function minXminY(){for(var t=(document.getElementById("mySvg"),1e5),e=1e5,r=0,i=0,n=0;n<count;n++){var o="c["+n+"]",s=document.getElementById(o);if(null!=s){var a=Number(s.getAttribute("cx")),l=Number(s.getAttribute("cy"));t>a&&(t=a),a>r&&(r=a),e>l&&(e=l),l>i&&(i=l)}var o="t["+n+"]",s=document.getElementById(o);if(null!=s){var a=Number(s.getAttribute("x")),l=Number(s.getAttribute("y"));t>a&&(t=a),a>r&&(r=a),e>l&&(e=l),l>i&&(i=l)}var o="at["+n+"]",s=document.getElementById(o);if(null!=s){var a=Number(s.getAttribute("x")),l=Number(s.getAttribute("y"));t>a&&(t=a),a>r&&(r=a),e>l&&(e=l),l>i&&(i=l)}var o="at1["+n+"]",s=document.getElementById(o);if(null!=s){var a=Number(s.getAttribute("x")),l=Number(s.getAttribute("y"));t>a&&(t=a),a>r&&(r=a),e>l&&(e=l),l>i&&(i=l)}var o="at2["+n+"]",s=document.getElementById(o);if(null!=s){var a=Number(s.getAttribute("x")),l=Number(s.getAttribute("y"));t>a&&(t=a),a>r&&(r=a),e>l&&(e=l),l>i&&(i=l)}}for(var n=0;n<l_count;n++){var o="l["+n+"]",s=document.getElementById(o);if(null!=s){var a=Number(s.getAttribute("x1")),l=Number(s.getAttribute("y1"));t>a&&(t=a),a>r&&(r=a),e>l&&(e=l),l>i&&(i=l);var a=Number(s.getAttribute("x2")),l=Number(s.getAttribute("y2"));t>a&&(t=a),a>r&&(r=a),e>l&&(e=l),l>i&&(i=l)}}for(var n=0;n<itl_count;n++){var o="itl["+n+"]",s=document.getElementById(o);if(null!=s){var a=Number(s.getAttribute("x1")),l=Number(s.getAttribute("y1"));t>a&&(t=a),a>r&&(r=a),e>l&&(e=l),l>i&&(i=l);var a=Number(s.getAttribute("x2")),l=Number(s.getAttribute("y2"));t>a&&(t=a),a>r&&(r=a),e>l&&(e=l),l>i&&(i=l)}}for(var n=0;n<arrow_count;n++){var o="arw_st["+n+"]",s=document.getElementById(o);if(null!=s){var a=Number(s.getAttribute("x1")),l=Number(s.getAttribute("y1"));t>a&&(t=a),a>r&&(r=a),e>l&&(e=l),l>i&&(i=l);var a=Number(s.getAttribute("x2")),l=Number(s.getAttribute("y2"));t>a&&(t=a),a>r&&(r=a),e>l&&(e=l),l>i&&(i=l)}var o="arw_up["+n+"]",s=document.getElementById(o);if(null!=s){var a=Number(s.getAttribute("x1")),l=Number(s.getAttribute("y1"));t>a&&(t=a),a>r&&(r=a),e>l&&(e=l),l>i&&(i=l);var a=Number(s.getAttribute("x2")),l=Number(s.getAttribute("y2"));t>a&&(t=a),a>r&&(r=a),e>l&&(e=l),l>i&&(i=l)}var o="arw_bw["+n+"]",s=document.getElementById(o);if(null!=s){var a=Number(s.getAttribute("x1")),l=Number(s.getAttribute("y1"));t>a&&(t=a),a>r&&(r=a),e>l&&(e=l),l>i&&(i=l);var a=Number(s.getAttribute("x2")),l=Number(s.getAttribute("y2"));t>a&&(t=a),a>r&&(r=a),e>l&&(e=l),l>i&&(i=l)}}for(var n=0;n<rev_arrow_count;n++){var o="rarw_st1["+n+"]",s=document.getElementById(o);if(null!=s){var a=Number(s.getAttribute("x1")),l=Number(s.getAttribute("y1"));t>a&&(t=a),a>r&&(r=a),e>l&&(e=l),l>i&&(i=l);var a=Number(s.getAttribute("x2")),l=Number(s.getAttribute("y2"));t>a&&(t=a),a>r&&(r=a),e>l&&(e=l),l>i&&(i=l)}var o="rarw_up["+n+"]",s=document.getElementById(o);if(null!=s){var a=Number(s.getAttribute("x1")),l=Number(s.getAttribute("y1"));t>a&&(t=a),a>r&&(r=a),e>l&&(e=l),l>i&&(i=l);var a=Number(s.getAttribute("x2")),l=Number(s.getAttribute("y2"));t>a&&(t=a),a>r&&(r=a),e>l&&(e=l),l>i&&(i=l)}var o="rarw_st2["+n+"]",s=document.getElementById(o);if(null!=s){var a=Number(s.getAttribute("x1")),l=Number(s.getAttribute("y1"));t>a&&(t=a),a>r&&(r=a),e>l&&(e=l),l>i&&(i=l);var a=Number(s.getAttribute("x2")),l=Number(s.getAttribute("y2"));t>a&&(t=a),a>r&&(r=a),e>l&&(e=l),l>i&&(i=l)}var o="rarw_bw["+n+"]",s=document.getElementById(o);if(null!=s){var a=Number(s.getAttribute("x1")),l=Number(s.getAttribute("y1"));t>a&&(t=a),a>r&&(r=a),e>l&&(e=l),l>i&&(i=l);var a=Number(s.getAttribute("x2")),l=Number(s.getAttribute("y2"));t>a&&(t=a),a>r&&(r=a),e>l&&(e=l),l>i&&(i=l)}}for(var n=0;n<capt_count;n++){var o="capt["+n+"]",s=document.getElementById(o);if(null!=s){var a=Number(s.getAttribute("x")),l=Number(s.getAttribute("y"));t>a&&(t=a),a>r&&(r=a),e>l&&(e=l),l>i&&(i=l)}}for(var n=0;n<sign_count;n++){var o="sign["+n+"]",s=document.getElementById(o);if(null!=s){var a=Number(s.getAttribute("x")),l=Number(s.getAttribute("y"));t>a&&(t=a),a>r&&(r=a),e>l&&(e=l),l>i&&(i=l)}}return{minx:t,miny:e,maxx:r,maxy:i}}function variable_init(){loop=!1,bond_status_flag=!1,atom=new Array,fragment=new Array,structure=new Array,templateXML="",pt1={x:0,y:0,id:"",g_id:""},svg.id="mySvg",symbol="",itl_count=0,sign_count=0,cursor_flag=!1,unpaired_electron_flag="hidden",lonepaired_electron_flag="hidden",vacant_electron_flag="hidden",count=0,l_count=0,arrow_count=0,rev_arrow_count=0,grid_set=!1,t_count=0,frg_count=0,st_count=0,toSkip=[],interact_flag="",atom_position_visiblity="hidden",undo_redo_flag=!1,plane_projection_flag="",move_structure_flag="",initial_state=new Array,bridge_stack_arr=new Array,undo_stack=new Array,redo_stack=new Array,undo_stack_jsobj=new Array,redo_stack_jsobj=new Array,skeletonFragmentXML="",skeleton=new Array,curStrId="",skeletonFlag=!1,bond="single",bondCount=1,bridgeCount=0,deleteCount=0,capt_count=0,bridgeAtom=new Array,bridgeStart="",animline=document.createElementNS(svgNS,"line"),uPair_svg=document.createElementNS(svgNS,"g"),mousemove=!1,animline.id="anim",svg.appendChild(animline),svg.appendChild(uPair_svg)}function st(t){variable_init(),login_set=t,document.getElementById("s_content").appendChild(svg);var e=document.getElementById("mySvg");e.setAttribute("width","100%"),e.setAttribute("height","100%"),e.setAttribute("version","1.1"),e.setAttribute("font-weight","bold"),e.setAttribute("xmlns","http://www.w3.org/2000/svg"),e.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),e.setAttribute("xml:space","preserve"),atomFragmentListXML=loadXMLDoc("xml/AtomFragmentList.xml"),isotopeOwl=loadXMLDoc("xml/PTableOwl.owl"),threeMemberedRing=loadXMLDoc("xml/ThreeMemberedRing.xml"),fourMemberedRing=loadXMLDoc("xml/FourMemberedRing.xml"),fiveMemberedRing=loadXMLDoc("xml/FiveMemberedRing.xml"),sixMemberedRing=loadXMLDoc("xml/SixMemberedRing.xml"),sevenMemberedRing=loadXMLDoc("xml/SevenMemberedRing.xml"),eightMemberedRing=loadXMLDoc("xml/EightMemberedRing.xml"),benzeneRing=loadXMLDoc("xml/BenzeneRing.xml"),skeleton[0]=loadXMLDoc("xml/OneMemberSkeleton.xml"),skeleton[1]=loadXMLDoc("xml/TwoMemberSkeleton.xml"),skeleton[2]=loadXMLDoc("xml/ThreeMemberSkeleton.xml"),skeleton[3]=loadXMLDoc("xml/FourMemberSkeleton.xml"),skeleton[4]=loadXMLDoc("xml/FiveMemberSkeleton.xml"),oneMemberSkeleton=skeleton[0],twoMemberSkeleton=skeleton[1],threeMemberSkeleton=skeleton[2],strGrp=new StructureGroup,strGrp.setId("s"),strGrp.setStructureVector(structure),resize()
}function resize(){var t=$(window).width(),e=$(window).height(),r=t/4*1.75,i=e/5*1.75,n="0 0 "+Math.floor(r)+" "+Math.floor(i),o=document.getElementById("mySvg");o.setAttribute("viewBox",n),t=Math.floor(t/30)-5,$("button").css("width",t),$(".splbutton").css("width","auto"),-1!=document.getElementById("login_btn").innerHTML.indexOf("Login")?(display_menu("#t_login"),display_menu("#t_login")):(display_menu("#t_logged"),display_menu("#t_logged"))}function display_menu(t){if($(".menu").css("display","none"),$(".menu").css("z-index","-1"),("#t_login"==t||"#t_logged"==t)&&"1"==$(t).css("z-index"))return $(".menu_login").css("display","none"),$(".menu_login").css("z-index","-1"),document.getElementById("login_btn").innerHTML=-1!=document.getElementById("login_btn").innerHTML.indexOf("Login")?"Login&#x25BC":"Welcome&#x25BC",document.getElementById("txthnt").innerHTML="",void $("#login").removeAttr("style");if($(t).css("display","table"),$(t).css("z-index","1"),"#t_file"==t){var e=document.getElementById("file").getBoundingClientRect();r=e.left+"px",height=e.bottom-1+"px",$(t).css("top",height),$(t).css("left",r),$("#file").css("background","linear-gradient(to top, rgba(233,245,247,1) 0%,rgba(233,245,247,1) 7%,rgba(233,245,247,1) 12%,rgba(254,254,254,1) 12%,rgba(237,243,247,1) 30%,rgba(215,228,237,1) 54%,rgba(206,219,232,1) 75%,rgba(196,208,226,1) 100%)")}if("#t_caption"==t){var e=document.getElementById("caption").getBoundingClientRect();r=e.left+"px",height=e.bottom-1+"px",$(t).css("top",height),$(t).css("left",r),$("#caption").css("background","linear-gradient(to top, rgba(233,245,247,1) 0%,rgba(233,245,247,1) 7%,rgba(233,245,247,1) 12%,rgba(254,254,254,1) 12%,rgba(237,243,247,1) 30%,rgba(215,228,237,1) 54%,rgba(206,219,232,1) 75%,rgba(196,208,226,1) 100%)")}if("#t_template"==t){var e=document.getElementById("template").getBoundingClientRect();r=e.left+"px",height=e.bottom-1+"px",$(t).css("top",height),$(t).css("left",r),$("#template").css("background","linear-gradient(to top, rgba(233,245,247,1) 0%,rgba(233,245,247,1) 7%,rgba(233,245,247,1) 12%,rgba(254,254,254,1) 12%,rgba(237,243,247,1) 30%,rgba(215,228,237,1) 54%,rgba(206,219,232,1) 75%,rgba(196,208,226,1) 100%)")}if("#t_login"==t||"#t_logged"==t){var e;-1!=document.getElementById("login_btn").innerHTML.indexOf("Login")?(document.getElementById("login_btn").innerHTML="Login&#x25B2",e=document.getElementById("t_login").getBoundingClientRect()):(document.getElementById("login_btn").innerHTML="Welcome&#x25B2",e=document.getElementById("t_logged").getBoundingClientRect());var r=$(window).width()-e.right+e.left-1;r+="px";var e=document.getElementById("login").getBoundingClientRect();height=e.bottom-1+"px",$(t).css("top",height),$(t).css("left",r),$("#login").css("background","linear-gradient(to top, rgba(233,245,247,1) 0%,rgba(233,245,247,1) 7%,rgba(233,245,247,1) 12%,rgba(254,254,254,1) 12%,rgba(237,243,247,1) 30%,rgba(215,228,237,1) 54%,rgba(206,219,232,1) 75%,rgba(196,208,226,1) 100%)")}}function hide_menu(){$(".menu").css("display","none"),$(".menu").css("z-index","-1"),$("#file").css("background","transparent"),$("#caption").css("background","transparent"),$("#template").css("background","transparent")}function atomButton(t,e,r){deleteBridge(),skeletonFlag=!1,bondCount=1,eventClear();var i="#"+t;if(1==r)var n="url('images/"+t+".png'), auto";else var n="url('images/cursor.png'), auto";if(cursor_flag!=t)document.getElementById("s_content").style.cursor=n,document.getElementById("s_content").addEventListener("mousedown",line),cursor_flag=t,symbol=e,$("button").css("background-image",""),$(i).css("background-image","linear-gradient(to bottom, #9E9E9E 5%, #f9f9f9 100%)");else{document.getElementById("s_content").style.cursor="default",document.getElementById("s_content").removeEventListener("mousedown",line),document.getElementById("s_content").removeEventListener("mousemove",msmove),document.getElementById("s_content").removeEventListener("mouseup",msup),symbol="";var i="#"+cursor_flag;cursor_flag=!1,$(i).css("background-image","")}}function bondSkeletonButton(t,e,r){deleteBridge(),bondCount=r,eventClear();var i="#"+t,n="url('images/"+t+".png'), auto";if(cursor_flag!=t)document.getElementById("s_content").style.cursor=n,document.getElementById("s_content").addEventListener("mousedown",bond_skeleton_msdown),cursor_flag=t,symbol=e,skeletonFlag=!0,$("button").css("background-image",""),$(i).css("background-image","linear-gradient(to bottom, #9E9E9E 5%, #f9f9f9 100%)");else{document.getElementById("s_content").style.cursor="default",document.getElementById("s_content").removeEventListener("mousedown",bond_skeleton_msdown),document.getElementById("s_content").removeEventListener("mousemove",bond_skeleton_msmove),document.getElementById("s_content").removeEventListener("mouseup",bond_skeleton_msup),symbol="",skeletonFlag=!1;var i="#"+cursor_flag;cursor_flag=!1,$(i).css("background-image","")}}function ringButton(t,e,r){deleteBridge(),bondCount=1,skeletonFlag=!1,skeletonFragmentXML=r,eventClear();var i="#"+t,n="url('images/"+t+".png'), auto";if(cursor_flag!=t)document.getElementById("s_content").style.cursor=n,document.getElementById("s_content").addEventListener("mousedown",ring_line),cursor_flag=t,symbol=e,$("button").css("background-image",""),$(i).css("background-image","linear-gradient(to bottom, #9E9E9E 5%, #f9f9f9 100%)");else{document.getElementById("s_content").style.cursor="default",document.getElementById("s_content").removeEventListener("mousedown",ring_line),document.getElementById("s_content").removeEventListener("mousemove",ring_msmove),document.getElementById("s_content").removeEventListener("mouseup",ring_msup),symbol="";var i="#"+cursor_flag;cursor_flag=!1,$(i).css("background-image","")}}function bridgeButton(t,e,r,i){deleteBridge(),bondCount=1,bridgeCount=i,skeletonFlag=!1,skeletonFragmentXML=r,eventClear();var n="#"+t,o="url('images/"+t+".png'), auto";if(cursor_flag!=t)document.getElementById("s_content").style.cursor=o,document.getElementById("s_content").addEventListener("mousedown",bridge_line),cursor_flag=t,symbol=e,$("button").css("background-image",""),$(n).css("background-image","linear-gradient(to bottom, #9E9E9E 5%, #f9f9f9 100%)");else{document.getElementById("s_content").style.cursor="default",document.getElementById("s_content").removeEventListener("mousedown",bridge_line),document.getElementById("s_content").removeEventListener("mousemove",bridge_msmove),document.getElementById("s_content").removeEventListener("mouseup",bridge_msup),symbol="";var n="#"+cursor_flag;cursor_flag=!1,$(n).css("background-image","")}}function undo(){if(deleteBridge(),skeletonFlag=!1,0!=undo_stack.length){undo_redo_flag=!0;var t=undo_stack.pop(),e=new Array,r=(new Array,new Array);if(0!=t.length)if("move"!=t[0]&&"orient"!=t[0]&&"atom_replace"!=t[0])if("object"==typeof t[0]){if(t[0].hasAttribute("str_id")&&!t[0].hasAttribute("skip")){var i=t[0].getAttribute("str_id").slice(1);toSkip[i]="not skip"}for(var n=0;n<t.length;n++){t[n].hasAttribute("str_id1")&&find_interact(t[n],"not skip");var o=t[n].getAttribute("id");-1!=o.indexOf("l")&&(r.push(t[n].getAttribute("id1")),r.push(t[n].getAttribute("id2"))),-1!=o.indexOf("tri")&&(r.push(t[n].getAttribute("id1")),r.push(t[n].getAttribute("id2"))),svg.appendChild(t[n]),e.push(o)}for(var n=0;n<r.length;n++){var s=document.getElementById(r[n]);svg.removeChild(s),svg.appendChild(s)}}else for(var n=0;n<t.length;n++){var s=document.getElementById(t[n]);-1!=t[n].indexOf("g")&&count--,-1!=t[n].indexOf("l")&&l_count--,-1!=t[n].indexOf("itl")&&itl_count--,e.push(s),svg.removeChild(s)}else if("atom_replace"==t[0]){var s=t[1];e.push("atom_replace"),e.push(s),e.push(s.childNodes[1].childNodes[0].nodeValue),s.childNodes[1].childNodes[0].nodeValue=t[2]}else if("move"==t[0]){var a=move_structure_flag;move_structure_flag=t[3],toMove(t[1],t[2],!0),move_structure_flag=a,e=t}else toOrient(t[1],t[2]),e=t;redo_stack.push(e)}if(0!=undo_stack_jsobj.length){var t=undo_stack_jsobj.pop(),l=undo_stack_jsobj.length;0!=l?(structure=new Array,structure=undo_stack_jsobj[l-1]):(structure=new Array,structure=initial_state),redo_stack_jsobj.push(t),createNewFragments()}drawChargeCount(),"visible"==unpaired_electron_flag&&upair_electrons(!1),"visible"==lonepaired_electron_flag&&lpair_electrons(!1),"visible"==vacant_electron_flag&&vacant_electrons(!1)}function redo(){if(deleteBridge(),skeletonFlag=!1,0!=redo_stack.length){undo_redo_flag=!0;var t=redo_stack.pop(),e=new Array,r=new Array;if(0!=t.length)if("move"!=t[0]&&"orient"!=t[0]&&"atom_replace"!=t[0])if("object"!=typeof t[0]){if(document.getElementById(t[0]).hasAttribute("str_id")&&!document.getElementById(t[0]).hasAttribute("skip")){var i=document.getElementById(t[0]).getAttribute("str_id").slice(1);toSkip[i]="skip"}for(var n=0;n<t.length;n++){var o=document.getElementById(t[n]);e.push(o),svg.removeChild(o),o.hasAttribute("str_id1")&&find_interact(o,"skip")}}else{for(var n=0;n<t.length;n++){svg.appendChild(t[n]);var s=t[n].getAttribute("id");-1!=s.indexOf("l")&&(r.push(t[n].getAttribute("id1")),r.push(t[n].getAttribute("id2")),l_count++),-1!=s.indexOf("tri")&&(r.push(t[n].getAttribute("id1")),r.push(t[n].getAttribute("id2"))),-1!=s.indexOf("g")&&count++,-1!=s.indexOf("itl")&&(r.push(t[n].getAttribute("id1")),r.push(t[n].getAttribute("id2")),itl_count++),e.push(s)}for(var n=0;n<r.length;n++){var o=document.getElementById(r[n]);svg.removeChild(o),svg.appendChild(o)}}else if("atom_replace"==t[0]){var o=t[1];e.push("atom_replace"),e.push(o),e.push(o.childNodes[1].childNodes[0].nodeValue),o.childNodes[1].childNodes[0].nodeValue=t[2]}else if("move"==t[0]){var a=move_structure_flag;move_structure_flag=t[3],toMove(t[2],t[1],!0),move_structure_flag=a,e=t}else toOrient(t[2],t[1]),e=t;undo_stack.push(e)}if(0!=redo_stack_jsobj.length){var t=redo_stack_jsobj.pop();structure=new Array,structure=t,createNewFragments(),undo_stack_jsobj.push(t)}drawChargeCount(),"visible"==unpaired_electron_flag&&upair_electrons(!1),"visible"==lonepaired_electron_flag&&lpair_electrons(!1),"visible"==vacant_electron_flag&&vacant_electrons(!1)}function delete_structure(){deleteBridge(),skeletonFlag=!1,eventClear();var t="#delete_structure",e="url('images/delete_structure.png'), auto";"delete_structure"!=cursor_flag?(document.getElementById("s_content").style.cursor=e,document.getElementById("s_content").addEventListener("click",event_delete_structure),cursor_flag="delete_structure",symbol="C",$("button").css("background-image",""),$(t).css("background-image","linear-gradient(to bottom, #9E9E9E 5%, #f9f9f9 100%)")):(document.getElementById("s_content").style.cursor="default",document.getElementById("s_content").removeEventListener("click",event_delete_structure),symbol="",cursor_flag=!1,$(t).css("background-image",""))}function implicit_carbon(){for(deleteBridge(),skeletonFlag=!1,i=0;i<count;i++){var t="g["+i+"]",e=document.getElementById(t);null!=e&&"C"==e.childNodes[1].childNodes[0].nodeValue&&"black"==e.childNodes[1].getAttribute("fill")&&(e.style.visibility="hidden"==e.style.visibility?"visible":"hidden")}}function move(t){deleteBridge(),skeletonFlag=!1,eventClear(),move_structure_flag=t;var e="#"+t,r="url('images/"+t+".png'), auto";if(cursor_flag!=t)document.getElementById("s_content").style.cursor=r,document.getElementById("s_content").addEventListener("mousedown",str_grp_down),cursor_flag=t,symbol="",$("button").css("background-image",""),$(e).css("background-image","linear-gradient(to bottom, #9E9E9E 5%, #f9f9f9 100%)");else{document.getElementById("s_content").style.cursor="default",document.getElementById("s_content").removeEventListener("mousedown",str_grp_down),document.getElementById("s_content").removeEventListener("mousemove",str_grp_move),document.getElementById("s_content").removeEventListener("mouseup",str_grp_up),symbol="";var e="#"+cursor_flag;cursor_flag=!1,$(e).css("background-image","")}}function KeyPress(t){var e=window.event?event:t;90==e.keyCode&&e.ctrlKey&&undo(),89==e.keyCode&&e.ctrlKey&&redo()}function plane_projection(t){deleteBridge(),skeletonFlag=!1,eventClear(),plane_projection_flag=t;var e="#"+t,r="url('images/"+t+".png'), auto";if(cursor_flag!=t)document.getElementById("s_content").style.cursor=r,document.getElementById("s_content").addEventListener("click",event_plane_projection),cursor_flag=t,symbol="",$("button").css("background-image",""),$(e).css("background-image","linear-gradient(to bottom, #9E9E9E 5%, #f9f9f9 100%)");else{document.getElementById("s_content").style.cursor="default",document.getElementById("s_content").removeEventListener("click",event_plane_projection),symbol="";var e="#"+cursor_flag;cursor_flag=!1,$(e).css("background-image","")}}function orientation(){deleteBridge(),skeletonFlag=!1,eventClear();var t="#Change_orientation";"Change_orientation"!=cursor_flag?(document.getElementById("s_content").style.cursor="url('images/Change_orientation.png'), auto",document.getElementById("s_content").addEventListener("mousedown",change_orientation_down),cursor_flag="Change_orientation",symbol="",$("button").css("background-image",""),$(t).css("background-image","linear-gradient(to bottom, #9E9E9E 5%, #f9f9f9 100%)")):(document.getElementById("s_content").style.cursor="default",document.getElementById("s_content").removeEventListener("mousedown",change_orientation_down),document.getElementById("s_content").removeEventListener("mousemove",change_orientation_move),document.getElementById("s_content").removeEventListener("mouseup",change_orientation_up),symbol="",cursor_flag=!1,$(t).css("background-image",""))}function upair_electrons(t){for(deleteBridge(),skeletonFlag=!1,1==t&&(unpaired_electron_flag="hidden"==unpaired_electron_flag?"visible":"hidden"),i=0;i<count;i++){var e="g["+i+"]",r=document.getElementById(e);if(null!=r)for(;5!=r.childNodes.length;)r.removeChild(r.lastChild)}if("hidden"!=unpaired_electron_flag)for(lonepaired_electron_flag="hidden",vacant_electron_flag="hidden",i=0;i<count;i++){var n=atom[i].getElectronLinkVector(),o=3,s=6,a=2.5,l=.5,u=1.5,c=Number(atom[i].getX()),d=Number(atom[i].getY()),e="g["+collisionDetect(c,d)+"]";if("g[-1]"!=e){var r=document.getElementById(e);if(null!=r){var c=c+o,d=d-o,h=0;for(j=0;j<n.length;j++)if("uPair"==n[j].getElectronStatus()){if(h++,1==h){var m=document.createElementNS(svgNS,"circle");m.setAttribute("cx",c-s),m.setAttribute("cy",d),m.setAttribute("r",a),m.setAttribute("fill","rgb(92, 230, 230)"),r.appendChild(m);var m=document.createElementNS(svgNS,"circle");m.setAttribute("cx",c-s),m.setAttribute("cy",d+u),m.setAttribute("r",l),m.setAttribute("fill","black"),r.appendChild(m)}if(2==h){var m=document.createElementNS(svgNS,"circle");m.setAttribute("cx",c),m.setAttribute("cy",d-s),m.setAttribute("r",a),m.setAttribute("fill","rgb(92, 230, 230)"),r.appendChild(m);var m=document.createElementNS(svgNS,"circle");m.setAttribute("cx",c),m.setAttribute("cy",d-s+u),m.setAttribute("r",l),m.setAttribute("fill","black"),r.appendChild(m)}if(3==h){var m=document.createElementNS(svgNS,"circle");m.setAttribute("cx",c+s),m.setAttribute("cy",d),m.setAttribute("r",a),m.setAttribute("fill","rgb(92, 230, 230)"),r.appendChild(m);var m=document.createElementNS(svgNS,"circle");m.setAttribute("cx",c+s),m.setAttribute("cy",d+u),m.setAttribute("r",l),m.setAttribute("fill","black"),r.appendChild(m)}if(4==h){var m=document.createElementNS(svgNS,"circle");m.setAttribute("cx",c),m.setAttribute("cy",d+s),m.setAttribute("r",a),m.setAttribute("fill","rgb(92, 230, 230)"),r.appendChild(m);var m=document.createElementNS(svgNS,"circle");m.setAttribute("cx",c),m.setAttribute("cy",d+s+u),m.setAttribute("r",l),m.setAttribute("fill","black"),r.appendChild(m)}}}}}}function lpair_electrons(t){for(deleteBridge(),skeletonFlag=!1,1==t&&(lonepaired_electron_flag="hidden"==lonepaired_electron_flag?"visible":"hidden"),i=0;i<count;i++){var e="g["+i+"]",r=document.getElementById(e);if(null!=r)for(;5!=r.childNodes.length;)r.removeChild(r.lastChild)}if("hidden"!=lonepaired_electron_flag)for(unpaired_electron_flag="hidden",vacant_electron_flag="hidden",i=0;i<count;i++){var n=atom[i].getElectronLinkVector(),o=3,s=6,a=2.5,l=.5,u=1.5,c=Number(atom[i].getX()),d=Number(atom[i].getY()),e="g["+collisionDetect(c,d)+"]";if("g[-1]"!=e){var r=document.getElementById(e);if(null!=r){var c=c+o,d=d-o,h=0;for(j=0;j<n.length;j++)if("lPair"==n[j].getElectronStatus()){if(h++,1==h){var m=document.createElementNS(svgNS,"circle");m.setAttribute("cx",c-s),m.setAttribute("cy",d),m.setAttribute("r",a),m.setAttribute("fill","rgb(0, 255, 0)"),r.appendChild(m);var m=document.createElementNS(svgNS,"circle");m.setAttribute("cx",c-s),m.setAttribute("cy",d+u),m.setAttribute("r",l),m.setAttribute("fill","black"),r.appendChild(m);var m=document.createElementNS(svgNS,"circle");m.setAttribute("cx",c-s),m.setAttribute("cy",d-u),m.setAttribute("r",l),m.setAttribute("fill","black"),r.appendChild(m)}if(2==h){var m=document.createElementNS(svgNS,"circle");m.setAttribute("cx",c),m.setAttribute("cy",d-s),m.setAttribute("r",a),m.setAttribute("fill","rgb(0, 255, 0)"),r.appendChild(m);var m=document.createElementNS(svgNS,"circle");m.setAttribute("cx",c),m.setAttribute("cy",d-s+u),m.setAttribute("r",l),m.setAttribute("fill","black"),r.appendChild(m);var m=document.createElementNS(svgNS,"circle");m.setAttribute("cx",c),m.setAttribute("cy",d-s-u),m.setAttribute("r",l),m.setAttribute("fill","black"),r.appendChild(m)}if(3==h){var m=document.createElementNS(svgNS,"circle");m.setAttribute("cx",c+s),m.setAttribute("cy",d),m.setAttribute("r",a),m.setAttribute("fill","rgb(0, 255, 0)"),r.appendChild(m);var m=document.createElementNS(svgNS,"circle");m.setAttribute("cx",c+s),m.setAttribute("cy",d+u),m.setAttribute("r",l),m.setAttribute("fill","black"),r.appendChild(m);var m=document.createElementNS(svgNS,"circle");m.setAttribute("cx",c+s),m.setAttribute("cy",d-u),m.setAttribute("r",l),m.setAttribute("fill","black"),r.appendChild(m)}if(4==h){var m=document.createElementNS(svgNS,"circle");m.setAttribute("cx",c),m.setAttribute("cy",d+s),m.setAttribute("r",a),m.setAttribute("fill","rgb(0, 255, 0)"),r.appendChild(m);var m=document.createElementNS(svgNS,"circle");m.setAttribute("cx",c),m.setAttribute("cy",d+s+u),m.setAttribute("r",l),m.setAttribute("fill","black"),r.appendChild(m);var m=document.createElementNS(svgNS,"circle");m.setAttribute("cx",c),m.setAttribute("cy",d+s-u),m.setAttribute("r",l),m.setAttribute("fill","black"),r.appendChild(m)}}}}}}function vacant_electrons(t){for(deleteBridge(),skeletonFlag=!1,1==t&&(vacant_electron_flag="hidden"==vacant_electron_flag?"visible":"hidden"),i=0;i<count;i++){var e="g["+i+"]",r=document.getElementById(e);if(null!=r)for(;5!=r.childNodes.length;)r.removeChild(r.lastChild)}if("hidden"!=vacant_electron_flag)for(unpaired_electron_flag="hidden",lonepaired_electron_flag="hidden",i=0;i<count;i++){var n=atom[i].getElectronLinkVector(),o=3,s=6,a=2.5,l=.5,u=Number(atom[i].getX()),c=Number(atom[i].getY()),e="g["+collisionDetect(u,c)+"]";if("g[-1]"!=e){var r=document.getElementById(e);if(null!=r){var u=u+o,c=c-o,d=0;for(j=0;j<n.length;j++)if("vacant"==n[j].getElectronStatus()){if(d++,1==d){var h=document.createElementNS(svgNS,"circle");h.setAttribute("cx",u-s),h.setAttribute("cy",c),h.setAttribute("r",a),h.setAttribute("fill","white"),h.setAttribute("stroke","grey"),h.setAttribute("stroke-width",l),r.appendChild(h)}if(2==d){var h=document.createElementNS(svgNS,"circle");h.setAttribute("cx",u),h.setAttribute("cy",c-s),h.setAttribute("r",a),h.setAttribute("fill","white"),h.setAttribute("stroke","grey"),h.setAttribute("stroke-width",l),r.appendChild(h)}if(3==d){var h=document.createElementNS(svgNS,"circle");h.setAttribute("cx",u+s),h.setAttribute("cy",c),h.setAttribute("r",a),h.setAttribute("fill","white"),h.setAttribute("stroke","grey"),h.setAttribute("stroke-width",l),r.appendChild(h)}if(4==d){var h=document.createElementNS(svgNS,"circle");h.setAttribute("cx",u),h.setAttribute("cy",c+s),h.setAttribute("r",a),h.setAttribute("fill","white"),h.setAttribute("stroke","grey"),h.setAttribute("stroke-width",l),r.appendChild(h)}}}}}}function atom_position(){deleteBridge(),skeletonFlag=!1,eventClear();var t="#atom_position";if("atom_position"!=cursor_flag){for(document.getElementById("s_content").style.cursor="url('images/atom_position.png'), auto",document.getElementById("s_content").addEventListener("click",event_atom_postion),i=0;i<count;i++){var e="g["+i+"]",r=document.getElementById(e);null!=r&&(r.childNodes[2].style.visibility="visible")}cursor_flag="atom_position",symbol="",atom_position_visiblity="visible",$("button").css("background-image",""),$(t).css("background-image","linear-gradient(to bottom, #9E9E9E 5%, #f9f9f9 100%)")}else document.getElementById("s_content").style.cursor="default",document.getElementById("s_content").removeEventListener("click",event_atom_postion),symbol="",cursor_flag=!1,atom_position_visiblity="hidden",$(t).css("background-image","");for(i=0;i<count;i++){var e="g["+i+"]",r=document.getElementById(e);null!=r&&(r.childNodes[2].style.visibility=atom_position_visiblity)}}function add_charge(){deleteBridge(),skeletonFlag=!1,eventClear();var t="#add_charge";"add_charge"!=cursor_flag?(document.getElementById("s_content").style.cursor="url('images/add_charge.png'), auto",document.getElementById("s_content").addEventListener("click",event_add_charge),cursor_flag="add_charge",symbol="",$("button").css("background-image",""),$(t).css("background-image","linear-gradient(to bottom, #9E9E9E 5%, #f9f9f9 100%)")):(document.getElementById("s_content").style.cursor="default",document.getElementById("s_content").removeEventListener("click",event_add_charge),symbol="",cursor_flag=!1,$(t).css("background-image",""))}function interaction(t){deleteBridge(),skeletonFlag=!1,eventClear(),interact_flag=t;var e="#"+t,r="url('images/"+t+".png'), auto";if(cursor_flag!=t)document.getElementById("s_content").style.cursor=r,document.getElementById("s_content").addEventListener("mousedown",down_interact),cursor_flag=t,symbol="",$("button").css("background-image",""),$(e).css("background-image","linear-gradient(to bottom, #9E9E9E 5%, #f9f9f9 100%)");else{document.getElementById("s_content").style.cursor="default",document.getElementById("s_content").removeEventListener("mousedown",down_interact),document.getElementById("s_content").removeEventListener("mousemove",move_interact),document.getElementById("s_content").removeEventListener("mouseup",up_interact),symbol="";var e="#"+cursor_flag;cursor_flag=!1,$(e).css("background-image","")}}function isotope_label(){deleteBridge(),skeletonFlag=!1,eventClear();var t="#isotope_label";"isotope_label"!=cursor_flag?(document.getElementById("s_content").style.cursor="url('images/isotope_label.png'), auto",document.getElementById("s_content").addEventListener("click",event_isotope_label),cursor_flag="isotope_label",symbol="",$("button").css("background-image",""),$(t).css("background-image","linear-gradient(to bottom, #9E9E9E 5%, #f9f9f9 100%)")):(document.getElementById("s_content").style.cursor="default",document.getElementById("s_content").removeEventListener("click",event_isotope_label),symbol="",cursor_flag=!1,$(t).css("background-image",""))}function open_template(){deleteBridge(),skeletonFlag=!1;var t=document.getElementById("upload");null!=t&&document.body.removeChild(t);var e=document.createElement("INPUT");e.setAttribute("type","file"),e.style.visibility="hidden",e.id="upload",document.body.appendChild(e),e.click(),e.onchange=function(){upload(),eventClear(),document.getElementById("s_content").style.cursor="url('images/template.png'), auto",document.getElementById("s_content").addEventListener("click",click_open_template),cursor_flag="open_template",symbol=""}}function add_implied_hydrogen(){for(var t=0,e=0;e<structure.length;e++)if("skip"!=toSkip[e]&&"function"==typeof structure[e].getFragmentVector){for(var r=structure[e].getFragmentVector(),i=0;i<r.length;i++)for(var n=r[i].getAtomVector(),o=0;o<n.length;o++){for(var s=n[o].getElectronLinkVector(),a=0,l=0;l<s.length;l++)if("uPair"==s[l].getElectronStatus()){var u={x:Number(n[o].getX()),y:Number(n[o].getY())},c=createAtomFragment("H",structure[e].getId(),{x:0,y:0});structure[e].setFragment(c);var d=c.getAtomVector()[0].getElectronLinkVector()[0];s[l].setElectronStatus("bPair"),s[l].setX1(u.x.toFixed(2)),s[l].setX2(u.x.toFixed(2)),s[l].setY1(u.y.toFixed(2)),s[l].setY2(u.y.toFixed(2)),s[l].setLinkStatus("linkTarget"),s[l].setBond("sigma"),s[l].setBondType("PolarCovalent"),s[l].setOrder("single"),s[l].setOrientation(0);var h="s"+t+"-"+(structure[e].getFragmentVector().length-1)+"-a0e0";s[l].setTarget(h),d.setElectronStatus("bPair"),d.setX1(0),d.setX2(0),d.setY1(0),d.setY2(0),d.setLinkStatus("linkTarget"),d.setBond("sigma"),d.setBondType("PolarCovalent"),d.setOrder("single"),d.setOrientation(0);var h="s"+t+"-"+i+"-a"+o+"e"+l;d.setTarget(h);var m=c.getAtomVector()[0].getElectroNegativity()-n[o].getElectroNegativity();a+=m,0>m?(s[l].setPartCharge("-"),s[l].setPartChargeVal(Math.abs(m).toFixed(2)),d.setPartCharge("+"),d.setPartChargeVal(Math.abs(m).toFixed(2))):m>0?(s[l].setPartCharge("+"),s[l].setPartChargeVal(Math.abs(m).toFixed(2)),d.setPartCharge("-"),d.setPartChargeVal(Math.abs(m).toFixed(2))):(s[l].setPartCharge(0),s[l].setPartChargeVal(0),d.setPartCharge(0),d.setPartChargeVal(0)),Math.abs(m)<=1.7?s[l].setBondType("Covalent"):Math.abs(m)>1.7&&(s[l].setBondType("Electrovalent"),s[l].setBond("ionic"))}else{var g=s[l].getPartCharge(),y=s[l].getPartChargeVal(),p=g+y;a+=Number(p)}0>a?(n[o].setPartCharge("-"),n[o].setPartChargeVal(Math.abs(a).toFixed(2))):a>0?(n[o].setPartCharge("+"),n[o].setPartChargeVal(Math.abs(a).toFixed(2))):(n[o].setPartCharge(0),n[o].setPartChargeVal(0))}t++}}function grid(){var t=document.getElementById("s_content");1==grid_set?(t.style.backgroundImage="",grid_set=!1):(t.style.backgroundImage="url('img/grid1.png')",grid_set=!0)}function new_structure(t){var e=document.getElementById("mySvg"),r=e.childNodes.length;if(!(0==t&&r>2&&0==confirm("Drawing space is not free.\nPlease save before clearing drawing space.\nDo you want to continue anyway?"))){for(document.getElementById("s_content").style.cursor="default",$("button").css("background-image","");e.firstChild;)e.removeChild(e.firstChild);variable_init(),eventClear()}}function open_structure(){deleteBridge(),skeletonFlag=!1,eventClear();var t=document.getElementById("mySvg"),e=t.childNodes.length;if(cursor_flag="open_structure",!(e>2&&0==confirm("Drawing space is not free.\nPlease save before opening new structure.\nDo you want to continue anyway?"))){var r=document.getElementById("upload");null!=r&&document.body.removeChild(r);var i=document.createElement("INPUT");i.setAttribute("type","file"),i.style.visibility="hidden",i.id="upload",document.body.appendChild(i),i.click(),i.onchange=function(){upload()}}}function template_library(){template_prompt.render()}function update_library(){if(check_login(),0==login_set)return void Alert.render("Login to update template");for(var t=structure.length,e=0,r=0;t>r;r++)"skip"!=toSkip[r]&&e++;return e>1?void Alert.render("Cannot update more than one structure to library"):0==e?void Alert.render("Cannot update empty structure to library"):void input_prompt.render()}function check_login(){deleteBridge(),skeletonFlag=!1,$.post("checklogin.php",{},function(t){login_set="false"==t.trim()?!1:!0})}function logOut(){$.post("logout.php"),login_set=!1,document.getElementById("login_btn").innerHTML="Login&#x25BC",$(".menu_login").css("display","none"),$(".menu_login").css("z-index","-1"),$("#login").removeAttr("style"),document.getElementById("login").setAttribute("onclick","display_menu('#t_login')")}function add_caption(){deleteBridge(),skeletonFlag=!1,eventClear(),$("button").css("background-image",""),document.getElementById("s_content").style.cursor="url('images/caption.png'), auto",document.getElementById("s_content").addEventListener("click",click_add_caption),cursor_flag="add_caption",symbol=""}function move_caption(){deleteBridge(),skeletonFlag=!1,eventClear(),document.getElementById("s_content").style.cursor="url('images/caption.png'), auto",document.getElementById("s_content").addEventListener("mousedown",down_move_caption),cursor_flag="move_caption",$("button").css("background-image",""),symbol=""}function draw_arrow(t){deleteBridge(),skeletonFlag=!1,bondCount=1,eventClear();var e="#"+t,r="url('images/draw_arrow.png'), auto";if(cursor_flag!=t)document.getElementById("s_content").style.cursor=r,document.getElementById("s_content").addEventListener("mousedown",msdown_arrow),cursor_flag=t,$("button").css("background-image",""),$(e).css("background-image","linear-gradient(to bottom, #9E9E9E 5%, #f9f9f9 100%)");else{document.getElementById("s_content").style.cursor="default",document.getElementById("s_content").removeEventListener("mousedown",msdown_arrow),document.getElementById("s_content").removeEventListener("mousemove",msmove_arrow),document.getElementById("s_content").removeEventListener("mouseup",msup_arrow);var e="#"+cursor_flag;cursor_flag=!1,$(e).css("background-image","")}}function draw_rev_arrow(t){deleteBridge(),skeletonFlag=!1,bondCount=1,eventClear();var e="#"+t,r="url('images/draw_rev_arrow.png'), auto";if(cursor_flag!=t)document.getElementById("s_content").style.cursor=r,document.getElementById("s_content").addEventListener("mousedown",msdown_rev_arrow),cursor_flag=t,$("button").css("background-image",""),$(e).css("background-image","linear-gradient(to bottom, #9E9E9E 5%, #f9f9f9 100%)");else{document.getElementById("s_content").style.cursor="default",document.getElementById("s_content").removeEventListener("mousedown",msdown_rev_arrow),document.getElementById("s_content").removeEventListener("mousemove",msmove_rev_arrow),document.getElementById("s_content").removeEventListener("mouseup",msup_rev_arrow);var e="#"+cursor_flag;cursor_flag=!1,$(e).css("background-image","")}}function draw_sign(t,e,r){deleteBridge(),skeletonFlag=!1,eventClear();var i="#"+t,n="url('images/"+r+".png'), auto";cursor_flag!=t?(document.getElementById("s_content").style.cursor=n,document.getElementById("s_content").addEventListener("click",event_draw_sign),cursor_flag=t,symbol=e,$("button").css("background-image",""),$(i).css("background-image","linear-gradient(to bottom, #9E9E9E 5%, #f9f9f9 100%)")):(document.getElementById("s_content").style.cursor="default",document.getElementById("s_content").removeEventListener("click",event_draw_sign),symbol="",cursor_flag=!1,$(i).css("background-image",""))}function delete_caption(){deleteBridge(),skeletonFlag=!1,eventClear();var t="url('images/caption.png'), auto";"delete_caption"!=cursor_flag?(document.getElementById("s_content").style.cursor=t,document.getElementById("s_content").addEventListener("click",event_delete_caption),cursor_flag="delete_caption",$("button").css("background-image","")):(document.getElementById("s_content").style.cursor="default",document.getElementById("s_content").removeEventListener("click",event_delete_caption),symbol="",cursor_flag=!1)}function del_arr_sign(){deleteBridge(),skeletonFlag=!1,eventClear();var t="#del_arr_sign",e="url('images/erase_arrow.png'), auto";"#del_arr_sign"!=cursor_flag?(document.getElementById("s_content").style.cursor=e,document.getElementById("s_content").addEventListener("click",event_del_arr_sign),cursor_flag="#del_arr_sign",$("button").css("background-image",""),$(t).css("background-image","linear-gradient(to bottom, #9E9E9E 5%, #f9f9f9 100%)")):(document.getElementById("s_content").style.cursor="default",document.getElementById("s_content").removeEventListener("click",event_del_arr_sign),symbol="",cursor_flag=!1,$(t).css("background-image",""))}function upload(){var t=document.getElementById("upload").files[0];if(t.type.match("text/xml")){var e=new FormData;e.append("data",t,t.name),xmlhttp=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),xmlhttp.onreadystatechange=function(){if(4==xmlhttp.readyState&&200==xmlhttp.status){var t=xmlhttp.responseText;
if(t=t.split("-"),"success"==t[0].trim()){var e="upload/"+t[1];"open_template"==cursor_flag?(templateXML=loadXMLDoc(e),$.post("unlink.php",{data:e})):(openXML=loadXMLDoc(e),draw_xml({x:0,y:0}),$.post("unlink.php",{data:e}))}}},xmlhttp.open("POST","upload.php",!0),xmlhttp.send(e)}}function loginShow(){var t=document.getElementById("username").value,e=document.getElementById("password").value;document.getElementById("txthnt").innerHTML="",$.post("login2.php",{myusername:t,mypassword:e},function(e){e=e.split("-"),"Success"==e[0]?(document.getElementById("login_btn").innerHTML="Welcome&#x25BC",document.getElementById("logged_username").innerHTML="Username:"+t,login_set=!0,document.getElementById("username").value="",document.getElementById("password").value="",$(".menu_login").css("display","none"),$(".menu_login").css("z-index","-1"),document.getElementById("login").setAttribute("onclick","display_menu('#t_logged')"),$("#login").removeAttr("style")):(document.getElementById("txthnt").innerHTML=e,login_set=!1)})}function save_xml(t){var e=writeXML(t);if(0==e)return void Alert.render("Cannot save more than one structure as template");var r=new Array;stack_check(),e=e.replace(/%2B/g,"+"),e=e.replace(/%2D/g,"-"),$.post("savexml.php",{data:e},function(t){window.location.href="downloadxml.php?path="+t}),"save"==t&&change_obj_color(),undo_stack.push(r);var i=copyStructure(structure);undo_stack_jsobj.push(i)}function save_image(){saveAlert.render("Saving.....");var t=new Array;stack_check(),add_implied_hydrogen(),change_obj_color();document.getElementById("mySvg");renderCanvas(10),html2canvas($("#canvas"),{onrendered:function(){var t=canvas.toDataURL("image/png"),e=document.createElement("a");e.setAttribute("download","image.png"),e.setAttribute("href",t),e.id="image",document.body.appendChild(e),$("#image")[0].click(),document.body.removeChild(e);var r=document.getElementById("canvas"),i=r.getContext("2d");i.clearRect(0,0,r.width,r.height),r.removeAttribute("width"),r.removeAttribute("height"),r.removeAttribute("style"),saveAlert.ok()}}),undo_stack.push(t);var e=copyStructure(structure);undo_stack_jsobj.push(e)}function save_template(t){saveAlert.render("Saving Template...");{var e;document.getElementById("mySvg")}return renderCanvas(4),html2canvas($("#canvas"),{onrendered:function(){var r=canvas.toDataURL("image/png");$.post("updateimg.php",{fname:t,data:r},function(t){var r=document.getElementById("canvas"),i=r.getContext("2d");i.clearRect(0,0,r.width,r.height),r.removeAttribute("width"),r.removeAttribute("height"),r.removeAttribute("style"),e=t,saveAlert.ok()})}}),e}function renderCanvas(t){var e=new XMLSerializer,r=document.getElementById("mySvg"),i=minXminY(),n=r.getAttribute("viewBox"),o=r.getAttribute("width"),s=r.getAttribute("height"),a=(i.maxx-i.minx+5)*t,l=(i.maxy-i.miny+5)*t;document.getElementById("canvas").style.visibility="hidden";var u=Math.floor(i.minx)+" "+Math.floor(i.miny)+" "+Math.floor(a/t)+" "+Math.floor(l/t);r.setAttribute("viewBox",u),r.setAttribute("width",a),r.setAttribute("height",l),r.setAttribute("preserveAspectRatio","xMinYMin meet");var c=e.serializeToString(document.getElementById("mySvg"));r.setAttribute("viewBox",n),r.setAttribute("width",o),r.setAttribute("height",s),r.removeAttribute("preserveAspectRatio"),canvg(document.getElementById("canvas"),c,{ignoreMouse:!0,ignoreAnimation:!0})}var Alert=new CustomAlert,aboutAlert=new AboutAlert,saveAlert=new SaveAlert,Prompt=new CustomPrompt,login_Prompt=new CustomPromptLogin,template_prompt=new CustomTemplatePrompt,input_prompt=new CustomInputPrompt,ptable_prompt=new CustomPromptPTable;Atom.prototype.getAtomicMass=function(){return this.atomicMass},Atom.prototype.setAtomicMass=function(t){this.atomicMass=t},Atom.prototype.setElectronLink=function(t){null!=t&&this.electronLinkVector.push(t)},Atom.prototype.getElectronLink=function(t){return this.electronLinkVector[t]},Atom.prototype.getElectronLinkVector=function(){return this.electronLinkVector},Atom.prototype.setElectronLinkVector=function(t){this.electronLinkVector=t},Atom.prototype.getLinkAtomVector=function(){return this.linkAtomVector},Atom.prototype.setLinkAtomVector=function(t){this.linkAtomVector=t},Atom.prototype.setLinkAtom=function(t){t.equals(null)||this.linkAtomVector.push(t)},Atom.prototype.getLinkAtom=function(t){return this.linkAtomVector[t]},Atom.prototype.getId=function(){return this.id},Atom.prototype.setId=function(t){this.id=t},Atom.prototype.getAtNo=function(){return this.atNo},Atom.prototype.setAtNo=function(t){this.atNo=t},Atom.prototype.getTitle=function(){return this.title},Atom.prototype.setTitle=function(t){this.title=t},Atom.prototype.getType=function(){return this.type},Atom.prototype.setType=function(t){this.type=t},Atom.prototype.getHybridization=function(){return this.hybridization},Atom.prototype.setHybridization=function(t){this.hybridization=t},Atom.prototype.getGeometry=function(){return this.geometry},Atom.prototype.setGeometry=function(t){this.geometry=t},Atom.prototype.getSymbol=function(){return this.symbol},Atom.prototype.setSymbol=function(t){this.symbol=t},Atom.prototype.getPosition=function(){return this.position},Atom.prototype.setPosition=function(t){this.position=t},Atom.prototype.getIsotopeLabel=function(){return this.isotopeLabel},Atom.prototype.setIsotopeLabel=function(t){this.isotopeLabel=t},Atom.prototype.getCharge=function(){return this.charge},Atom.prototype.setCharge=function(t){this.charge=t},Atom.prototype.getChargeCount=function(){return this.chargeCount},Atom.prototype.setChargeCount=function(t){this.chargeCount=t},Atom.prototype.getElectroNegativity=function(){return this.electroNegativity},Atom.prototype.setElectroNegativity=function(t){this.electroNegativity=t},Atom.prototype.getOxdnState=function(){return this.oxdnState},Atom.prototype.setOxdnState=function(t){this.oxdnState=t},Atom.prototype.getGroup=function(){return this.group},Atom.prototype.setGroup=function(t){this.group=t},Atom.prototype.getBlock=function(){return this.block},Atom.prototype.setBlock=function(t){this.block=t},Atom.prototype.getGcCode=function(){return this.gcCode},Atom.prototype.setGcCode=function(t){this.gcCode=t},Atom.prototype.getPartCharge=function(){return this.partCharge},Atom.prototype.setPartCharge=function(t){this.partCharge=t},Atom.prototype.getPartChargeVal=function(){return this.partChargeVal},Atom.prototype.setPartChargeVal=function(t){this.partChargeVal=t},Atom.prototype.getGroupStatus=function(){return this.groupStatus},Atom.prototype.setGroupStatus=function(t){this.groupStatus=t},Atom.prototype.getX=function(){return this.x},Atom.prototype.setX=function(t){this.x=t},Atom.prototype.getY=function(){return this.y},Atom.prototype.setY=function(t){this.y=t},Atom.prototype.getAtomPoint=function(){return this.atomPoint},Atom.prototype.setAtomPoint=function(t){this.atomPoint=t},Atom.prototype.setAtomPoint=function(t,e){var r=svg.createSVGPoint();r.x=t,r.y=e,this.atomPoint=r},Atom.prototype.getInfo=function(){return this},Interact.prototype.getId=function(){return this.id},Interact.prototype.setId=function(t){this.id=t},Interact.prototype.getTitle=function(){return this.title},Interact.prototype.setTitle=function(t){this.title=t},Interact.prototype.getType=function(){return this.type},Interact.prototype.setType=function(t){this.type=t},Interact.prototype.getSourceObject=function(){return this.sourceObject},Interact.prototype.setSourceObject=function(t){this.sourceObject=t},Interact.prototype.getTargetObject=function(){return this.targetObject},Interact.prototype.setTargetObject=function(t){this.targetObject=t},Interact.prototype.getSourceId=function(){return this.sourceId},Interact.prototype.setSourceId=function(t){this.sourceId=t},Interact.prototype.getTargetId=function(){return this.targetId},Interact.prototype.setTargetId=function(t){this.targetId=t},Interact.prototype.getX1=function(){return this.x1},Interact.prototype.setX1=function(t){this.x1=t},Interact.prototype.getY1=function(){return this.y1},Interact.prototype.setY1=function(t){this.y1=t},Interact.prototype.getX2=function(){return this.x2},Interact.prototype.setX2=function(t){this.x2=t},Interact.prototype.getY2=function(){return this.y2},Interact.prototype.setY2=function(t){this.y2=t},Interact.prototype.getIntPoint1=function(){return this.intPoint1},Interact.prototype.setIntPoint1=function(t){this.intPoint1=t},Interact.prototype.getIntPoint2=function(){return this.intPoint2},Interact.prototype.setIntPoint2=function(t){this.intPoint2=t},ElectronLink.prototype.getId=function(){return this.id},ElectronLink.prototype.setId=function(t){this.id=t},ElectronLink.prototype.getTmpId=function(){return this.tmpId},ElectronLink.prototype.setTmpId=function(t){this.tmpId=t},ElectronLink.prototype.getTitle=function(){return this.title},ElectronLink.prototype.setTitle=function(t){this.title=t},ElectronLink.prototype.getType=function(){return this.type},ElectronLink.prototype.setType=function(t){this.type=t},ElectronLink.prototype.getElectronStatus=function(){return this.electronStatus},ElectronLink.prototype.setElectronStatus=function(t){this.electronStatus=t},ElectronLink.prototype.getSpin=function(){return this.spin},ElectronLink.prototype.setSpin=function(t){this.spin=t},ElectronLink.prototype.getCharge=function(){return this.charge},ElectronLink.prototype.setCharge=function(t){this.charge=t},ElectronLink.prototype.getChargeCount=function(){return this.chargeCount},ElectronLink.prototype.setChargeCount=function(t){this.chargeCount=t},ElectronLink.prototype.getAffinity=function(){return this.affinity},ElectronLink.prototype.setAffinity=function(t){this.affinity=t},ElectronLink.prototype.getBond=function(){return this.bond},ElectronLink.prototype.setBond=function(t){this.bond=t},ElectronLink.prototype.getBondType=function(){return this.bondType},ElectronLink.prototype.setBondType=function(t){this.bondType=t},ElectronLink.prototype.getOrder=function(){return this.order},ElectronLink.prototype.setOrder=function(t){this.order=t},ElectronLink.prototype.getLinkStatus=function(){return this.linkStatus},ElectronLink.prototype.setLinkStatus=function(t){this.linkStatus=t},ElectronLink.prototype.getTarget=function(){return this.target},ElectronLink.prototype.setTarget=function(t){this.target=t},ElectronLink.prototype.getOrientation=function(){return this.orientation},ElectronLink.prototype.setOrientation=function(t){this.orientation=t},ElectronLink.prototype.getProjection=function(){return this.projection},ElectronLink.prototype.setProjection=function(t){this.projection=t},ElectronLink.prototype.getPriority=function(){return this.priority},ElectronLink.prototype.setPriority=function(t){this.priority=t},ElectronLink.prototype.getGcCode=function(){return this.gcCode},ElectronLink.prototype.setGcCode=function(t){this.gcCode=t},ElectronLink.prototype.getPartCharge=function(){return this.partCharge},ElectronLink.prototype.setPartCharge=function(t){this.partCharge=t},ElectronLink.prototype.getPartChargeVal=function(){return this.partChargeVal},ElectronLink.prototype.setPartChargeVal=function(t){this.partChargeVal=t},ElectronLink.prototype.getCheckStatus=function(){return this.checkStatus},ElectronLink.prototype.setCheckStatus=function(t){this.checkStatus=t},ElectronLink.prototype.getX1=function(){return this.x1},ElectronLink.prototype.setX1=function(t){this.x1=t},ElectronLink.prototype.getY1=function(){return this.y1},ElectronLink.prototype.setY1=function(t){this.y1=t},ElectronLink.prototype.getX2=function(){return this.x2},ElectronLink.prototype.setX2=function(t){this.x2=t},ElectronLink.prototype.getY2=function(){return this.y2},ElectronLink.prototype.setY2=function(t){this.y2=t},ElectronLink.prototype.getLinkPoint1=function(){return this.linkPoint1},ElectronLink.prototype.setLinkPoint1=function(t){this.linkPoint1=t},ElectronLink.prototype.setLinkPoint1=function(t,e){var r=svg.createSVGPoint();r.x=t,r.y=e,this.linkPoint1=r},ElectronLink.prototype.getLinkPoint2=function(){return this.linkPoint2},ElectronLink.prototype.setLinkPoint2=function(t){this.linkPoint2=t},ElectronLink.prototype.setLinkPoint2=function(t,e){var r=svg.createSVGPoint();r.x=t,r.y=e,this.linkPoint2=r},ElectronLink.prototype.getQuatPoint=function(){return this.quatPoint},ElectronLink.prototype.setQuatPoint=function(t){this.quatPoint=t},ElectronLink.prototype.setQuatPoint=function(t,e){var r=svg.createSVGPoint();r.x=t,r.y=e,this.quatPoint=r},ElectronLink.prototype.getMidPoint=function(){return this.midPoint},ElectronLink.prototype.setMidPoint=function(t){this.midPoint=t},ElectronLink.prototype.setMidPoint=function(t,e){var r=svg.createSVGPoint();r.x=t,r.y=e,this.midPoint=r},ElectronLink.prototype.getArrowPoint=function(){return this.arrowPoint},ElectronLink.prototype.setArrowPoint=function(t){this.arrowPoint=t},ElectronLink.prototype.setArrowPoint=function(t,e){var r=svg.createSVGPoint();r.x=t,r.y=e,this.arrowPoint=r},ElectronLink.prototype.getLinkAtom=function(){return this.linkAtom},ElectronLink.prototype.setLinkAtom=function(t){this.linkAtom=t},Structure.prototype.setFragment=function(t){null!=t&&this.fragmentVector.push(t)},Structure.prototype.removeFragment=function(t){this.fragmentVector.splice(t,1)},Structure.prototype.getFragment=function(t){return this.fragmentVector[t]},Structure.prototype.getFragmentVector=function(){return this.fragmentVector},Structure.prototype.setFragmentVector=function(t){this.fragmentVector=new Array,fragmentVector=t.slice()},Structure.prototype.setCaption=function(t){null!=t&&this.captionVector.push(t)},Structure.prototype.getCaption=function(t){return this.captionVector[t]},Structure.prototype.getCaptionVector=function(){return this.captionVector},Structure.prototype.getId=function(){return this.id},Structure.prototype.setId=function(t){this.id=t},Structure.prototype.getTitle=function(){return this.title},Structure.prototype.setTitle=function(t){this.title=t},Structure.prototype.getType=function(){return this.type},Structure.prototype.setType=function(t){this.type=t},Structure.prototype.getFormula=function(){return this.formula},Structure.prototype.setFormula=function(t){this.formula=t},Structure.prototype.getmolarMass=function(){return this.molarmass},Structure.prototype.setmolarMass=function(t){this.molarmass=t},Structure.prototype.getState=function(){return this.state},Structure.prototype.setState=function(t){this.state=t},Structure.prototype.getRole=function(){return this.role},Structure.prototype.setRole=function(t){this.role=t},Structure.prototype.getMp=function(){return this.mp},Structure.prototype.setMp=function(t){this.mp=t},Structure.prototype.getBp=function(){return this.bp},Structure.prototype.setBp=function(t){this.bp=t},Structure.prototype.getSmiles=function(){return this.smiles},Structure.prototype.setSmiles=function(t){this.smiles=t},Structure.prototype.setFragmentVector=function(t){this.fragmentVector=t},Structure.prototype.setCaptionVector=function(t){this.captionVector=t},StructureGroup.prototype.getStructureVector=function(){return this.structureVector},StructureGroup.prototype.setStructureVector=function(t){this.structureVector=t},StructureGroup.prototype.getInteractVector=function(){return this.interactVector},StructureGroup.prototype.setInteractVector=function(t){this.interactVector=t},StructureGroup.prototype.setStructure=function(t){null!=t&&this.structureVector.push(t)},StructureGroup.prototype.getStructure=function(t){return this.structureVector[t]},StructureGroup.prototype.setInteract=function(t){null!=t&&this.interactVector.push(t)},StructureGroup.prototype.getInteract=function(t){return this.interactVector[t]},StructureGroup.prototype.getCaptionVector=function(){return this.captionVector},StructureGroup.prototype.setCaptionVector=function(t){this.captionVector=t},StructureGroup.prototype.setCaption=function(t){null!=t&&this.captionVector.push(t)},StructureGroup.prototype.getCaption=function(t){return this.captionVector[t]},StructureGroup.prototype.getId=function(){return this.id},StructureGroup.prototype.setId=function(t){this.id=t},StructureGroup.prototype.getTitle=function(){return this.title},StructureGroup.prototype.setTitle=function(t){this.title=t},StructureGroup.prototype.getType=function(){return this.type},StructureGroup.prototype.setType=function(t){this.type=t},Fragment.prototype.setAtom=function(t){null!=t&&this.atomVector.push(t)},Fragment.prototype.getAtom=function(t){return this.atomVector[t]},Fragment.prototype.setAtomVector=function(t){this.atomVector=t},Fragment.prototype.getAtomVector=function(){return this.atomVector},Fragment.prototype.getId=function(){return this.id},Fragment.prototype.setId=function(t){this.id=t},Fragment.prototype.getTitle=function(){return this.title},Fragment.prototype.setTitle=function(t){this.title=t},Fragment.prototype.getType=function(){return this.type},Fragment.prototype.setType=function(t){this.type=t},Fragment.prototype.getFormula=function(){return this.formula},Fragment.prototype.setFormula=function(t){this.formula=t},Fragment.prototype.getRevFormula=function(){return this.revFormula},Fragment.prototype.setRevFormula=function(t){this.revFormula=t},Fragment.prototype.getSmiles=function(){return this.smiles},Fragment.prototype.setSmiles=function(t){this.smiles=t},Fragment.prototype.getLinkType=function(){return this.linkType},Fragment.prototype.setLinkType=function(t){this.linkType=t},Fragment.prototype.getSkeletonTarget1=function(){return this.skeletonTarget1},Fragment.prototype.setSkeletonTarget1=function(t){this.skeletonTarget1=t},Fragment.prototype.getSkeletonTarget2=function(){return this.skeletonTarget2},Fragment.prototype.setSkeletonTarget2=function(t){this.skeletonTarget2=t},Fragment.prototype.getSklCode=function(){return this.sklCode},Fragment.prototype.setSklCode=function(t){this.sklCode=t},Fragment.prototype.getSklPattern=function(){return this.sklPattern},Fragment.prototype.setSklPattern=function(t){this.sklPattern=t},Fragment.prototype.getTemplate=function(){return this.template},Fragment.prototype.setTemplate=function(t){this.template=t},Fragment.prototype.getOrientation=function(){return this.orientation},Fragment.prototype.setOrientation=function(t){this.orientation=t},Fragment.prototype.getProjection=function(){return this.projection},Fragment.prototype.setProjection=function(t){this.projection=t},Fragment.prototype.getStatus=function(){return this.status},Fragment.prototype.setStatus=function(t){this.status=t},Fragment.prototype.getRingNo=function(){return this.frgNo},Fragment.prototype.setRingNo=function(t){this.frgNo=t},Fragment.prototype.getX1=function(){return this.x1},Fragment.prototype.setX1=function(t){this.x1=t},Fragment.prototype.getY1=function(){return this.y1},Fragment.prototype.setY1=function(t){this.y1=t},Fragment.prototype.getX2=function(){return this.x2},Fragment.prototype.setX2=function(t){this.x2=t},Fragment.prototype.getY2=function(){return this.y2},Fragment.prototype.setY2=function(t){this.y2=t},document.onkeydown=KeyPress,svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),svgNS=svg.namespaceURI,pt=svg.createSVGPoint(),clientXchange=-6,clientYchange=7,bondDistance=20;var rectangle,error_flag,bond_status;!function(t,e){"use strict";"undefined"!=typeof define&&define.amd?define(["rgbcolor","stackblur"],e):"undefined"!=typeof module&&module.exports&&(module.exports=e(require("rgbcolor"),require("stackblur"))),t.canvg=e(t.RGBColor,t.stackBlur)}("undefined"!=typeof window?window:this,function(t,e){function r(t){var e=[0,0,0],r=function(r,i){var n=t.match(r);null!=n&&(e[i]+=n.length,t=t.replace(r," "))};return t=t.replace(/:not\(([^\)]*)\)/g,"     $1 "),t=t.replace(/{[^]*/gm," "),r(a,1),r(l,0),r(u,1),r(c,2),r(d,1),r(h,1),t=t.replace(/[\*\s\+>~]/g," "),t=t.replace(/[#\.]/g," "),r(m,2),e.join("")}function n(n){var s={opts:n};s.FRAMERATE=30,s.MAX_VIRTUAL_PIXELS=3e4,s.log=function(){},1==s.opts.log&&"undefined"!=typeof console&&(s.log=function(t){console.log(t)}),s.init=function(t){var e=0;s.UniqueId=function(){return e++,"canvg"+e},s.Definitions={},s.Styles={},s.StylesSpecificity={},s.Animations=[],s.Images=[],s.ctx=t,s.ViewPort=new function(){this.viewPorts=[],this.Clear=function(){this.viewPorts=[]},this.SetCurrent=function(t,e){this.viewPorts.push({width:t,height:e})},this.RemoveCurrent=function(){this.viewPorts.pop()},this.Current=function(){return this.viewPorts[this.viewPorts.length-1]},this.width=function(){return this.Current().width},this.height=function(){return this.Current().height},this.ComputeSize=function(t){return null!=t&&"number"==typeof t?t:"x"==t?this.width():"y"==t?this.height():Math.sqrt(Math.pow(this.width(),2)+Math.pow(this.height(),2))/Math.sqrt(2)}}},s.init(),s.ImagesLoaded=function(){for(var t=0;t<s.Images.length;t++)if(!s.Images[t].loaded)return!1;return!0},s.trim=function(t){return t.replace(/^\s+|\s+$/g,"")},s.compressSpaces=function(t){return t.replace(/[\s\r\t\n]+/gm," ")},s.ajax=function(t){var e;return e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),e?(e.open("GET",t,!1),e.send(null),e.responseText):null},s.parseXml=function(t){if("undefined"!=typeof Windows&&"undefined"!=typeof Windows.Data&&"undefined"!=typeof Windows.Data.Xml){var e=new Windows.Data.Xml.Dom.XmlDocument,r=new Windows.Data.Xml.Dom.XmlLoadSettings;return r.prohibitDtd=!1,e.loadXml(t,r),e}if(window.DOMParser){var i=new DOMParser;return i.parseFromString(t,"text/xml")}t=t.replace(/<!DOCTYPE svg[^>]*>/,"");var e=new ActiveXObject("Microsoft.XMLDOM");return e.async="false",e.loadXML(t),e},s.Property=function(t,e){this.name=t,this.value=e},s.Property.prototype.getValue=function(){return this.value},s.Property.prototype.hasValue=function(){return null!=this.value&&""!==this.value},s.Property.prototype.numValue=function(){if(!this.hasValue())return 0;var t=parseFloat(this.value);return(this.value+"").match(/%$/)&&(t/=100),t},s.Property.prototype.valueOrDefault=function(t){return this.hasValue()?this.value:t},s.Property.prototype.numValueOrDefault=function(t){return this.hasValue()?this.numValue():t},s.Property.prototype.addOpacity=function(e){var r=this.value;if(null!=e.value&&""!=e.value&&"string"==typeof this.value){var i=new t(this.value);i.ok&&(r="rgba("+i.r+", "+i.g+", "+i.b+", "+e.numValue()+")")}return new s.Property(this.name,r)},s.Property.prototype.getDefinition=function(){var t=this.value.match(/#([^\)'"]+)/);return t&&(t=t[1]),t||(t=this.value),s.Definitions[t]},s.Property.prototype.isUrlDefinition=function(){return 0==this.value.indexOf("url(")},s.Property.prototype.getFillStyleDefinition=function(t,e){var r=this.getDefinition();if(null!=r&&r.createGradient)return r.createGradient(s.ctx,t,e);if(null!=r&&r.createPattern){if(r.getHrefAttribute().hasValue()){var i=r.attribute("patternTransform");r=r.getHrefAttribute().getDefinition(),i.hasValue()&&(r.attribute("patternTransform",!0).value=i.value)}return r.createPattern(s.ctx,t)}return null},s.Property.prototype.getDPI=function(){return 96},s.Property.prototype.getEM=function(t){var e=12,r=new s.Property("fontSize",s.Font.Parse(s.ctx.font).fontSize);return r.hasValue()&&(e=r.toPixels(t)),e},s.Property.prototype.getUnits=function(){var t=this.value+"";return t.replace(/[0-9\.\-]/g,"")},s.Property.prototype.toPixels=function(t,e){if(!this.hasValue())return 0;var r=this.value+"";if(r.match(/em$/))return this.numValue()*this.getEM(t);if(r.match(/ex$/))return this.numValue()*this.getEM(t)/2;if(r.match(/px$/))return this.numValue();if(r.match(/pt$/))return this.numValue()*this.getDPI(t)*(1/72);if(r.match(/pc$/))return 15*this.numValue();if(r.match(/cm$/))return this.numValue()*this.getDPI(t)/2.54;if(r.match(/mm$/))return this.numValue()*this.getDPI(t)/25.4;if(r.match(/in$/))return this.numValue()*this.getDPI(t);if(r.match(/%$/))return this.numValue()*s.ViewPort.ComputeSize(t);var i=this.numValue();return e&&1>i?i*s.ViewPort.ComputeSize(t):i},s.Property.prototype.toMilliseconds=function(){if(!this.hasValue())return 0;var t=this.value+"";return t.match(/s$/)?1e3*this.numValue():(t.match(/ms$/),this.numValue())},s.Property.prototype.toRadians=function(){if(!this.hasValue())return 0;var t=this.value+"";return t.match(/deg$/)?this.numValue()*(Math.PI/180):t.match(/grad$/)?this.numValue()*(Math.PI/200):t.match(/rad$/)?this.numValue():this.numValue()*(Math.PI/180)};var a={baseline:"alphabetic","before-edge":"top","text-before-edge":"top",middle:"middle",central:"middle","after-edge":"bottom","text-after-edge":"bottom",ideographic:"ideographic",alphabetic:"alphabetic",hanging:"hanging",mathematical:"alphabetic"};return s.Property.prototype.toTextBaseline=function(){return this.hasValue()?a[this.value]:null},s.Font=new function(){this.Styles="normal|italic|oblique|inherit",this.Variants="normal|small-caps|inherit",this.Weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit",this.CreateFont=function(t,e,r,i,n,o){var a=null!=o?this.Parse(o):this.CreateFont("","","","","",s.ctx.font);return{fontFamily:n||a.fontFamily,fontSize:i||a.fontSize,fontStyle:t||a.fontStyle,fontWeight:r||a.fontWeight,fontVariant:e||a.fontVariant,toString:function(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.fontFamily].join(" ")}}};var t=this;this.Parse=function(e){for(var r={},i=s.trim(s.compressSpaces(e||"")).split(" "),n={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1},o="",a=0;a<i.length;a++)n.fontStyle||-1==t.Styles.indexOf(i[a])?n.fontVariant||-1==t.Variants.indexOf(i[a])?n.fontWeight||-1==t.Weights.indexOf(i[a])?n.fontSize?"inherit"!=i[a]&&(o+=i[a]):("inherit"!=i[a]&&(r.fontSize=i[a].split("/")[0]),n.fontStyle=n.fontVariant=n.fontWeight=n.fontSize=!0):("inherit"!=i[a]&&(r.fontWeight=i[a]),n.fontStyle=n.fontVariant=n.fontWeight=!0):("inherit"!=i[a]&&(r.fontVariant=i[a]),n.fontStyle=n.fontVariant=!0):("inherit"!=i[a]&&(r.fontStyle=i[a]),n.fontStyle=!0);return""!=o&&(r.fontFamily=o),r}},s.ToNumberArray=function(t){for(var e=s.trim(s.compressSpaces((t||"").replace(/,/g," "))).split(" "),r=0;r<e.length;r++)e[r]=parseFloat(e[r]);return e},s.Point=function(t,e){this.x=t,this.y=e},s.Point.prototype.angleTo=function(t){return Math.atan2(t.y-this.y,t.x-this.x)},s.Point.prototype.applyTransform=function(t){var e=this.x*t[0]+this.y*t[2]+t[4],r=this.x*t[1]+this.y*t[3]+t[5];this.x=e,this.y=r},s.CreatePoint=function(t){var e=s.ToNumberArray(t);return new s.Point(e[0],e[1])},s.CreatePath=function(t){for(var e=s.ToNumberArray(t),r=[],i=0;i<e.length;i+=2)r.push(new s.Point(e[i],e[i+1]));return r},s.BoundingBox=function(t,e,r,n){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN,this.x=function(){return this.x1},this.y=function(){return this.y1},this.width=function(){return this.x2-this.x1},this.height=function(){return this.y2-this.y1},this.addPoint=function(t,e){null!=t&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=t,this.x2=t),t<this.x1&&(this.x1=t),t>this.x2&&(this.x2=t)),null!=e&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))},this.addX=function(t){this.addPoint(t,null)},this.addY=function(t){this.addPoint(null,t)},this.addBoundingBox=function(t){this.addPoint(t.x1,t.y1),this.addPoint(t.x2,t.y2)},this.addQuadraticCurve=function(t,e,r,i,n,o){var s=t+2/3*(r-t),a=e+2/3*(i-e),l=s+1/3*(n-t),u=a+1/3*(o-e);this.addBezierCurve(t,e,s,l,a,u,n,o)},this.addBezierCurve=function(t,e,r,n,o,s,a,l){var u=[t,e],c=[r,n],d=[o,s],h=[a,l];for(this.addPoint(u[0],u[1]),this.addPoint(h[0],h[1]),i=0;i<=1;i++){var m=function(t){return Math.pow(1-t,3)*u[i]+3*Math.pow(1-t,2)*t*c[i]+3*(1-t)*Math.pow(t,2)*d[i]+Math.pow(t,3)*h[i]},g=6*u[i]-12*c[i]+6*d[i],y=-3*u[i]+9*c[i]-9*d[i]+3*h[i],p=3*c[i]-3*u[i];if(0!=y){var f=Math.pow(g,2)-4*p*y;if(!(0>f)){var b=(-g+Math.sqrt(f))/(2*y);b>0&&1>b&&(0==i&&this.addX(m(b)),1==i&&this.addY(m(b)));var v=(-g-Math.sqrt(f))/(2*y);v>0&&1>v&&(0==i&&this.addX(m(v)),1==i&&this.addY(m(v)))}}else{if(0==g)continue;var x=-p/g;x>0&&1>x&&(0==i&&this.addX(m(x)),1==i&&this.addY(m(x)))}}},this.isPointInBox=function(t,e){return this.x1<=t&&t<=this.x2&&this.y1<=e&&e<=this.y2},this.addPoint(t,e),this.addPoint(r,n)},s.Transform=function(t){var e=this;this.Type={},this.Type.translate=function(t){this.p=s.CreatePoint(t),this.apply=function(t){t.translate(this.p.x||0,this.p.y||0)},this.unapply=function(t){t.translate(-1*this.p.x||0,-1*this.p.y||0)},this.applyToPoint=function(t){t.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0])}},this.Type.rotate=function(t){var e=s.ToNumberArray(t);this.angle=new s.Property("angle",e[0]),this.cx=e[1]||0,this.cy=e[2]||0,this.apply=function(t){t.translate(this.cx,this.cy),t.rotate(this.angle.toRadians()),t.translate(-this.cx,-this.cy)},this.unapply=function(t){t.translate(this.cx,this.cy),t.rotate(-1*this.angle.toRadians()),t.translate(-this.cx,-this.cy)},this.applyToPoint=function(t){var e=this.angle.toRadians();t.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0]),t.applyTransform([Math.cos(e),Math.sin(e),-Math.sin(e),Math.cos(e),0,0]),t.applyTransform([1,0,0,1,-this.p.x||0,-this.p.y||0])}},this.Type.scale=function(t){this.p=s.CreatePoint(t),this.apply=function(t){t.scale(this.p.x||1,this.p.y||this.p.x||1)},this.unapply=function(t){t.scale(1/this.p.x||1,1/this.p.y||this.p.x||1)},this.applyToPoint=function(t){t.applyTransform([this.p.x||0,0,0,this.p.y||0,0,0])}},this.Type.matrix=function(t){this.m=s.ToNumberArray(t),this.apply=function(t){t.transform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])},this.unapply=function(t){var e=this.m[0],r=this.m[2],i=this.m[4],n=this.m[1],o=this.m[3],s=this.m[5],a=0,l=0,u=1,c=1/(e*(o*u-s*l)-r*(n*u-s*a)+i*(n*l-o*a));t.transform(c*(o*u-s*l),c*(s*a-n*u),c*(i*l-r*u),c*(e*u-i*a),c*(r*s-i*o),c*(i*n-e*s))},this.applyToPoint=function(t){t.applyTransform(this.m)}},this.Type.SkewBase=function(t){this.base=e.Type.matrix,this.base(t),this.angle=new s.Property("angle",t)},this.Type.SkewBase.prototype=new this.Type.matrix,this.Type.skewX=function(t){this.base=e.Type.SkewBase,this.base(t),this.m=[1,0,Math.tan(this.angle.toRadians()),1,0,0]},this.Type.skewX.prototype=new this.Type.SkewBase,this.Type.skewY=function(t){this.base=e.Type.SkewBase,this.base(t),this.m=[1,Math.tan(this.angle.toRadians()),0,1,0,0]},this.Type.skewY.prototype=new this.Type.SkewBase,this.transforms=[],this.apply=function(t){for(var e=0;e<this.transforms.length;e++)this.transforms[e].apply(t)},this.unapply=function(t){for(var e=this.transforms.length-1;e>=0;e--)this.transforms[e].unapply(t)},this.applyToPoint=function(t){for(var e=0;e<this.transforms.length;e++)this.transforms[e].applyToPoint(t)};for(var r=s.trim(s.compressSpaces(t)).replace(/\)([a-zA-Z])/g,") $1").replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/),i=0;i<r.length;i++){var n=s.trim(r[i].split("(")[0]),o=r[i].split("(")[1].replace(")",""),a=new this.Type[n](o);a.type=n,this.transforms.push(a)}},s.AspectRatio=function(t,e,r,i,n,o,a,l,u,c){e=s.compressSpaces(e),e=e.replace(/^defer\s/,"");var d=e.split(" ")[0]||"xMidYMid",h=e.split(" ")[1]||"meet",m=r/i,g=n/o,y=Math.min(m,g),p=Math.max(m,g);"meet"==h&&(i*=y,o*=y),"slice"==h&&(i*=p,o*=p),u=new s.Property("refX",u),c=new s.Property("refY",c),u.hasValue()&&c.hasValue()?t.translate(-y*u.toPixels("x"),-y*c.toPixels("y")):(d.match(/^xMid/)&&("meet"==h&&y==g||"slice"==h&&p==g)&&t.translate(r/2-i/2,0),d.match(/YMid$/)&&("meet"==h&&y==m||"slice"==h&&p==m)&&t.translate(0,n/2-o/2),d.match(/^xMax/)&&("meet"==h&&y==g||"slice"==h&&p==g)&&t.translate(r-i,0),d.match(/YMax$/)&&("meet"==h&&y==m||"slice"==h&&p==m)&&t.translate(0,n-o)),"none"==d?t.scale(m,g):"meet"==h?t.scale(y,y):"slice"==h&&t.scale(p,p),t.translate(null==a?0:-a,null==l?0:-l)},s.Element={},s.EmptyProperty=new s.Property("EMPTY",""),s.Element.ElementBase=function(t){if(this.attributes={},this.styles={},this.stylesSpecificity={},this.children=[],this.attribute=function(t,e){var r=this.attributes[t];return null!=r?r:(1==e&&(r=new s.Property(t,""),this.attributes[t]=r),r||s.EmptyProperty)},this.getHrefAttribute=function(){for(var t in this.attributes)if("href"==t||t.match(/:href$/))return this.attributes[t];
return s.EmptyProperty},this.style=function(t,e,r){var i=this.styles[t];if(null!=i)return i;var n=this.attribute(t);if(null!=n&&n.hasValue())return this.styles[t]=n,n;if(1!=r){var o=this.parent;if(null!=o){var a=o.style(t);if(null!=a&&a.hasValue())return a}}return 1==e&&(i=new s.Property(t,""),this.styles[t]=i),i||s.EmptyProperty},this.render=function(t){if("none"!=this.style("display").value&&"hidden"!=this.style("visibility").value){if(t.save(),this.attribute("mask").hasValue()){var e=this.attribute("mask").getDefinition();null!=e&&e.apply(t,this)}else if(this.style("filter").hasValue()){var r=this.style("filter").getDefinition();null!=r&&r.apply(t,this)}else this.setContext(t),this.renderChildren(t),this.clearContext(t);t.restore()}},this.setContext=function(){},this.clearContext=function(){},this.renderChildren=function(t){for(var e=0;e<this.children.length;e++)this.children[e].render(t)},this.addChild=function(t,e){var r=t;e&&(r=s.CreateElement(t)),r.parent=this,"title"!=r.type&&this.children.push(r)},this.addStylesFromStyleDefinition=function(){for(var e in s.Styles)if("@"!=e[0]&&o(t,e)){var r=s.Styles[e],i=s.StylesSpecificity[e];if(null!=r)for(var n in r){var a=this.stylesSpecificity[n];"undefined"==typeof a&&(a="000"),i>a&&(this.styles[n]=r[n],this.stylesSpecificity[n]=i)}}},null!=t&&1==t.nodeType){for(var e=0;e<t.attributes.length;e++){var r=t.attributes[e];this.attributes[r.nodeName]=new s.Property(r.nodeName,r.value)}if(this.addStylesFromStyleDefinition(),this.attribute("style").hasValue())for(var i=this.attribute("style").value.split(";"),e=0;e<i.length;e++)if(""!=s.trim(i[e])){var n=i[e].split(":"),a=s.trim(n[0]),l=s.trim(n[1]);this.styles[a]=new s.Property(a,l)}this.attribute("id").hasValue()&&null==s.Definitions[this.attribute("id").value]&&(s.Definitions[this.attribute("id").value]=this);for(var e=0;e<t.childNodes.length;e++){var u=t.childNodes[e];if(1==u.nodeType&&this.addChild(u,!0),this.captureTextNodes&&(3==u.nodeType||4==u.nodeType)){var c=u.value||u.text||u.textContent||"";""!=s.compressSpaces(c)&&this.addChild(new s.Element.tspan(u),!1)}}}},s.Element.RenderedElementBase=function(t){this.base=s.Element.ElementBase,this.base(t),this.setContext=function(t){if(this.style("fill").isUrlDefinition()){var e=this.style("fill").getFillStyleDefinition(this,this.style("fill-opacity"));null!=e&&(t.fillStyle=e)}else if(this.style("fill").hasValue()){var r=this.style("fill");"currentColor"==r.value&&(r.value=this.style("color").value),"inherit"!=r.value&&(t.fillStyle="none"==r.value?"rgba(0,0,0,0)":r.value)}if(this.style("fill-opacity").hasValue()){var r=new s.Property("fill",t.fillStyle);r=r.addOpacity(this.style("fill-opacity")),t.fillStyle=r.value}if(this.style("stroke").isUrlDefinition()){var e=this.style("stroke").getFillStyleDefinition(this,this.style("stroke-opacity"));null!=e&&(t.strokeStyle=e)}else if(this.style("stroke").hasValue()){var i=this.style("stroke");"currentColor"==i.value&&(i.value=this.style("color").value),"inherit"!=i.value&&(t.strokeStyle="none"==i.value?"rgba(0,0,0,0)":i.value)}if(this.style("stroke-opacity").hasValue()){var i=new s.Property("stroke",t.strokeStyle);i=i.addOpacity(this.style("stroke-opacity")),t.strokeStyle=i.value}if(this.style("stroke-width").hasValue()){var n=this.style("stroke-width").toPixels();t.lineWidth=0==n?.001:n}if(this.style("stroke-linecap").hasValue()&&(t.lineCap=this.style("stroke-linecap").value),this.style("stroke-linejoin").hasValue()&&(t.lineJoin=this.style("stroke-linejoin").value),this.style("stroke-miterlimit").hasValue()&&(t.miterLimit=this.style("stroke-miterlimit").value),this.style("stroke-dasharray").hasValue()&&"none"!=this.style("stroke-dasharray").value){var o=s.ToNumberArray(this.style("stroke-dasharray").value);"undefined"!=typeof t.setLineDash?t.setLineDash(o):"undefined"!=typeof t.webkitLineDash?t.webkitLineDash=o:"undefined"==typeof t.mozDash||1==o.length&&0==o[0]||(t.mozDash=o);var a=this.style("stroke-dashoffset").numValueOrDefault(1);"undefined"!=typeof t.lineDashOffset?t.lineDashOffset=a:"undefined"!=typeof t.webkitLineDashOffset?t.webkitLineDashOffset=a:"undefined"!=typeof t.mozDashOffset&&(t.mozDashOffset=a)}if("undefined"!=typeof t.font&&(t.font=s.Font.CreateFont(this.style("font-style").value,this.style("font-variant").value,this.style("font-weight").value,this.style("font-size").hasValue()?this.style("font-size").toPixels()+"px":"",this.style("font-family").value).toString()),this.style("transform",!1,!0).hasValue()){var l=new s.Transform(this.style("transform",!1,!0).value);l.apply(t)}if(this.attribute("clip-path",!1,!0).hasValue()){var u=this.attribute("clip-path",!1,!0).getDefinition();null!=u&&u.apply(t)}this.style("opacity").hasValue()&&(t.globalAlpha=this.style("opacity").numValue())}},s.Element.RenderedElementBase.prototype=new s.Element.ElementBase,s.Element.PathElementBase=function(t){this.base=s.Element.RenderedElementBase,this.base(t),this.path=function(t){return null!=t&&t.beginPath(),new s.BoundingBox},this.renderChildren=function(t){this.path(t),s.Mouse.checkPath(this,t),""!=t.fillStyle&&("inherit"!=this.style("fill-rule").valueOrDefault("inherit")?t.fill(this.style("fill-rule").value):t.fill()),""!=t.strokeStyle&&t.stroke();var e=this.getMarkers();if(null!=e){if(this.style("marker-start").isUrlDefinition()){var r=this.style("marker-start").getDefinition();r.render(t,e[0][0],e[0][1])}if(this.style("marker-mid").isUrlDefinition())for(var r=this.style("marker-mid").getDefinition(),i=1;i<e.length-1;i++)r.render(t,e[i][0],e[i][1]);if(this.style("marker-end").isUrlDefinition()){var r=this.style("marker-end").getDefinition();r.render(t,e[e.length-1][0],e[e.length-1][1])}}},this.getBoundingBox=function(){return this.path()},this.getMarkers=function(){return null}},s.Element.PathElementBase.prototype=new s.Element.RenderedElementBase,s.Element.svg=function(t){this.base=s.Element.RenderedElementBase,this.base(t),this.baseClearContext=this.clearContext,this.clearContext=function(t){this.baseClearContext(t),s.ViewPort.RemoveCurrent()},this.baseSetContext=this.setContext,this.setContext=function(t){t.strokeStyle="rgba(0,0,0,0)",t.lineCap="butt",t.lineJoin="miter",t.miterLimit=4,"undefined"!=typeof t.font&&"undefined"!=typeof window.getComputedStyle&&(t.font=window.getComputedStyle(t.canvas).getPropertyValue("font")),this.baseSetContext(t),this.attribute("x").hasValue()||(this.attribute("x",!0).value=0),this.attribute("y").hasValue()||(this.attribute("y",!0).value=0),t.translate(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"));var e=s.ViewPort.width(),r=s.ViewPort.height();if(this.attribute("width").hasValue()||(this.attribute("width",!0).value="100%"),this.attribute("height").hasValue()||(this.attribute("height",!0).value="100%"),"undefined"==typeof this.root){e=this.attribute("width").toPixels("x"),r=this.attribute("height").toPixels("y");var i=0,n=0;this.attribute("refX").hasValue()&&this.attribute("refY").hasValue()&&(i=-this.attribute("refX").toPixels("x"),n=-this.attribute("refY").toPixels("y")),"visible"!=this.attribute("overflow").valueOrDefault("hidden")&&(t.beginPath(),t.moveTo(i,n),t.lineTo(e,n),t.lineTo(e,r),t.lineTo(i,r),t.closePath(),t.clip())}if(s.ViewPort.SetCurrent(e,r),this.attribute("viewBox").hasValue()){var o=s.ToNumberArray(this.attribute("viewBox").value),a=o[0],l=o[1];e=o[2],r=o[3],s.AspectRatio(t,this.attribute("preserveAspectRatio").value,s.ViewPort.width(),e,s.ViewPort.height(),r,a,l,this.attribute("refX").value,this.attribute("refY").value),s.ViewPort.RemoveCurrent(),s.ViewPort.SetCurrent(o[2],o[3])}}},s.Element.svg.prototype=new s.Element.RenderedElementBase,s.Element.rect=function(t){this.base=s.Element.PathElementBase,this.base(t),this.path=function(t){var e=this.attribute("x").toPixels("x"),r=this.attribute("y").toPixels("y"),i=this.attribute("width").toPixels("x"),n=this.attribute("height").toPixels("y"),o=this.attribute("rx").toPixels("x"),a=this.attribute("ry").toPixels("y");return this.attribute("rx").hasValue()&&!this.attribute("ry").hasValue()&&(a=o),this.attribute("ry").hasValue()&&!this.attribute("rx").hasValue()&&(o=a),o=Math.min(o,i/2),a=Math.min(a,n/2),null!=t&&(t.beginPath(),t.moveTo(e+o,r),t.lineTo(e+i-o,r),t.quadraticCurveTo(e+i,r,e+i,r+a),t.lineTo(e+i,r+n-a),t.quadraticCurveTo(e+i,r+n,e+i-o,r+n),t.lineTo(e+o,r+n),t.quadraticCurveTo(e,r+n,e,r+n-a),t.lineTo(e,r+a),t.quadraticCurveTo(e,r,e+o,r),t.closePath()),new s.BoundingBox(e,r,e+i,r+n)}},s.Element.rect.prototype=new s.Element.PathElementBase,s.Element.circle=function(t){this.base=s.Element.PathElementBase,this.base(t),this.path=function(t){var e=this.attribute("cx").toPixels("x"),r=this.attribute("cy").toPixels("y"),i=this.attribute("r").toPixels();return null!=t&&(t.beginPath(),t.arc(e,r,i,0,2*Math.PI,!0),t.closePath()),new s.BoundingBox(e-i,r-i,e+i,r+i)}},s.Element.circle.prototype=new s.Element.PathElementBase,s.Element.ellipse=function(t){this.base=s.Element.PathElementBase,this.base(t),this.path=function(t){var e=4*((Math.sqrt(2)-1)/3),r=this.attribute("rx").toPixels("x"),i=this.attribute("ry").toPixels("y"),n=this.attribute("cx").toPixels("x"),o=this.attribute("cy").toPixels("y");return null!=t&&(t.beginPath(),t.moveTo(n,o-i),t.bezierCurveTo(n+e*r,o-i,n+r,o-e*i,n+r,o),t.bezierCurveTo(n+r,o+e*i,n+e*r,o+i,n,o+i),t.bezierCurveTo(n-e*r,o+i,n-r,o+e*i,n-r,o),t.bezierCurveTo(n-r,o-e*i,n-e*r,o-i,n,o-i),t.closePath()),new s.BoundingBox(n-r,o-i,n+r,o+i)}},s.Element.ellipse.prototype=new s.Element.PathElementBase,s.Element.line=function(t){this.base=s.Element.PathElementBase,this.base(t),this.getPoints=function(){return[new s.Point(this.attribute("x1").toPixels("x"),this.attribute("y1").toPixels("y")),new s.Point(this.attribute("x2").toPixels("x"),this.attribute("y2").toPixels("y"))]},this.path=function(t){var e=this.getPoints();return null!=t&&(t.beginPath(),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y)),new s.BoundingBox(e[0].x,e[0].y,e[1].x,e[1].y)},this.getMarkers=function(){var t=this.getPoints(),e=t[0].angleTo(t[1]);return[[t[0],e],[t[1],e]]}},s.Element.line.prototype=new s.Element.PathElementBase,s.Element.polyline=function(t){this.base=s.Element.PathElementBase,this.base(t),this.points=s.CreatePath(this.attribute("points").value),this.path=function(t){var e=new s.BoundingBox(this.points[0].x,this.points[0].y);null!=t&&(t.beginPath(),t.moveTo(this.points[0].x,this.points[0].y));for(var r=1;r<this.points.length;r++)e.addPoint(this.points[r].x,this.points[r].y),null!=t&&t.lineTo(this.points[r].x,this.points[r].y);return e},this.getMarkers=function(){for(var t=[],e=0;e<this.points.length-1;e++)t.push([this.points[e],this.points[e].angleTo(this.points[e+1])]);return t.push([this.points[this.points.length-1],t[t.length-1][1]]),t}},s.Element.polyline.prototype=new s.Element.PathElementBase,s.Element.polygon=function(t){this.base=s.Element.polyline,this.base(t),this.basePath=this.path,this.path=function(t){var e=this.basePath(t);return null!=t&&(t.lineTo(this.points[0].x,this.points[0].y),t.closePath()),e}},s.Element.polygon.prototype=new s.Element.polyline,s.Element.path=function(t){this.base=s.Element.PathElementBase,this.base(t);var e=this.attribute("d").value;e=e.replace(/,/gm," ");for(var r=0;2>r;r++)e=e.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2");e=e.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),e=e.replace(/([0-9])([+\-])/gm,"$1 $2");for(var r=0;2>r;r++)e=e.replace(/(\.[0-9]*)(\.)/gm,"$1 $2");e=e.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 "),e=s.compressSpaces(e),e=s.trim(e),this.PathParser=new function(t){this.tokens=t.split(" "),this.reset=function(){this.i=-1,this.command="",this.previousCommand="",this.start=new s.Point(0,0),this.control=new s.Point(0,0),this.current=new s.Point(0,0),this.points=[],this.angles=[]},this.isEnd=function(){return this.i>=this.tokens.length-1},this.isCommandOrEnd=function(){return this.isEnd()?!0:null!=this.tokens[this.i+1].match(/^[A-Za-z]$/)},this.isRelativeCommand=function(){switch(this.command){case"m":case"l":case"h":case"v":case"c":case"s":case"q":case"t":case"a":case"z":return!0}return!1},this.getToken=function(){return this.i++,this.tokens[this.i]},this.getScalar=function(){return parseFloat(this.getToken())},this.nextCommand=function(){this.previousCommand=this.command,this.command=this.getToken()},this.getPoint=function(){var t=new s.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(t)},this.getAsControlPoint=function(){var t=this.getPoint();return this.control=t,t},this.getAsCurrentPoint=function(){var t=this.getPoint();return this.current=t,t},this.getReflectedControlPoint=function(){if("c"!=this.previousCommand.toLowerCase()&&"s"!=this.previousCommand.toLowerCase()&&"q"!=this.previousCommand.toLowerCase()&&"t"!=this.previousCommand.toLowerCase())return this.current;var t=new s.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y);return t},this.makeAbsolute=function(t){return this.isRelativeCommand()&&(t.x+=this.current.x,t.y+=this.current.y),t},this.addMarker=function(t,e,r){null!=r&&this.angles.length>0&&null==this.angles[this.angles.length-1]&&(this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(r)),this.addMarkerAngle(t,null==e?null:e.angleTo(t))},this.addMarkerAngle=function(t,e){this.points.push(t),this.angles.push(e)},this.getMarkerPoints=function(){return this.points},this.getMarkerAngles=function(){for(var t=0;t<this.angles.length;t++)if(null==this.angles[t])for(var e=t+1;e<this.angles.length;e++)if(null!=this.angles[e]){this.angles[t]=this.angles[e];break}return this.angles}}(e),this.path=function(t){var e=this.PathParser;e.reset();var r=new s.BoundingBox;for(null!=t&&t.beginPath();!e.isEnd();)switch(e.nextCommand(),e.command){case"M":case"m":var i=e.getAsCurrentPoint();for(e.addMarker(i),r.addPoint(i.x,i.y),null!=t&&t.moveTo(i.x,i.y),e.start=e.current;!e.isCommandOrEnd();){var i=e.getAsCurrentPoint();e.addMarker(i,e.start),r.addPoint(i.x,i.y),null!=t&&t.lineTo(i.x,i.y)}break;case"L":case"l":for(;!e.isCommandOrEnd();){var n=e.current,i=e.getAsCurrentPoint();e.addMarker(i,n),r.addPoint(i.x,i.y),null!=t&&t.lineTo(i.x,i.y)}break;case"H":case"h":for(;!e.isCommandOrEnd();){var o=new s.Point((e.isRelativeCommand()?e.current.x:0)+e.getScalar(),e.current.y);e.addMarker(o,e.current),e.current=o,r.addPoint(e.current.x,e.current.y),null!=t&&t.lineTo(e.current.x,e.current.y)}break;case"V":case"v":for(;!e.isCommandOrEnd();){var o=new s.Point(e.current.x,(e.isRelativeCommand()?e.current.y:0)+e.getScalar());e.addMarker(o,e.current),e.current=o,r.addPoint(e.current.x,e.current.y),null!=t&&t.lineTo(e.current.x,e.current.y)}break;case"C":case"c":for(;!e.isCommandOrEnd();){var a=e.current,l=e.getPoint(),u=e.getAsControlPoint(),c=e.getAsCurrentPoint();e.addMarker(c,u,l),r.addBezierCurve(a.x,a.y,l.x,l.y,u.x,u.y,c.x,c.y),null!=t&&t.bezierCurveTo(l.x,l.y,u.x,u.y,c.x,c.y)}break;case"S":case"s":for(;!e.isCommandOrEnd();){var a=e.current,l=e.getReflectedControlPoint(),u=e.getAsControlPoint(),c=e.getAsCurrentPoint();e.addMarker(c,u,l),r.addBezierCurve(a.x,a.y,l.x,l.y,u.x,u.y,c.x,c.y),null!=t&&t.bezierCurveTo(l.x,l.y,u.x,u.y,c.x,c.y)}break;case"Q":case"q":for(;!e.isCommandOrEnd();){var a=e.current,u=e.getAsControlPoint(),c=e.getAsCurrentPoint();e.addMarker(c,u,u),r.addQuadraticCurve(a.x,a.y,u.x,u.y,c.x,c.y),null!=t&&t.quadraticCurveTo(u.x,u.y,c.x,c.y)}break;case"T":case"t":for(;!e.isCommandOrEnd();){var a=e.current,u=e.getReflectedControlPoint();e.control=u;var c=e.getAsCurrentPoint();e.addMarker(c,u,u),r.addQuadraticCurve(a.x,a.y,u.x,u.y,c.x,c.y),null!=t&&t.quadraticCurveTo(u.x,u.y,c.x,c.y)}break;case"A":case"a":for(;!e.isCommandOrEnd();){var a=e.current,d=e.getScalar(),h=e.getScalar(),m=e.getScalar()*(Math.PI/180),g=e.getScalar(),y=e.getScalar(),c=e.getAsCurrentPoint(),p=new s.Point(Math.cos(m)*(a.x-c.x)/2+Math.sin(m)*(a.y-c.y)/2,-Math.sin(m)*(a.x-c.x)/2+Math.cos(m)*(a.y-c.y)/2),f=Math.pow(p.x,2)/Math.pow(d,2)+Math.pow(p.y,2)/Math.pow(h,2);f>1&&(d*=Math.sqrt(f),h*=Math.sqrt(f));var b=(g==y?-1:1)*Math.sqrt((Math.pow(d,2)*Math.pow(h,2)-Math.pow(d,2)*Math.pow(p.y,2)-Math.pow(h,2)*Math.pow(p.x,2))/(Math.pow(d,2)*Math.pow(p.y,2)+Math.pow(h,2)*Math.pow(p.x,2)));isNaN(b)&&(b=0);var v=new s.Point(b*d*p.y/h,b*-h*p.x/d),x=new s.Point((a.x+c.x)/2+Math.cos(m)*v.x-Math.sin(m)*v.y,(a.y+c.y)/2+Math.sin(m)*v.x+Math.cos(m)*v.y),A=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2))},_=function(t,e){return(t[0]*e[0]+t[1]*e[1])/(A(t)*A(e))},E=function(t,e){return(t[0]*e[1]<t[1]*e[0]?-1:1)*Math.acos(_(t,e))},B=E([1,0],[(p.x-v.x)/d,(p.y-v.y)/h]),w=[(p.x-v.x)/d,(p.y-v.y)/h],k=[(-p.x-v.x)/d,(-p.y-v.y)/h],C=E(w,k);_(w,k)<=-1&&(C=Math.PI),_(w,k)>=1&&(C=0);var N=1-y?1:-1,P=B+N*(C/2),I=new s.Point(x.x+d*Math.cos(P),x.y+h*Math.sin(P));if(e.addMarkerAngle(I,P-N*Math.PI/2),e.addMarkerAngle(c,P-N*Math.PI),r.addPoint(c.x,c.y),null!=t){var _=d>h?d:h,S=d>h?1:d/h,M=d>h?h/d:1;t.translate(x.x,x.y),t.rotate(m),t.scale(S,M),t.arc(0,0,_,B,B+C,1-y),t.scale(1/S,1/M),t.rotate(-m),t.translate(-x.x,-x.y)}}break;case"Z":case"z":null!=t&&t.closePath(),e.current=e.start}return r},this.getMarkers=function(){for(var t=this.PathParser.getMarkerPoints(),e=this.PathParser.getMarkerAngles(),r=[],i=0;i<t.length;i++)r.push([t[i],e[i]]);return r}},s.Element.path.prototype=new s.Element.PathElementBase,s.Element.pattern=function(t){this.base=s.Element.ElementBase,this.base(t),this.createPattern=function(t){var e=this.attribute("width").toPixels("x",!0),r=this.attribute("height").toPixels("y",!0),i=new s.Element.svg;i.attributes.viewBox=new s.Property("viewBox",this.attribute("viewBox").value),i.attributes.width=new s.Property("width",e+"px"),i.attributes.height=new s.Property("height",r+"px"),i.attributes.transform=new s.Property("transform",this.attribute("patternTransform").value),i.children=this.children;var n=document.createElement("canvas");n.width=e,n.height=r;var o=n.getContext("2d");this.attribute("x").hasValue()&&this.attribute("y").hasValue()&&o.translate(this.attribute("x").toPixels("x",!0),this.attribute("y").toPixels("y",!0));for(var a=-1;1>=a;a++)for(var l=-1;1>=l;l++)o.save(),i.attributes.x=new s.Property("x",a*n.width),i.attributes.y=new s.Property("y",l*n.height),i.render(o),o.restore();var u=t.createPattern(n,"repeat");return u}},s.Element.pattern.prototype=new s.Element.ElementBase,s.Element.marker=function(t){this.base=s.Element.ElementBase,this.base(t),this.baseRender=this.render,this.render=function(t,e,r){t.translate(e.x,e.y),"auto"==this.attribute("orient").valueOrDefault("auto")&&t.rotate(r),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&t.scale(t.lineWidth,t.lineWidth),t.save();var i=new s.Element.svg;i.attributes.viewBox=new s.Property("viewBox",this.attribute("viewBox").value),i.attributes.refX=new s.Property("refX",this.attribute("refX").value),i.attributes.refY=new s.Property("refY",this.attribute("refY").value),i.attributes.width=new s.Property("width",this.attribute("markerWidth").value),i.attributes.height=new s.Property("height",this.attribute("markerHeight").value),i.attributes.fill=new s.Property("fill",this.attribute("fill").valueOrDefault("black")),i.attributes.stroke=new s.Property("stroke",this.attribute("stroke").valueOrDefault("none")),i.children=this.children,i.render(t),t.restore(),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&t.scale(1/t.lineWidth,1/t.lineWidth),"auto"==this.attribute("orient").valueOrDefault("auto")&&t.rotate(-r),t.translate(-e.x,-e.y)}},s.Element.marker.prototype=new s.Element.ElementBase,s.Element.defs=function(t){this.base=s.Element.ElementBase,this.base(t),this.render=function(){}},s.Element.defs.prototype=new s.Element.ElementBase,s.Element.GradientBase=function(t){this.base=s.Element.ElementBase,this.base(t),this.stops=[];for(var e=0;e<this.children.length;e++){var r=this.children[e];"stop"==r.type&&this.stops.push(r)}this.getGradient=function(){},this.gradientUnits=function(){return this.attribute("gradientUnits").valueOrDefault("objectBoundingBox")},this.attributesToInherit=["gradientUnits"],this.inheritStopContainer=function(t){for(var e=0;e<this.attributesToInherit.length;e++){var r=this.attributesToInherit[e];!this.attribute(r).hasValue()&&t.attribute(r).hasValue()&&(this.attribute(r,!0).value=t.attribute(r).value)}},this.createGradient=function(t,e,r){var i=this;this.getHrefAttribute().hasValue()&&(i=this.getHrefAttribute().getDefinition(),this.inheritStopContainer(i));var n=function(t){if(r.hasValue()){var e=new s.Property("color",t);return e.addOpacity(r).value}return t},o=this.getGradient(t,e);if(null==o)return n(i.stops[i.stops.length-1].color);for(var a=0;a<i.stops.length;a++)o.addColorStop(i.stops[a].offset,n(i.stops[a].color));if(this.attribute("gradientTransform").hasValue()){var l=s.ViewPort.viewPorts[0],u=new s.Element.rect;u.attributes.x=new s.Property("x",-s.MAX_VIRTUAL_PIXELS/3),u.attributes.y=new s.Property("y",-s.MAX_VIRTUAL_PIXELS/3),u.attributes.width=new s.Property("width",s.MAX_VIRTUAL_PIXELS),u.attributes.height=new s.Property("height",s.MAX_VIRTUAL_PIXELS);var c=new s.Element.g;c.attributes.transform=new s.Property("transform",this.attribute("gradientTransform").value),c.children=[u];var d=new s.Element.svg;d.attributes.x=new s.Property("x",0),d.attributes.y=new s.Property("y",0),d.attributes.width=new s.Property("width",l.width),d.attributes.height=new s.Property("height",l.height),d.children=[c];var h=document.createElement("canvas");h.width=l.width,h.height=l.height;var m=h.getContext("2d");return m.fillStyle=o,d.render(m),m.createPattern(h,"no-repeat")}return o}},s.Element.GradientBase.prototype=new s.Element.ElementBase,s.Element.linearGradient=function(t){this.base=s.Element.GradientBase,this.base(t),this.attributesToInherit.push("x1"),this.attributesToInherit.push("y1"),this.attributesToInherit.push("x2"),this.attributesToInherit.push("y2"),this.getGradient=function(t,e){var r="objectBoundingBox"==this.gradientUnits()?e.getBoundingBox():null;this.attribute("x1").hasValue()||this.attribute("y1").hasValue()||this.attribute("x2").hasValue()||this.attribute("y2").hasValue()||(this.attribute("x1",!0).value=0,this.attribute("y1",!0).value=0,this.attribute("x2",!0).value=1,this.attribute("y2",!0).value=0);var i="objectBoundingBox"==this.gradientUnits()?r.x()+r.width()*this.attribute("x1").numValue():this.attribute("x1").toPixels("x"),n="objectBoundingBox"==this.gradientUnits()?r.y()+r.height()*this.attribute("y1").numValue():this.attribute("y1").toPixels("y"),o="objectBoundingBox"==this.gradientUnits()?r.x()+r.width()*this.attribute("x2").numValue():this.attribute("x2").toPixels("x"),s="objectBoundingBox"==this.gradientUnits()?r.y()+r.height()*this.attribute("y2").numValue():this.attribute("y2").toPixels("y");return i==o&&n==s?null:t.createLinearGradient(i,n,o,s)}},s.Element.linearGradient.prototype=new s.Element.GradientBase,s.Element.radialGradient=function(t){this.base=s.Element.GradientBase,this.base(t),this.attributesToInherit.push("cx"),this.attributesToInherit.push("cy"),this.attributesToInherit.push("r"),this.attributesToInherit.push("fx"),this.attributesToInherit.push("fy"),this.getGradient=function(t,e){var r=e.getBoundingBox();this.attribute("cx").hasValue()||(this.attribute("cx",!0).value="50%"),this.attribute("cy").hasValue()||(this.attribute("cy",!0).value="50%"),this.attribute("r").hasValue()||(this.attribute("r",!0).value="50%");var i="objectBoundingBox"==this.gradientUnits()?r.x()+r.width()*this.attribute("cx").numValue():this.attribute("cx").toPixels("x"),n="objectBoundingBox"==this.gradientUnits()?r.y()+r.height()*this.attribute("cy").numValue():this.attribute("cy").toPixels("y"),o=i,s=n;this.attribute("fx").hasValue()&&(o="objectBoundingBox"==this.gradientUnits()?r.x()+r.width()*this.attribute("fx").numValue():this.attribute("fx").toPixels("x")),this.attribute("fy").hasValue()&&(s="objectBoundingBox"==this.gradientUnits()?r.y()+r.height()*this.attribute("fy").numValue():this.attribute("fy").toPixels("y"));var a="objectBoundingBox"==this.gradientUnits()?(r.width()+r.height())/2*this.attribute("r").numValue():this.attribute("r").toPixels();return t.createRadialGradient(o,s,0,i,n,a)}},s.Element.radialGradient.prototype=new s.Element.GradientBase,s.Element.stop=function(t){this.base=s.Element.ElementBase,this.base(t),this.offset=this.attribute("offset").numValue(),this.offset<0&&(this.offset=0),this.offset>1&&(this.offset=1);var e=this.style("stop-color",!0);""===e.value&&(e.value="#000"),this.style("stop-opacity").hasValue()&&(e=e.addOpacity(this.style("stop-opacity"))),this.color=e.value},s.Element.stop.prototype=new s.Element.ElementBase,s.Element.AnimateBase=function(t){this.base=s.Element.ElementBase,this.base(t),s.Animations.push(this),this.duration=0,this.begin=this.attribute("begin").toMilliseconds(),this.maxDuration=this.begin+this.attribute("dur").toMilliseconds(),this.getProperty=function(){var t=this.attribute("attributeType").value,e=this.attribute("attributeName").value;return"CSS"==t?this.parent.style(e,!0):this.parent.attribute(e,!0)},this.initialValue=null,this.initialUnits="",this.removed=!1,this.calcValue=function(){return""},this.update=function(t){if(null==this.initialValue&&(this.initialValue=this.getProperty().value,this.initialUnits=this.getProperty().getUnits()),this.duration>this.maxDuration){if("indefinite"==this.attribute("repeatCount").value||"indefinite"==this.attribute("repeatDur").value)this.duration=0;else if("freeze"!=this.attribute("fill").valueOrDefault("remove")||this.frozen){if("remove"==this.attribute("fill").valueOrDefault("remove")&&!this.removed)return this.removed=!0,this.getProperty().value=this.parent.animationFrozen?this.parent.animationFrozenValue:this.initialValue,!0}else this.frozen=!0,this.parent.animationFrozen=!0,this.parent.animationFrozenValue=this.getProperty().value;return!1}this.duration=this.duration+t;var e=!1;if(this.begin<this.duration){var r=this.calcValue();if(this.attribute("type").hasValue()){var i=this.attribute("type").value;r=i+"("+r+")"}this.getProperty().value=r,e=!0}return e},this.from=this.attribute("from"),this.to=this.attribute("to"),this.values=this.attribute("values"),this.values.hasValue()&&(this.values.value=this.values.value.split(";")),this.progress=function(){var t={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(this.values.hasValue()){var e=t.progress*(this.values.value.length-1),r=Math.floor(e),i=Math.ceil(e);t.from=new s.Property("from",parseFloat(this.values.value[r])),t.to=new s.Property("to",parseFloat(this.values.value[i])),t.progress=(e-r)/(i-r)}else t.from=this.from,t.to=this.to;return t}},s.Element.AnimateBase.prototype=new s.Element.ElementBase,s.Element.animate=function(t){this.base=s.Element.AnimateBase,this.base(t),this.calcValue=function(){var t=this.progress(),e=t.from.numValue()+(t.to.numValue()-t.from.numValue())*t.progress;return e+this.initialUnits}},s.Element.animate.prototype=new s.Element.AnimateBase,s.Element.animateColor=function(e){this.base=s.Element.AnimateBase,this.base(e),this.calcValue=function(){var e=this.progress(),r=new t(e.from.value),i=new t(e.to.value);if(r.ok&&i.ok){var n=r.r+(i.r-r.r)*e.progress,o=r.g+(i.g-r.g)*e.progress,s=r.b+(i.b-r.b)*e.progress;return"rgb("+parseInt(n,10)+","+parseInt(o,10)+","+parseInt(s,10)+")"}return this.attribute("from").value}},s.Element.animateColor.prototype=new s.Element.AnimateBase,s.Element.animateTransform=function(t){this.base=s.Element.AnimateBase,this.base(t),this.calcValue=function(){for(var t=this.progress(),e=s.ToNumberArray(t.from.value),r=s.ToNumberArray(t.to.value),i="",n=0;n<e.length;n++)i+=e[n]+(r[n]-e[n])*t.progress+" ";return i}},s.Element.animateTransform.prototype=new s.Element.animate,s.Element.font=function(t){this.base=s.Element.ElementBase,this.base(t),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.isRTL=!1,this.isArabic=!1,this.fontFace=null,this.missingGlyph=null,this.glyphs=[];for(var e=0;e<this.children.length;e++){var r=this.children[e];"font-face"==r.type?(this.fontFace=r,r.style("font-family").hasValue()&&(s.Definitions[r.style("font-family").value]=this)):"missing-glyph"==r.type?this.missingGlyph=r:"glyph"==r.type&&(""!=r.arabicForm?(this.isRTL=!0,this.isArabic=!0,"undefined"==typeof this.glyphs[r.unicode]&&(this.glyphs[r.unicode]=[]),this.glyphs[r.unicode][r.arabicForm]=r):this.glyphs[r.unicode]=r)}},s.Element.font.prototype=new s.Element.ElementBase,s.Element.fontface=function(t){this.base=s.Element.ElementBase,this.base(t),this.ascent=this.attribute("ascent").value,this.descent=this.attribute("descent").value,this.unitsPerEm=this.attribute("units-per-em").numValue()},s.Element.fontface.prototype=new s.Element.ElementBase,s.Element.missingglyph=function(t){this.base=s.Element.path,this.base(t),this.horizAdvX=0},s.Element.missingglyph.prototype=new s.Element.path,s.Element.glyph=function(t){this.base=s.Element.path,this.base(t),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.unicode=this.attribute("unicode").value,this.arabicForm=this.attribute("arabic-form").value},s.Element.glyph.prototype=new s.Element.path,s.Element.text=function(t){this.captureTextNodes=!0,this.base=s.Element.RenderedElementBase,this.base(t),this.baseSetContext=this.setContext,this.setContext=function(t){this.baseSetContext(t);var e=this.style("dominant-baseline").toTextBaseline();null==e&&(e=this.style("alignment-baseline").toTextBaseline()),null!=e&&(t.textBaseline=e)},this.getBoundingBox=function(){var t=this.attribute("x").toPixels("x"),e=this.attribute("y").toPixels("y"),r=this.parent.style("font-size").numValueOrDefault(s.Font.Parse(s.ctx.font).fontSize);return new s.BoundingBox(t,e-r,t+Math.floor(2*r/3)*this.children[0].getText().length,e)},this.renderChildren=function(t){this.x=this.attribute("x").toPixels("x"),this.y=this.attribute("y").toPixels("y"),this.attribute("dx").hasValue()&&(this.x+=this.attribute("dx").toPixels("x")),this.attribute("dy").hasValue()&&(this.y+=this.attribute("dy").toPixels("y")),this.x+=this.getAnchorDelta(t,this,0);for(var e=0;e<this.children.length;e++)this.renderChild(t,this,e)},this.getAnchorDelta=function(t,e,r){var i=this.style("text-anchor").valueOrDefault("start");if("start"!=i){for(var n=0,o=r;o<e.children.length;o++){var s=e.children[o];if(o>r&&s.attribute("x").hasValue())break;n+=s.measureTextRecursive(t)}return-1*("end"==i?n:n/2)}return 0},this.renderChild=function(t,e,r){var i=e.children[r];i.attribute("x").hasValue()?(i.x=i.attribute("x").toPixels("x")+e.getAnchorDelta(t,e,r),i.attribute("dx").hasValue()&&(i.x+=i.attribute("dx").toPixels("x"))):(i.attribute("dx").hasValue()&&(e.x+=i.attribute("dx").toPixels("x")),i.x=e.x),e.x=i.x+i.measureText(t),i.attribute("y").hasValue()?(i.y=i.attribute("y").toPixels("y"),i.attribute("dy").hasValue()&&(i.y+=i.attribute("dy").toPixels("y"))):(i.attribute("dy").hasValue()&&(e.y+=i.attribute("dy").toPixels("y")),i.y=e.y),e.y=i.y,i.render(t);for(var r=0;r<i.children.length;r++)e.renderChild(t,i,r)}},s.Element.text.prototype=new s.Element.RenderedElementBase,s.Element.TextElementBase=function(t){this.base=s.Element.RenderedElementBase,this.base(t),this.getGlyph=function(t,e,r){var i=e[r],n=null;if(t.isArabic){var o="isolated";(0==r||" "==e[r-1])&&r<e.length-2&&" "!=e[r+1]&&(o="terminal"),r>0&&" "!=e[r-1]&&r<e.length-2&&" "!=e[r+1]&&(o="medial"),r>0&&" "!=e[r-1]&&(r==e.length-1||" "==e[r+1])&&(o="initial"),"undefined"!=typeof t.glyphs[i]&&(n=t.glyphs[i][o],null==n&&"glyph"==t.glyphs[i].type&&(n=t.glyphs[i]))}else n=t.glyphs[i];return null==n&&(n=t.missingGlyph),n},this.renderChildren=function(t){var e=this.parent.style("font-family").getDefinition();if(null==e)""!=t.fillStyle&&t.fillText(s.compressSpaces(this.getText()),this.x,this.y),""!=t.strokeStyle&&t.strokeText(s.compressSpaces(this.getText()),this.x,this.y);else{var r=this.parent.style("font-size").numValueOrDefault(s.Font.Parse(s.ctx.font).fontSize),i=this.parent.style("font-style").valueOrDefault(s.Font.Parse(s.ctx.font).fontStyle),n=this.getText();
e.isRTL&&(n=n.split("").reverse().join(""));for(var o=s.ToNumberArray(this.parent.attribute("dx").value),a=0;a<n.length;a++){var l=this.getGlyph(e,n,a),u=r/e.fontFace.unitsPerEm;t.translate(this.x,this.y),t.scale(u,-u);var c=t.lineWidth;t.lineWidth=t.lineWidth*e.fontFace.unitsPerEm/r,"italic"==i&&t.transform(1,0,.4,1,0,0),l.render(t),"italic"==i&&t.transform(1,0,-.4,1,0,0),t.lineWidth=c,t.scale(1/u,-1/u),t.translate(-this.x,-this.y),this.x+=r*(l.horizAdvX||e.horizAdvX)/e.fontFace.unitsPerEm,"undefined"==typeof o[a]||isNaN(o[a])||(this.x+=o[a])}}},this.getText=function(){},this.measureTextRecursive=function(t){for(var e=this.measureText(t),r=0;r<this.children.length;r++)e+=this.children[r].measureTextRecursive(t);return e},this.measureText=function(t){var e=this.parent.style("font-family").getDefinition();if(null!=e){var r=this.parent.style("font-size").numValueOrDefault(s.Font.Parse(s.ctx.font).fontSize),i=0,n=this.getText();e.isRTL&&(n=n.split("").reverse().join(""));for(var o=s.ToNumberArray(this.parent.attribute("dx").value),a=0;a<n.length;a++){var l=this.getGlyph(e,n,a);i+=(l.horizAdvX||e.horizAdvX)*r/e.fontFace.unitsPerEm,"undefined"==typeof o[a]||isNaN(o[a])||(i+=o[a])}return i}var u=s.compressSpaces(this.getText());if(!t.measureText)return 10*u.length;t.save(),this.setContext(t);var c=t.measureText(u).width;return t.restore(),c}},s.Element.TextElementBase.prototype=new s.Element.RenderedElementBase,s.Element.tspan=function(t){this.captureTextNodes=!0,this.base=s.Element.TextElementBase,this.base(t),this.text=s.compressSpaces(t.value||t.text||t.textContent||""),this.getText=function(){return this.children.length>0?"":this.text}},s.Element.tspan.prototype=new s.Element.TextElementBase,s.Element.tref=function(t){this.base=s.Element.TextElementBase,this.base(t),this.getText=function(){var t=this.getHrefAttribute().getDefinition();return null!=t?t.children[0].getText():void 0}},s.Element.tref.prototype=new s.Element.TextElementBase,s.Element.a=function(t){this.base=s.Element.TextElementBase,this.base(t),this.hasText=t.childNodes.length>0;for(var e=0;e<t.childNodes.length;e++)3!=t.childNodes[e].nodeType&&(this.hasText=!1);this.text=this.hasText?t.childNodes[0].value:"",this.getText=function(){return this.text},this.baseRenderChildren=this.renderChildren,this.renderChildren=function(t){if(this.hasText){this.baseRenderChildren(t);var e=new s.Property("fontSize",s.Font.Parse(s.ctx.font).fontSize);s.Mouse.checkBoundingBox(this,new s.BoundingBox(this.x,this.y-e.toPixels("y"),this.x+this.measureText(t),this.y))}else if(this.children.length>0){var r=new s.Element.g;r.children=this.children,r.parent=this,r.render(t)}},this.onclick=function(){window.open(this.getHrefAttribute().value)},this.onmousemove=function(){s.ctx.canvas.style.cursor="pointer"}},s.Element.a.prototype=new s.Element.TextElementBase,s.Element.image=function(t){this.base=s.Element.RenderedElementBase,this.base(t);var e=this.getHrefAttribute().value;if(""!=e){var r=e.match(/\.svg$/);if(s.Images.push(this),this.loaded=!1,r)this.img=s.ajax(e),this.loaded=!0;else{this.img=document.createElement("img"),1==s.opts.useCORS&&(this.img.crossOrigin="Anonymous");var i=this;this.img.onload=function(){i.loaded=!0},this.img.onerror=function(){s.log('ERROR: image "'+e+'" not found'),i.loaded=!0},this.img.src=e}this.renderChildren=function(t){var e=this.attribute("x").toPixels("x"),i=this.attribute("y").toPixels("y"),n=this.attribute("width").toPixels("x"),o=this.attribute("height").toPixels("y");0!=n&&0!=o&&(t.save(),r?t.drawSvg(this.img,e,i,n,o):(t.translate(e,i),s.AspectRatio(t,this.attribute("preserveAspectRatio").value,n,this.img.width,o,this.img.height,0,0),t.drawImage(this.img,0,0)),t.restore())},this.getBoundingBox=function(){var t=this.attribute("x").toPixels("x"),e=this.attribute("y").toPixels("y"),r=this.attribute("width").toPixels("x"),i=this.attribute("height").toPixels("y");return new s.BoundingBox(t,e,t+r,e+i)}}},s.Element.image.prototype=new s.Element.RenderedElementBase,s.Element.g=function(t){this.base=s.Element.RenderedElementBase,this.base(t),this.getBoundingBox=function(){for(var t=new s.BoundingBox,e=0;e<this.children.length;e++)t.addBoundingBox(this.children[e].getBoundingBox());return t}},s.Element.g.prototype=new s.Element.RenderedElementBase,s.Element.symbol=function(t){this.base=s.Element.RenderedElementBase,this.base(t),this.render=function(){}},s.Element.symbol.prototype=new s.Element.RenderedElementBase,s.Element.style=function(t){this.base=s.Element.ElementBase,this.base(t);for(var e="",i=0;i<t.childNodes.length;i++)e+=t.childNodes[i].data;e=e.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,""),e=s.compressSpaces(e);for(var n=e.split("}"),i=0;i<n.length;i++)if(""!=s.trim(n[i]))for(var o=n[i].split("{"),a=o[0].split(","),l=o[1].split(";"),u=0;u<a.length;u++){var c=s.trim(a[u]);if(""!=c){for(var d={},h=0;h<l.length;h++){var m=l[h].indexOf(":"),g=l[h].substr(0,m),y=l[h].substr(m+1,l[h].length-m);null!=g&&null!=y&&(d[s.trim(g)]=new s.Property(s.trim(g),s.trim(y)))}if(s.Styles[c]=d,s.StylesSpecificity[c]=r(c),"@font-face"==c)for(var p=d["font-family"].value.replace(/"/g,""),f=d.src.value.split(","),b=0;b<f.length;b++)if(f[b].indexOf('format("svg")')>0)for(var v=f[b].indexOf("url"),x=f[b].indexOf(")",v),A=f[b].substr(v+5,x-v-6),_=s.parseXml(s.ajax(A)),E=_.getElementsByTagName("font"),B=0;B<E.length;B++){var w=s.CreateElement(E[B]);s.Definitions[p]=w}}}},s.Element.style.prototype=new s.Element.ElementBase,s.Element.use=function(t){this.base=s.Element.RenderedElementBase,this.base(t),this.baseSetContext=this.setContext,this.setContext=function(t){this.baseSetContext(t),this.attribute("x").hasValue()&&t.translate(this.attribute("x").toPixels("x"),0),this.attribute("y").hasValue()&&t.translate(0,this.attribute("y").toPixels("y"))};var e=this.getHrefAttribute().getDefinition();this.path=function(t){null!=e&&e.path(t)},this.getBoundingBox=function(){return null!=e?e.getBoundingBox():void 0},this.renderChildren=function(t){if(null!=e){var r=e;"symbol"==e.type&&(r=new s.Element.svg,r.type="svg",r.attributes.viewBox=new s.Property("viewBox",e.attribute("viewBox").value),r.attributes.preserveAspectRatio=new s.Property("preserveAspectRatio",e.attribute("preserveAspectRatio").value),r.attributes.overflow=new s.Property("overflow",e.attribute("overflow").value),r.children=e.children),"svg"==r.type&&(this.attribute("width").hasValue()&&(r.attributes.width=new s.Property("width",this.attribute("width").value)),this.attribute("height").hasValue()&&(r.attributes.height=new s.Property("height",this.attribute("height").value)));var i=r.parent;r.parent=null,r.render(t),r.parent=i}}},s.Element.use.prototype=new s.Element.RenderedElementBase,s.Element.mask=function(t){this.base=s.Element.ElementBase,this.base(t),this.apply=function(t,e){var r=this.attribute("x").toPixels("x"),i=this.attribute("y").toPixels("y"),n=this.attribute("width").toPixels("x"),o=this.attribute("height").toPixels("y");if(0==n&&0==o){for(var a=new s.BoundingBox,l=0;l<this.children.length;l++)a.addBoundingBox(this.children[l].getBoundingBox());var r=Math.floor(a.x1),i=Math.floor(a.y1),n=Math.floor(a.width()),o=Math.floor(a.height())}var u=e.attribute("mask").value;e.attribute("mask").value="";var c=document.createElement("canvas");c.width=r+n,c.height=i+o;var d=c.getContext("2d");this.renderChildren(d);var h=document.createElement("canvas");h.width=r+n,h.height=i+o;var m=h.getContext("2d");e.render(m),m.globalCompositeOperation="destination-in",m.fillStyle=d.createPattern(c,"no-repeat"),m.fillRect(0,0,r+n,i+o),t.fillStyle=m.createPattern(h,"no-repeat"),t.fillRect(0,0,r+n,i+o),e.attribute("mask").value=u},this.render=function(){}},s.Element.mask.prototype=new s.Element.ElementBase,s.Element.clipPath=function(t){this.base=s.Element.ElementBase,this.base(t),this.apply=function(t){var e=CanvasRenderingContext2D.prototype.beginPath;CanvasRenderingContext2D.prototype.beginPath=function(){};var r=CanvasRenderingContext2D.prototype.closePath;CanvasRenderingContext2D.prototype.closePath=function(){},e.call(t);for(var i=0;i<this.children.length;i++){var n=this.children[i];if("undefined"!=typeof n.path){var o=null;n.style("transform",!1,!0).hasValue()&&(o=new s.Transform(n.style("transform",!1,!0).value),o.apply(t)),n.path(t),CanvasRenderingContext2D.prototype.closePath=r,o&&o.unapply(t)}}r.call(t),t.clip(),CanvasRenderingContext2D.prototype.beginPath=e,CanvasRenderingContext2D.prototype.closePath=r},this.render=function(){}},s.Element.clipPath.prototype=new s.Element.ElementBase,s.Element.filter=function(t){this.base=s.Element.ElementBase,this.base(t),this.apply=function(t,e){var r=e.getBoundingBox(),i=Math.floor(r.x1),n=Math.floor(r.y1),o=Math.floor(r.width()),s=Math.floor(r.height()),a=e.style("filter").value;e.style("filter").value="";for(var l=0,u=0,c=0;c<this.children.length;c++){var d=this.children[c].extraFilterDistance||0;l=Math.max(l,d),u=Math.max(u,d)}var h=document.createElement("canvas");h.width=o+2*l,h.height=s+2*u;var m=h.getContext("2d");m.translate(-i+l,-n+u),e.render(m);for(var c=0;c<this.children.length;c++)"function"==typeof this.children[c].apply&&this.children[c].apply(m,0,0,o+2*l,s+2*u);t.drawImage(h,0,0,o+2*l,s+2*u,i-l,n-u,o+2*l,s+2*u),e.style("filter",!0).value=a},this.render=function(){}},s.Element.filter.prototype=new s.Element.ElementBase,s.Element.feMorphology=function(t){this.base=s.Element.ElementBase,this.base(t),this.apply=function(){}},s.Element.feMorphology.prototype=new s.Element.ElementBase,s.Element.feComposite=function(t){this.base=s.Element.ElementBase,this.base(t),this.apply=function(){}},s.Element.feComposite.prototype=new s.Element.ElementBase,s.Element.feColorMatrix=function(t){function e(t,e,r,i,n,o){return t[r*i*4+4*e+o]}function r(t,e,r,i,n,o,s){t[r*i*4+4*e+o]=s}function i(t,e){var r=n[t];return r*(0>r?e-255:e)}this.base=s.Element.ElementBase,this.base(t);var n=s.ToNumberArray(this.attribute("values").value);switch(this.attribute("type").valueOrDefault("matrix")){case"saturate":var o=n[0];n=[.213+.787*o,.715-.715*o,.072-.072*o,0,0,.213-.213*o,.715+.285*o,.072-.072*o,0,0,.213-.213*o,.715-.715*o,.072+.928*o,0,0,0,0,0,1,0,0,0,0,0,1];break;case"hueRotate":var a=n[0]*Math.PI/180,l=function(t,e,r){return t+Math.cos(a)*e+Math.sin(a)*r};n=[l(.213,.787,-.213),l(.715,-.715,-.715),l(.072,-.072,.928),0,0,l(.213,-.213,.143),l(.715,.285,.14),l(.072,-.072,-.283),0,0,l(.213,-.213,-.787),l(.715,-.715,.715),l(.072,.928,.072),0,0,0,0,0,1,0,0,0,0,0,1];break;case"luminanceToAlpha":n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2125,.7154,.0721,0,0,0,0,0,0,1]}this.apply=function(t,n,o,s,a){for(var l=t.getImageData(0,0,s,a),o=0;a>o;o++)for(var n=0;s>n;n++){var u=e(l.data,n,o,s,a,0),c=e(l.data,n,o,s,a,1),d=e(l.data,n,o,s,a,2),h=e(l.data,n,o,s,a,3);r(l.data,n,o,s,a,0,i(0,u)+i(1,c)+i(2,d)+i(3,h)+i(4,1)),r(l.data,n,o,s,a,1,i(5,u)+i(6,c)+i(7,d)+i(8,h)+i(9,1)),r(l.data,n,o,s,a,2,i(10,u)+i(11,c)+i(12,d)+i(13,h)+i(14,1)),r(l.data,n,o,s,a,3,i(15,u)+i(16,c)+i(17,d)+i(18,h)+i(19,1))}t.clearRect(0,0,s,a),t.putImageData(l,0,0)}},s.Element.feColorMatrix.prototype=new s.Element.ElementBase,s.Element.feGaussianBlur=function(t){this.base=s.Element.ElementBase,this.base(t),this.blurRadius=Math.floor(this.attribute("stdDeviation").numValue()),this.extraFilterDistance=this.blurRadius,this.apply=function(t,r,i,n,o){return"undefined"==typeof e.canvasRGBA?void s.log("ERROR: StackBlur.js must be included for blur to work"):(t.canvas.id=s.UniqueId(),t.canvas.style.display="none",document.body.appendChild(t.canvas),e.canvasRGBA(t.canvas.id,r,i,n,o,this.blurRadius),void document.body.removeChild(t.canvas))}},s.Element.feGaussianBlur.prototype=new s.Element.ElementBase,s.Element.title=function(){},s.Element.title.prototype=new s.Element.ElementBase,s.Element.desc=function(){},s.Element.desc.prototype=new s.Element.ElementBase,s.Element.MISSING=function(t){s.log("ERROR: Element '"+t.nodeName+"' not yet implemented.")},s.Element.MISSING.prototype=new s.Element.ElementBase,s.CreateElement=function(t){var e=t.nodeName.replace(/^[^:]+:/,"");e=e.replace(/\-/g,"");var r=null;return r="undefined"!=typeof s.Element[e]?new s.Element[e](t):new s.Element.MISSING(t),r.type=t.nodeName,r},s.load=function(t,e){s.loadXml(t,s.ajax(e))},s.loadXml=function(t,e){s.loadXmlDoc(t,s.parseXml(e))},s.loadXmlDoc=function(t,e){s.init(t);var r=function(e){for(var r=t.canvas;r;)e.x-=r.offsetLeft,e.y-=r.offsetTop,r=r.offsetParent;return window.scrollX&&(e.x+=window.scrollX),window.scrollY&&(e.y+=window.scrollY),e};1!=s.opts.ignoreMouse&&(t.canvas.onclick=function(t){var e=r(new s.Point(null!=t?t.clientX:event.clientX,null!=t?t.clientY:event.clientY));s.Mouse.onclick(e.x,e.y)},t.canvas.onmousemove=function(t){var e=r(new s.Point(null!=t?t.clientX:event.clientX,null!=t?t.clientY:event.clientY));s.Mouse.onmousemove(e.x,e.y)});var i=s.CreateElement(e.documentElement);i.root=!0,i.addStylesFromStyleDefinition();var n=!0,o=function(){s.ViewPort.Clear(),t.canvas.parentNode&&s.ViewPort.SetCurrent(t.canvas.parentNode.clientWidth,t.canvas.parentNode.clientHeight),1!=s.opts.ignoreDimensions&&(i.style("width").hasValue()&&(t.canvas.width=i.style("width").toPixels("x"),t.canvas.style.width=t.canvas.width+"px"),i.style("height").hasValue()&&(t.canvas.height=i.style("height").toPixels("y"),t.canvas.style.height=t.canvas.height+"px"));var r=t.canvas.clientWidth||t.canvas.width,o=t.canvas.clientHeight||t.canvas.height;if(1==s.opts.ignoreDimensions&&i.style("width").hasValue()&&i.style("height").hasValue()&&(r=i.style("width").toPixels("x"),o=i.style("height").toPixels("y")),s.ViewPort.SetCurrent(r,o),null!=s.opts.offsetX&&(i.attribute("x",!0).value=s.opts.offsetX),null!=s.opts.offsetY&&(i.attribute("y",!0).value=s.opts.offsetY),null!=s.opts.scaleWidth||null!=s.opts.scaleHeight){var a=null,l=null,u=s.ToNumberArray(i.attribute("viewBox").value);null!=s.opts.scaleWidth&&(i.attribute("width").hasValue()?a=i.attribute("width").toPixels("x")/s.opts.scaleWidth:isNaN(u[2])||(a=u[2]/s.opts.scaleWidth)),null!=s.opts.scaleHeight&&(i.attribute("height").hasValue()?l=i.attribute("height").toPixels("y")/s.opts.scaleHeight:isNaN(u[3])||(l=u[3]/s.opts.scaleHeight)),null==a&&(a=l),null==l&&(l=a),i.attribute("width",!0).value=s.opts.scaleWidth,i.attribute("height",!0).value=s.opts.scaleHeight,i.style("transform",!0,!0).value+=" scale("+1/a+","+1/l+")"}1!=s.opts.ignoreClear&&t.clearRect(0,0,r,o),i.render(t),n&&(n=!1,"function"==typeof s.opts.renderCallback&&s.opts.renderCallback(e))},a=!0;s.ImagesLoaded()&&(a=!1,o()),s.intervalID=setInterval(function(){var t=!1;if(a&&s.ImagesLoaded()&&(a=!1,t=!0),1!=s.opts.ignoreMouse&&(t|=s.Mouse.hasEvents()),1!=s.opts.ignoreAnimation)for(var e=0;e<s.Animations.length;e++)t|=s.Animations[e].update(1e3/s.FRAMERATE);"function"==typeof s.opts.forceRedraw&&1==s.opts.forceRedraw()&&(t=!0),t&&(o(),s.Mouse.runEvents())},1e3/s.FRAMERATE)},s.stop=function(){s.intervalID&&clearInterval(s.intervalID)},s.Mouse=new function(){this.events=[],this.hasEvents=function(){return 0!=this.events.length},this.onclick=function(t,e){this.events.push({type:"onclick",x:t,y:e,run:function(t){t.onclick&&t.onclick()}})},this.onmousemove=function(t,e){this.events.push({type:"onmousemove",x:t,y:e,run:function(t){t.onmousemove&&t.onmousemove()}})},this.eventElements=[],this.checkPath=function(t,e){for(var r=0;r<this.events.length;r++){var i=this.events[r];e.isPointInPath&&e.isPointInPath(i.x,i.y)&&(this.eventElements[r]=t)}},this.checkBoundingBox=function(t,e){for(var r=0;r<this.events.length;r++){var i=this.events[r];e.isPointInBox(i.x,i.y)&&(this.eventElements[r]=t)}},this.runEvents=function(){s.ctx.canvas.style.cursor="";for(var t=0;t<this.events.length;t++)for(var e=this.events[t],r=this.eventElements[t];r;)e.run(r),r=r.parent;this.events=[],this.eventElements=[]}},s}var o,s=function(t,e,r){if(null!=t||null!=e||null!=r){"string"==typeof t&&(t=document.getElementById(t)),null!=t.svg&&t.svg.stop();var i=n(r||{});(1!=t.childNodes.length||"OBJECT"!=t.childNodes[0].nodeName)&&(t.svg=i);var o=t.getContext("2d");"undefined"!=typeof e.documentElement?i.loadXmlDoc(o,e):"<"==e.substr(0,1)?i.loadXml(o,e):i.load(o,e)}else for(var a=document.querySelectorAll("svg"),l=0;l<a.length;l++){var u=a[l],c=document.createElement("canvas");c.width=u.clientWidth,c.height=u.clientHeight,u.parentNode.insertBefore(c,u),u.parentNode.removeChild(u);var d=document.createElement("div");d.appendChild(u),s(c,d.innerHTML)}};"undefined"!=typeof Element.prototype.matches?o=function(t,e){return t.matches(e)}:"undefined"!=typeof Element.prototype.webkitMatchesSelector?o=function(t,e){return t.webkitMatchesSelector(e)}:"undefined"!=typeof Element.prototype.mozMatchesSelector?o=function(t,e){return t.mozMatchesSelector(e)}:"undefined"!=typeof Element.prototype.msMatchesSelector?o=function(t,e){return t.msMatchesSelector(e)}:"undefined"!=typeof Element.prototype.oMatchesSelector?o=function(t,e){return t.oMatchesSelector(e)}:(("function"==typeof jQuery||"function"==typeof Zepto)&&(o=function(t,e){return $(t).is(e)}),"undefined"==typeof o&&(o=Sizzle.matchesSelector));var a=/(\[[^\]]+\])/g,l=/(#[^\s\+>~\.\[:]+)/g,u=/(\.[^\s\+>~\.\[:]+)/g,c=/(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/gi,d=/(:[\w-]+\([^\)]*\))/gi,h=/(:[^\s\+>~\.\[:]+)/g,m=/([^\s\+>~\.\[:]+)/g;return"undefined"!=typeof CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.drawSvg=function(t,e,r,i,n){s(this.canvas,t,{ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:e,offsetY:r,scaleWidth:i,scaleHeight:n})}),s});